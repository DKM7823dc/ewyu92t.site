<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blog æ ‡é¢˜æ‰¹é‡ç”Ÿæˆç³»ç»Ÿ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #6366f1;
  --primary-d: #4f46e5;
  --primary-l: #eef2ff;
  --success: #10b981;
  --warn: #f59e0b;
  --bg: #f1f5f9;
  --white: #fff;
  --text: #1e293b;
  --muted: #64748b;
  --border: #e2e8f0;
  --shadow: 0 4px 20px rgba(99,102,241,.1);
  --r: 14px;
  --r-sm: 9px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans SC','PingFang SC','Microsoft YaHei',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6}

/* Layout */
.wrap{max-width:1180px;margin:0 auto;padding:16px}
.grid{display:grid;grid-template-columns:1fr 320px;gap:20px;align-items:start}
@media(max-width:860px){.grid{grid-template-columns:1fr}}

/* Header */
.header{background:linear-gradient(135deg,#6366f1 0%,#8b5cf6 55%,#a855f7 100%);color:#fff;text-align:center;padding:34px 20px;border-radius:20px;margin-bottom:20px;box-shadow:0 8px 32px rgba(99,102,241,.28)}
.header h1{font-size:clamp(1.25rem,3.5vw,1.9rem);font-weight:700;margin-bottom:6px}
.header p{font-size:.85rem;opacity:.85}

/* Stats */
.stats{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}
.stat{flex:1;min-width:105px;background:#fff;border-radius:var(--r-sm);padding:13px 14px;text-align:center;box-shadow:0 1px 4px rgba(0,0,0,.07)}
.stat-n{font-size:1.5rem;font-weight:700;color:var(--primary);line-height:1.2}
.stat-l{font-size:.68rem;color:var(--muted);margin-top:2px}

/* Cards */
.card{background:#fff;border-radius:var(--r);padding:22px;box-shadow:var(--shadow);margin-bottom:18px}
.card-title{font-size:.93rem;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.badge{font-size:.62rem;font-weight:700;padding:2px 8px;border-radius:20px;background:var(--primary);color:#fff;white-space:nowrap}
.badge-g{background:var(--success)}
.badge-o{background:var(--warn)}

/* Steps */
.steps{display:flex;background:#fff;border-radius:var(--r-sm);padding:4px;gap:3px;margin-bottom:18px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.step{flex:1;padding:9px 6px;text-align:center;border-radius:6px;font-size:.75rem;font-weight:500;color:var(--muted);transition:all .25s;line-height:1.3}
.step.active{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;font-weight:700}
.step.done{background:#f0fdf4;color:var(--success)}

/* Keyword rows */
.kw-row{display:flex;align-items:center;gap:8px;margin-bottom:9px}
.kw-lbl{font-size:.7rem;font-weight:600;color:var(--muted);min-width:52px;flex-shrink:0}
.kw-wrap{flex:1;display:flex;align-items:center;border:2px solid var(--border);border-radius:var(--r-sm);background:#f8faff;transition:border-color .2s;overflow:hidden}
.kw-wrap:focus-within{border-color:var(--primary);background:#fff}
.kw-input{flex:1;border:none;background:transparent;padding:9px 12px;font-size:.88rem;color:var(--text);outline:none;font-family:inherit}
.kw-del{width:30px;height:30px;margin:2px;border:none;border-radius:6px;background:#fecaca;color:#ef4444;cursor:pointer;font-size:.85rem;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0}
.kw-del:hover{background:#ef4444;color:#fff}
.btn-dashed{border:2px dashed var(--primary);background:transparent;color:var(--primary);padding:7px 14px;border-radius:var(--r-sm);font-size:.82rem;font-weight:500;cursor:pointer;transition:all .2s;font-family:inherit;margin-top:2px}
.btn-dashed:hover{background:var(--primary-l)}

/* Buttons */
.btn{padding:10px 16px;border:none;border-radius:var(--r-sm);font-size:.86rem;font-weight:600;cursor:pointer;transition:all .2s;font-family:inherit;display:inline-flex;align-items:center;gap:5px;white-space:nowrap}
.btn-primary{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;box-shadow:0 3px 10px rgba(99,102,241,.28)}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 5px 16px rgba(99,102,241,.38)}
.btn-ghost{background:#f1f5f9;color:var(--text)}
.btn-ghost:hover{background:#e2e8f0}
.btn-success{background:linear-gradient(135deg,#10b981,#059669);color:#fff;box-shadow:0 3px 10px rgba(16,185,129,.28)}
.btn-success:hover{transform:translateY(-1px)}
.btn-outline{background:transparent;border:2px solid var(--primary);color:var(--primary)}
.btn-outline:hover{background:var(--primary);color:#fff}
.btn-row{display:flex;flex-wrap:wrap;gap:8px;margin-top:14px}

/* H1 options */
.h1-opt{display:flex;align-items:center;gap:10px;padding:12px 13px;border:2px solid var(--border);border-radius:var(--r-sm);cursor:pointer;transition:all .2s;margin-bottom:8px}
.h1-opt:hover{border-color:var(--primary);background:#fafbff}
.h1-opt.sel{border-color:var(--primary);background:linear-gradient(135deg,#f0f2ff,#f5f0ff)}
.h1-num{width:24px;height:24px;border-radius:50%;background:var(--border);color:var(--muted);font-size:.68rem;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s}
.h1-opt.sel .h1-num{background:var(--primary);color:#fff}
.h1-type{font-size:.62rem;padding:2px 7px;border-radius:20px;background:#eef2ff;color:var(--primary);font-weight:700;flex-shrink:0;white-space:nowrap}
.h1-text{font-size:.88rem;font-weight:500;flex:1;line-height:1.45}
.dedup-row{font-size:.7rem;color:var(--muted);display:flex;align-items:center;gap:5px;margin-top:10px}
.dedup-dot{width:7px;height:7px;border-radius:50%;background:var(--success);flex-shrink:0}

/* Confirmed H1 */
.h1-confirmed{background:linear-gradient(135deg,#f0f2ff,#f5f0ff);border:2px solid var(--primary);border-radius:var(--r-sm);padding:13px 15px;margin-bottom:15px}
.h1-c-lbl{font-size:.62rem;font-weight:700;color:var(--primary);text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px;display:flex;align-items:center;gap:6px}
.h1-c-type{background:var(--primary);color:#fff;border-radius:20px;padding:1px 7px;font-size:.6rem;font-weight:700}
.h1-c-text{font-size:.93rem;font-weight:700}

/* H2 config */
.h2-cfg{display:flex;align-items:center;gap:12px;background:#f8faff;border-radius:var(--r-sm);padding:13px 15px;margin-bottom:13px;flex-wrap:wrap}
.h2-cfg-lbl{font-size:.86rem;font-weight:600}
.cnt-ctrl{display:flex;align-items:center;gap:8px}
.cnt-btn{width:28px;height:28px;border:2px solid var(--border);border-radius:6px;background:#fff;font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;line-height:1}
.cnt-btn:hover{border-color:var(--primary);color:var(--primary)}
.cnt-val{font-size:1.1rem;font-weight:700;color:var(--primary);min-width:26px;text-align:center}

/* H2 list */
.h2-list{margin:12px 0}
.h2-item{display:flex;align-items:flex-start;gap:10px;padding:10px 12px;border-left:3px solid var(--border);background:#fafafa;border-radius:0 7px 7px 0;margin-bottom:6px;transition:all .2s}
.h2-item:hover{border-left-color:var(--primary);background:#f8f9ff}
.h2-n{font-size:.68rem;font-weight:700;color:var(--muted);min-width:28px;padding-top:2px;flex-shrink:0}
.h2-t{font-size:.86rem;color:var(--text);line-height:1.5}

/* Markdown box */
.md-box{background:#0f172a;border-radius:var(--r-sm);padding:16px;margin-top:12px;overflow:auto}
.md-box pre{color:#94a3b8;font-size:.78rem;line-height:1.9;white-space:pre-wrap;word-break:break-all;font-family:'Courier New','Consolas',monospace}

/* History */
.hist-card{background:#fff;border-radius:var(--r);padding:18px;box-shadow:var(--shadow);position:sticky;top:16px;max-height:calc(100vh - 32px);overflow-y:auto}
.hist-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:13px}
.hist-hdr h3{font-size:.9rem;font-weight:700}
.h-badge{background:var(--primary);color:#fff;font-size:.65rem;font-weight:700;padding:2px 8px;border-radius:20px;min-width:22px;text-align:center}
.h-item{padding:10px 11px;border:1px solid var(--border);border-radius:7px;margin-bottom:7px;cursor:pointer;transition:all .2s}
.h-item:hover{border-color:var(--primary);background:#fafbff}
.h-h1{font-size:.78rem;font-weight:600;line-height:1.4;color:var(--text)}
.h-meta{font-size:.65rem;color:var(--muted);margin-top:3px}
.hist-empty{text-align:center;color:var(--muted);font-size:.8rem;padding:22px 8px;line-height:1.9}
.btn-export{width:100%;margin-top:10px;padding:8px;font-size:.78rem;justify-content:center}

/* Animations */
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.fu{animation:fadeUp .3s ease forwards}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

/* Toast */
.toast{position:fixed;bottom:22px;left:50%;transform:translateX(-50%);background:#1e293b;color:#fff;padding:10px 22px;border-radius:30px;font-size:.82rem;z-index:999;animation:fadeUp .3s ease;white-space:nowrap;pointer-events:none}

.hidden{display:none!important}
</style>
</head>
<body>
<div class="wrap">

<!-- Header -->
<div class="header">
  <h1>ğŸ“ Blog æ ‡é¢˜æ‰¹é‡ç”Ÿæˆç³»ç»Ÿ</h1>
  <p>è¾“å…¥å…³é”®è¯ â†’ ç”Ÿæˆ H1 å€™é€‰ â†’ ç¡®è®¤ â†’ æ‰¹é‡ç”Ÿæˆ H2 æ–‡ç« ç»“æ„ Â· å…¨ç¨‹é˜²é‡å¤</p>
</div>

<!-- Stats -->
<div class="stats">
  <div class="stat"><div class="stat-n" id="sn-articles">0</div><div class="stat-l">æ–‡ç« ç»“æ„å·²ç”Ÿæˆ</div></div>
  <div class="stat"><div class="stat-n" id="sn-titles">0</div><div class="stat-l">æ ‡é¢˜ç”Ÿæˆæ€»æ•°</div></div>
  <div class="stat"><div class="stat-n" id="sn-dedup">0</div><div class="stat-l">é‡å¤æ ‡é¢˜å·²æ‹¦æˆª</div></div>
  <div class="stat"><div class="stat-n" id="sn-kw" style="font-size:.9rem;line-height:1.8">â€”</div><div class="stat-l">å½“å‰å…³é”®è¯</div></div>
</div>

<div class="grid">
  <!-- Main -->
  <div>
    <div class="steps">
      <div class="step active" id="s1">â‘  è¾“å…¥å…³é”®è¯</div>
      <div class="step" id="s2">â‘¡ ç¡®è®¤ H1 æ ‡é¢˜</div>
      <div class="step" id="s3">â‘¢ ç”Ÿæˆ H2 ç»“æ„</div>
    </div>

    <!-- Panel 1 -->
    <div class="card" id="p1">
      <div class="card-title">ğŸ”‘ è¾“å…¥å…³é”®è¯ <span class="badge">Step 1</span></div>
      <div id="kw-rows"></div>
      <button class="btn-dashed" id="btn-add-kw">ï¼‹ æ·»åŠ æ›´å¤šå…³é”®è¯ï¼ˆæœ€å¤š 3 ä¸ªï¼‰</button>
      <div class="btn-row">
        <button class="btn btn-primary" id="btn-gen-h1">âœ¨ ç”Ÿæˆ H1 æ ‡é¢˜é€‰é¡¹</button>
      </div>
    </div>

    <!-- Panel 2 -->
    <div class="card hidden" id="p2">
      <div class="card-title">ğŸ“Œ é€‰æ‹© H1 æ ‡é¢˜ <span class="badge badge-o" id="kw-badge"></span></div>
      <div id="h1-list"></div>
      <div class="dedup-row"><div class="dedup-dot"></div><span>å·²è¿‡æ»¤é‡å¤æ ‡é¢˜ Â· æ‰€æœ‰é€‰é¡¹å‡ä¸ºå…¨æ–°å†…å®¹</span></div>
      <div class="btn-row">
        <button class="btn btn-ghost" id="btn-regen-h1">ğŸ”„ æ¢ä¸€æ‰¹</button>
        <button class="btn btn-primary hidden" id="btn-confirm-h1">âœ“ ç¡®è®¤æ­¤æ ‡é¢˜ï¼Œç»§ç»­ â†’</button>
      </div>
    </div>

    <!-- Panel 3 -->
    <div class="card hidden" id="p3">
      <div class="card-title">ğŸ—ï¸ ç”Ÿæˆ H2 æ–‡ç« ç»“æ„ <span class="badge badge-g">Step 3</span></div>

      <div class="h1-confirmed">
        <div class="h1-c-lbl">âœ“ å·²ç¡®è®¤ H1 æ ‡é¢˜ <span class="h1-c-type" id="confirmed-type">æŒ‡å—å‹</span></div>
        <div class="h1-c-text" id="confirmed-h1"></div>
      </div>

      <div class="h2-cfg">
        <span class="h2-cfg-lbl">H2 æ•°é‡</span>
        <div class="cnt-ctrl">
          <button class="cnt-btn" id="cnt-m">âˆ’</button>
          <div class="cnt-val" id="cnt-v">8</div>
          <button class="cnt-btn" id="cnt-p">ï¼‹</button>
        </div>
        <span style="font-size:.72rem;color:var(--muted)">ï¼ˆ8 ~ 10 ä¸ªï¼‰</span>
        <div style="flex:1"></div>
        <button class="btn btn-primary" id="btn-gen-h2" style="flex-shrink:0">ğŸš€ ç”Ÿæˆ H2 æ ‡é¢˜</button>
      </div>

      <div id="h2-results" class="hidden">
        <div class="h2-list" id="h2-list-el"></div>
        <div class="md-box"><pre id="md-out"></pre></div>
        <div class="btn-row">
          <button class="btn btn-success" id="btn-copy">ğŸ“‹ å¤åˆ¶ Markdown</button>
          <button class="btn btn-outline" id="btn-regen-h2">ğŸ”„ é‡æ–°ç”Ÿæˆ H2</button>
          <button class="btn btn-ghost" id="btn-new">ï¼‹ æ–°å»ºæ–‡ç« </button>
        </div>
      </div>
    </div>
  </div>

  <!-- History -->
  <div>
    <div class="hist-card">
      <div class="hist-hdr">
        <h3>ğŸ“š ç”Ÿæˆå†å²</h3>
        <span class="h-badge" id="h-badge">0</span>
      </div>
      <div id="hist-list">
        <div class="hist-empty">æš‚æ— è®°å½•<br><br>å®Œæˆé¦–æ¬¡ç”Ÿæˆå<br>å†å²å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
      </div>
      <button class="btn btn-ghost btn-export hidden" id="btn-export-all">ğŸ“¦ å¯¼å‡ºå…¨éƒ¨å†å² Markdown</button>
    </div>
  </div>
</div>

</div>

<script>
'use strict';

/* ====================================================
   è¯æ±‡åº“
   ==================================================== */
const V = {
  num:    ['3ä¸ª','5ä¸ª','7ä¸ª','8ä¸ª','10ä¸ª','12ä¸ª','15ä¸ª'],
  step:   ['3æ­¥','5æ­¥','7æ­¥','8æ­¥','10æ­¥'],
  adj:    ['é«˜æ•ˆ','å®ç”¨','å¿…çœ‹','æ·±åº¦','å…¨é¢','æœ€æ–°','ä¸“ä¸š','ç³»ç»Ÿ','æƒå¨','ç²¾å'],
  struct: ['æ”»ç•¥','æŒ‡å—','æ•™ç¨‹','æ‰‹å†Œ','è§£æ','ç§˜ç±','è·¯çº¿å›¾','å®å…¸','å¹²è´§'],
  effect: ['æ•ˆç‡ç¿»å€','å¿«é€Ÿä¸Šæ‰‹','ç«‹ç«¿è§å½±','äº‹åŠåŠŸå€','è„±é¢–è€Œå‡º','å°‘èµ°å¼¯è·¯','æ¸¸åˆƒæœ‰ä½™','å¿«é€Ÿè¿›é˜¶'],
  time:   ['7å¤©','14å¤©','30å¤©','2å‘¨','1ä¸ªæœˆ','3ä¸ªæœˆ'],
  action: ['æŒæ¡æ ¸å¿ƒæŠ€èƒ½','å¿«é€Ÿå…¥é—¨','ç³»ç»Ÿå­¦ä¹ ','æ·±åº¦å®è·µ','æå‡æ•ˆç‡','é«˜æ•ˆåº”ç”¨'],
  level:  ['ç²¾é€š','å®æˆ˜','é«˜æ‰‹','ä¸“å®¶','è¿›é˜¶','å¤§å¸ˆçº§'],
};
const TYPE_LBL = {
  list:'æ¸…å•å‹', tutorial:'æ•™ç¨‹å‹', guide:'æŒ‡å—å‹',
  analysis:'è§£æå‹', comparison:'å¯¹æ¯”å‹', time:'æŒ‘æˆ˜å‹', reveal:'æ­ç§˜å‹'
};
function p(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

/* ====================================================
   H1 æ¨¡æ¿åº“ï¼ˆ19 ç§ï¼Œå¯æ‰©å±•ï¼‰
   ==================================================== */
const H1_TMPL = [
  {t:'list',     g:(k,ks)=>`${p(V.num)}ä¸ª${k}æŠ€å·§ï¼Œè®©ä½ ${p(V.effect)}`},
  {t:'list',     g:(k,ks)=>`${p(V.num)}ä¸ª${k}${p(V.struct)}ï¼ŒåŠ©ä½ ${p(V.effect)}`},
  {t:'list',     g:(k,ks)=>ks.length>1?`${p(V.num)}ä¸ª${ks[0]}ä¸${ks[1]}å®æˆ˜æŠ€å·§å¤§å…¨`:`${p(V.num)}ä¸ªå¿…å¤‡${k}æŠ€å·§ç²¾é€‰`},
  {t:'list',     g:(k,ks)=>`æ–°æ‰‹å¿…çœ‹ï¼š${k}çš„${p(V.num)}ä¸ª${p(V.adj)}æŠ€å·§`},
  {t:'list',     g:(k,ks)=>`è¿›é˜¶${k}ï¼š${p(V.num)}ä¸ªè®©ä½ è„±é¢–è€Œå‡ºçš„${p(V.adj)}ç­–ç•¥`},
  {t:'tutorial', g:(k,ks)=>`${k}å…¥é—¨${p(V.struct)}ï¼š${p(V.step)}å­¦ä¼š${p(V.action)}`},
  {t:'tutorial', g:(k,ks)=>`ä»é›¶å¼€å§‹å­¦${k}ï¼š${p(V.adj)}å®Œæ•´æ•™ç¨‹`},
  {t:'tutorial', g:(k,ks)=>`${k}${p(V.struct)}ç²¾è®²ï¼šä»å…¥é—¨åˆ°${p(V.level)}`},
  {t:'tutorial', g:(k,ks)=>`æ‰‹æŠŠæ‰‹æ•™ä½ ${k}ï¼š${p(V.step)}å®Œæˆ${p(V.action)}`},
  {t:'guide',    g:(k,ks)=>`${k}å®Œå…¨æŒ‡å—ï¼šä»å…¥é—¨åˆ°${p(V.level)}`},
  {t:'guide',    g:(k,ks)=>`${p(V.adj)}${k}${p(V.struct)}ï¼šç³»ç»ŸåŒ–${p(V.adj)}è¯¦è§£`},
  {t:'guide',    g:(k,ks)=>`${k}ç»ˆæ${p(V.struct)}ï¼š${p(V.adj)}çŸ¥è¯†ä½“ç³»æ±‡æ€»`},
  {t:'guide',    g:(k,ks)=>`${k}å…¨é¢${p(V.struct)}ï¼š${p(V.num)}ä¸ªæ ¸å¿ƒè¦ç‚¹æ·±åº¦è§£è¯»`},
  {t:'analysis', g:(k,ks)=>`æ·±åº¦è§£æ${k}ï¼šåŸç†ã€åº”ç”¨ä¸æœ€ä½³å®è·µ`},
  {t:'analysis', g:(k,ks)=>`${k}å…¨é¢è§£æï¼š${p(V.adj)}${p(V.struct)}`},
  {t:'analysis', g:(k,ks)=>`${k}çš„åº•å±‚é€»è¾‘ï¼š${p(V.num)}ä¸ªæ ¸å¿ƒåŸåˆ™${p(V.adj)}è§£è¯»`},
  {t:'time',     g:(k,ks)=>`${p(V.time)}å†…æŒæ¡${k}ï¼š${p(V.adj)}${p(V.struct)}`},
  {t:'time',     g:(k,ks)=>`${p(V.time)}${k}é€Ÿæˆè®¡åˆ’ï¼š${p(V.adj)}è·¯çº¿å›¾`},
  {t:'reveal',   g:(k,ks)=>`æ­ç§˜${k}çš„${p(V.num)}ä¸ª${p(V.adj)}ç§˜è¯€`},
  {t:'reveal',   g:(k,ks)=>`${k}é«˜æ‰‹ä¸ä¼šå‘Šè¯‰ä½ çš„${p(V.num)}ä¸ªç§˜å¯†æŠ€å·§`},
  {t:'comparison',g:(k,ks)=>ks.length>1?`${ks[0]} vs ${ks[1]}ï¼š${p(V.adj)}å¯¹æ¯”${p(V.struct)}`:`${k}ä¸»æµæ–¹æ¡ˆå…¨é¢å¯¹æ¯”${p(V.struct)}`},
  {t:'comparison',g:(k,ks)=>ks.length>1?`${ks[0]}ä¸${ks[1]}æ·±åº¦å¯¹æ¯”ï¼šå¦‚ä½•åšå‡ºæ­£ç¡®é€‰æ‹©`:`${k}å¸¸è§æ–¹æ¡ˆæ·±åº¦å¯¹æ¯”åˆ†æ`},
];

/* ====================================================
   H2 æ± ï¼ˆæ¯ç±»å‹ 10-14 æ¡ï¼Œä¿è¯ count=10 å¯ç”¨ï¼‰
   ==================================================== */
function getH2Pool(type, kw, keywords){
  const k2 = keywords.length>1 ? keywords[1] : null;
  const ck = keywords.length>1 ? `${keywords[0]}ä¸${keywords[1]}` : kw;

  const pools = {
    list:[
      `ä¸ºä»€ä¹ˆ${kw}æŠ€å·§åœ¨å½“ä¸‹å¦‚æ­¤å…³é”®ï¼Ÿ`,
      `å¼€å§‹ä¹‹å‰ï¼šå¿…é¡»æŒæ¡çš„${kw}æ ¸å¿ƒåŸºç¡€çŸ¥è¯†`,
      `æŠ€å·§ä¸€ï¼šæ‰“å¥½${kw}åŸºç¡€ï¼Œç³»ç»Ÿæ€§é¿å…å¼¯è·¯`,
      `æŠ€å·§äºŒï¼š${kw}æ ¸å¿ƒæ“ä½œæµç¨‹ä¸è¦ç‚¹è¯¦è§£`,
      `æŠ€å·§ä¸‰ï¼š${kw}æ•ˆç‡æå‡çš„å…³é”®ç­–ç•¥æ‹†è§£`,
      `æŠ€å·§å››ï¼šè¿›é˜¶${kw}åº”ç”¨ä¸çœŸå®åœºæ™¯å®æˆ˜`,
      `æŠ€å·§äº”ï¼š${kw}é«˜æ‰‹çš„ç‹¬é—¨æ€ç»´æ¨¡å¼è§£æ`,
      `æŠ€å·§å…­ï¼šå€ŸåŠ©è‡ªåŠ¨åŒ–è®©${kw}äº‹åŠåŠŸå€`,
      `æŠ€å·§ä¸ƒï¼šæ•°æ®ä¸åé¦ˆé©±åŠ¨${kw}æŒç»­ä¼˜åŒ–`,
      `å¸¸è§è¯¯åŒºï¼šåœ¨${kw}ä¸Šæ–°æ‰‹æœ€å®¹æ˜“è¸©çš„å‘`,
      `å·¥å…·æ¨èï¼šæå‡${kw}æ•ˆç‡çš„å¿…å¤‡åˆ©å™¨ç²¾é€‰`,
      `å¦‚ä½•å°†è¿™äº›${kw}æŠ€å·§æ— ç¼èå…¥æ—¥å¸¸å·¥ä½œæµ`,
      `æ€»ç»“ä¸è¡ŒåŠ¨è®¡åˆ’ï¼šä»ä»Šå¤©å¼€å§‹è·µè¡Œ${kw}`,
    ],
    tutorial:[
      `${kw}æ˜¯ä»€ä¹ˆï¼Ÿæ–°æ‰‹å¿…è¯»çš„æ ¸å¿ƒæ¦‚å¿µå…¨è§£`,
      `ä¸ºä»€ä¹ˆè¦å­¦${kw}ï¼Ÿå®ƒèƒ½ä¸ºä½ å¸¦æ¥å“ªäº›ä»·å€¼`,
      `å¼€å§‹ä¹‹å‰ï¼šå¼€å‘ç¯å¢ƒæ­å»ºä¸å·¥å…·å‡†å¤‡æŒ‡å—`,
      `ç¬¬ä¸€æ­¥ï¼š${kw}æ ¸å¿ƒåŸºç¡€çŸ¥è¯†ä½“ç³»è¯¦è§£`,
      `ç¬¬äºŒæ­¥ï¼šåŠ¨æ‰‹å®æ“ï¼Œå®Œæˆç¬¬ä¸€ä¸ª${kw}é¡¹ç›®`,
      `ç¬¬ä¸‰æ­¥ï¼š${kw}æ ¸å¿ƒåŠŸèƒ½æ·±åº¦æ¢ç´¢ä¸å®è·µ`,
      `ç¬¬å››æ­¥ï¼šè¡Œä¸šæœ€ä½³å®è·µä¸é«˜é¢‘æŠ€å·§æ±‡æ€»`,
      `ç¬¬äº”æ­¥ï¼šè§£å†³çœŸå®é—®é¢˜çš„${kw}å®æˆ˜åº”ç”¨`,
      `è¿›é˜¶ç¯‡ï¼š${kw}é«˜çº§ç‰¹æ€§ä¸æ€§èƒ½è°ƒä¼˜`,
      `å¸¸è§æŠ¥é”™ä¸ç–‘éš¾é—®é¢˜è§£å†³æ‰‹å†Œ`,
      `${kw}ä¼˜è´¨å­¦ä¹ èµ„æºä¸æŠ€æœ¯ç¤¾åŒºæ¨è`,
      `å®Œæˆå…¥é—¨åï¼š${kw}è¿›é˜¶æˆé•¿è·¯çº¿å›¾`,
    ],
    guide:[
      `${kw}æ¦‚è¿°ï¼šå®šä¹‰ã€é‡è¦æ€§ä¸æ ¸å¿ƒåº”ç”¨åœºæ™¯`,
      `${kw}æ ¸å¿ƒåŸç†ï¼šä½ éœ€è¦æŒæ¡çš„åŸºç¡€ç†è®ºæ¡†æ¶`,
      `åˆå­¦è€…å¿«é€Ÿå…¥é—¨ï¼š${kw}ä¸Šæ‰‹æ­¥éª¤å…¨æ‹†è§£`,
      `${kw}å·¥å…·ä¸èµ„æºï¼šç²¾é€‰å®Œæ•´æ¸…å•`,
      `å®æˆ˜è½åœ°ï¼š${kw}åœ¨çœŸå®ä¸šåŠ¡åœºæ™¯ä¸­çš„åº”ç”¨`,
      `${kw}æœ€ä½³å®è·µï¼šä¸“å®¶ç»éªŒä¸è¸©å‘æ€»ç»“`,
      `è¿›é˜¶çªç ´ï¼šè·¨è¶Š${kw}åˆçº§æ°´å¹³çš„å…³é”®èŠ‚ç‚¹`,
      `${kw}å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆå…¨æ±‡æ€»`,
      `${kw}å‘å±•è¶‹åŠ¿ä¸æœªæ¥å±•æœ›`,
      `æ„å»ºä½ çš„${kw}ä½“ç³»ï¼šä»ç†è®ºåˆ°ç³»ç»Ÿæ€§è½åœ°`,
    ],
    analysis:[
      `${kw}çš„èµ·æºã€å‘å±•å†ç¨‹ä¸æ¼”å˜è„‰ç»œ`,
      `${kw}çš„åº•å±‚æ ¸å¿ƒåŸç†æ·±åº¦è§£æ`,
      `${kw}çš„ä¸»è¦ç±»å‹ä¸åˆ†ç±»ä½“ç³»å…¨æ¢³ç†`,
      `${kw}åœ¨ä¸åŒä¸šåŠ¡åœºæ™¯ä¸­çš„åº”ç”¨è·¯å¾„åˆ†æ`,
      `æ•°æ®è¯´è¯ï¼š${kw}æ•ˆæœçš„é‡åŒ–è¯„ä¼°ä¸å…¸å‹æ¡ˆä¾‹`,
      `${kw}çš„ä¼˜åŠ¿ä¸å±€é™æ€§å®¢è§‚å…¨é¢è¯„ä¼°`,
      `ä¸“å®¶è§†è§’ï¼š${kw}è¡Œä¸šå‰æ²¿æ´å¯Ÿä¸è§‚ç‚¹æ±‡é›†`,
      `${kw}ä¸ç›¸å…³æŠ€æœ¯çš„å…³è”æ€§æ¨ªå‘å¯¹æ¯”`,
      `${kw}å®æˆ˜æ¡ˆä¾‹æ·±åº¦å‰–æä¸å¤ç›˜`,
      `${kw}çš„æœªæ¥è¶‹åŠ¿é¢„åˆ¤ä¸å‘å±•æ–¹å‘å±•æœ›`,
    ],
    comparison:[
      `ä¸ºä»€ä¹ˆéœ€è¦å¯¹æ¯”${ck}ï¼Ÿæ ¸å¿ƒé—®é¢˜èƒŒæ™¯`,
      `${keywords[0]}ï¼šæ ¸å¿ƒç‰¹æ€§ã€ä¼˜åŠ¿ä¸é€‚ç”¨åœºæ™¯å…¨æ`,
      `${k2||'ç«å“æ–¹æ¡ˆ'}ï¼šæ ¸å¿ƒç‰¹æ€§ã€ä¼˜åŠ¿ä¸é€‚ç”¨åœºæ™¯å…¨æ`,
      `åŠŸèƒ½å¯¹æ¯”ï¼šä¸¤ç§æ–¹æ¡ˆè¯¦ç»†æ¨ªå‘åˆ†æçŸ©é˜µ`,
      `æ€§èƒ½æµ‹è¯•ï¼šå®æµ‹æ•°æ®ä¸åŸºå‡† Benchmark å¯¹æ¯”`,
      `å­¦ä¹ æ›²çº¿ä¸ä¸Šæ‰‹éš¾åº¦æ¯”è¾ƒ`,
      `æˆæœ¬ä¸ ROIï¼šæŠ•å…¥äº§å‡ºæ¯”å…¨é¢å¯¹æ¯”`,
      `ç¤¾åŒºæ”¯æŒã€ç”Ÿæ€ç³»ç»Ÿä¸é•¿æœŸå¯ç»´æŠ¤æ€§`,
      `çœŸå®ç”¨æˆ·è¯„ä»·ä¸åé¦ˆæ¡ˆä¾‹æ±‡æ€»`,
      `å¦‚ä½•é€‰æ‹©ï¼šåœºæ™¯é©±åŠ¨çš„å†³ç­–è¯„ä¼°æ¡†æ¶`,
      `æ¨èå»ºè®®ï¼šæ ¹æ®ä½ çš„å®é™…éœ€æ±‚åšå‡ºæœ€ä¼˜é€‰æ‹©`,
    ],
    time:[
      `å‡ºå‘å‰çš„å‡†å¤‡ï¼šåˆ¶å®šä½ çš„${kw}å­¦ä¹ è®¡åˆ’`,
      `ç¬¬ä¸€é˜¶æ®µï¼š${kw}åŸºç¡€çŸ¥è¯†å¿«é€Ÿå»ºç«‹`,
      `ç¬¬äºŒé˜¶æ®µï¼š${kw}æ ¸å¿ƒæŠ€èƒ½æ·±åº¦ç»ƒä¹ `,
      `ç¬¬ä¸‰é˜¶æ®µï¼š${kw}è¿›é˜¶åº”ç”¨ä¸é¡¹ç›®å®æˆ˜`,
      `ç¬¬å››é˜¶æ®µï¼š${kw}ç»¼åˆèƒ½åŠ›å·©å›ºä¸å…¨é¢æå‡`,
      `å¦‚ä½•å…‹æœ${kw}å­¦ä¹ ç“¶é¢ˆï¼Œä¿æŒæŒç»­è¿›æ­¥`,
      `æ¯æ—¥ç»ƒä¹ æ–¹æ¡ˆï¼šé«˜æ•ˆçš„${kw}æ—¶é—´åˆ†é…ç­–ç•¥`,
      `èµ„æºæ¨èï¼šåŠ é€Ÿ${kw}å­¦ä¹ çš„ä¼˜è´¨ææ–™ç²¾é€‰`,
      `å­¦ä¹ æ•ˆæœè¯„ä¼°ï¼šæ£€éªŒä½ çš„${kw}çœŸå®æ°´å¹³`,
      `æŒ‘æˆ˜å®Œæˆåï¼š${kw}çš„è¿›é˜¶æˆé•¿è·¯å¾„è§„åˆ’`,
    ],
    reveal:[
      `æ­ç§˜å‰ï¼šå¤§å¤šæ•°äººå¯¹${kw}å­˜åœ¨çš„å¸¸è§è¯¯è§£`,
      `ç§˜è¯€ä¸€ï¼š${kw}é«˜æ‰‹ä¸æ™®é€šäººçš„æ ¸å¿ƒæ€ç»´å·®è·`,
      `ç§˜è¯€äºŒï¼š${kw}ä¸­è¢«å¿½è§†çš„é«˜æ•ˆåº•å±‚é€»è¾‘`,
      `ç§˜è¯€ä¸‰ï¼š${kw}ä¸“å®¶å¦‚ä½•åšå…³é”®å†³ç­–ä¸å–èˆ`,
      `ç§˜è¯€å››ï¼š${kw}å®æˆ˜ä¸­çš„ç»†èŠ‚å¿ƒæ³•ä¸æŠ€å·§`,
      `ç§˜è¯€äº”ï¼šå€ŸåŠ©${kw}æ æ†æ•ˆåº”æ”¾å¤§ä½ çš„æˆæœ`,
      `ç§˜è¯€å…­ï¼š${kw}ä¸­çš„åç›´è§‰ç­–ç•¥ä¸æ–¹æ³•è®º`,
      `ç§˜è¯€ä¸ƒï¼š${kw}é«˜æ‰‹éƒ½åœ¨ä½¿ç”¨çš„å·¥å…·ç»„åˆ`,
      `å¦‚ä½•ç³»ç»Ÿåœ°å°†è¿™äº›ç§˜è¯€åº”ç”¨åˆ°${kw}å®è·µä¸­`,
      `é¿å‘æŒ‡å—ï¼šåº”ç”¨${kw}ç§˜è¯€æ—¶å¸¸è§çš„é™·é˜±`,
      `æ¡ˆä¾‹åˆ†äº«ï¼šè¿ç”¨ç§˜è¯€åçš„${kw}çœŸå®è½¬å˜`,
      `æ€»ç»“ï¼šæ‰“é€ ä½ åœ¨${kw}é¢†åŸŸçš„ç‹¬ç‰¹ç«äº‰ä¼˜åŠ¿`,
    ],
  };
  return pools[type] || pools.guide;
}

/* ====================================================
   çŠ¶æ€
   ==================================================== */
const S = {
  keywords:    [''],
  h1Options:   [],
  selIdx:      -1,
  selH1:       '',
  selType:     'guide',
  h2Count:     8,
  curH2:       [],
  history:     [],
  genSet:      new Set(),
  dedupBlocked:0,
  totalTitles: 0,
};

/* ====================================================
   å»é‡å·¥å…·
   ==================================================== */
function fp(t){ return t.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g,'').toLowerCase(); }
function inSet(t){ return S.genSet.has(fp(t)); }
function addSet(t){ S.genSet.add(fp(t)); }

/* ====================================================
   ç±»å‹æ£€æµ‹
   ==================================================== */
function detectType(h1){
  if(/vs|å¯¹æ¯”|æ¯”è¾ƒ/.test(h1))         return 'comparison';
  if(/\d+å¤©|\d+å‘¨|\d+æœˆ|å†…æŒæ¡|é€Ÿæˆ/.test(h1)) return 'time';
  if(/æ­ç§˜|ç§˜è¯€|ç§˜å¯†|ä¸ä¼šå‘Šè¯‰/.test(h1)) return 'reveal';
  if(/æ·±åº¦è§£æ|å…¨é¢è§£æ|åº•å±‚é€»è¾‘|æ ¸å¿ƒåŸåˆ™/.test(h1)) return 'analysis';
  if(/\d+ä¸ª.*(æŠ€å·§|æ–¹æ³•|æ­¥éª¤|æ”»ç•¥|æŒ‡å—|æ•™ç¨‹|æ‰‹å†Œ|ç­–ç•¥|ç§˜è¯€)/.test(h1)) return 'list';
  if(/å…¥é—¨|ä»é›¶|æ•™ç¨‹|ä¸€æ­¥æ­¥|å­¦ä¼š|æ‰‹æŠŠæ‰‹/.test(h1)) return 'tutorial';
  return 'guide';
}

/* ====================================================
   H1 ç”Ÿæˆ
   ==================================================== */
function genH1(keywords){
  const kw = keywords[0];
  const results = [];
  const shuffled = [...H1_TMPL].sort(()=>Math.random()-.5);
  for(const tm of shuffled){
    let title = tm.g(kw, keywords);
    if(inSet(title)){
      S.dedupBlocked++;
      title = tm.g(kw, keywords); // retry once
    }
    if(!inSet(title) && !results.find(r=>fp(r.text)===fp(title))){
      results.push({text:title, type:tm.t});
      if(results.length>=6) break;
    }
  }
  // Safety fill
  let tries=0;
  while(results.length<4 && tries++<40){
    const tm = p(H1_TMPL);
    const title = tm.g(kw,keywords);
    if(inSet(title)){S.dedupBlocked++; continue;}
    if(!results.find(r=>fp(r.text)===fp(title)))
      results.push({text:title, type:tm.t});
  }
  return results;
}

/* ====================================================
   H2 ç”Ÿæˆ
   ==================================================== */
function genH2(h1, keywords, count, type){
  const kw = keywords[0];
  const pool = getH2Pool(type, kw, keywords);
  const intro  = pool[0];
  const outro  = pool[pool.length-1];
  const mid    = pool.slice(1, pool.length-1).sort(()=>Math.random()-.5);
  const needed = count-2;
  const result = [intro, ...mid.slice(0, Math.min(needed, mid.length)), outro];
  result.forEach(t=>{ addSet(t); S.totalTitles++; });
  return result;
}

/* ====================================================
   Markdown æ„å»º
   ==================================================== */
function buildMd(h1, h2s){
  return `# ${h1}\n\n`+h2s.map(h=>`## ${h}`).join('\n\n')+'\n';
}

/* ====================================================
   HTML è½¬ä¹‰
   ==================================================== */
function esc(s){
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

/* ====================================================
   UI æ¸²æŸ“
   ==================================================== */
function renderKwRows(){
  const c=document.getElementById('kw-rows');
  c.innerHTML='';
  S.keywords.forEach((kw,i)=>{
    const d=document.createElement('div');
    d.className='kw-row';
    d.innerHTML=`
      <span class="kw-lbl">å…³é”®è¯ ${i+1}</span>
      <div class="kw-wrap">
        <input class="kw-input" type="text" value="${esc(kw)}"
          placeholder="${i===0?'ä¸»å…³é”®è¯ï¼Œå¦‚ï¼šå†…å®¹è¥é”€':'è¾…åŠ©å…³é”®è¯ï¼ˆå¯é€‰ï¼‰'}" data-i="${i}">
        ${S.keywords.length>1?`<button class="kw-del" data-i="${i}" title="åˆ é™¤">Ã—</button>`:''}
      </div>`;
    c.appendChild(d);
  });
  c.querySelectorAll('.kw-input').forEach(el=>{
    el.addEventListener('input',e=>{
      S.keywords[+e.target.dataset.i]=e.target.value;
      updateKwStat();
    });
  });
  c.querySelectorAll('.kw-del').forEach(el=>{
    el.addEventListener('click',e=>{
      S.keywords.splice(+e.target.dataset.i,1);
      renderKwRows();
    });
  });
}

function renderH1List(){
  const c=document.getElementById('h1-list');
  c.innerHTML='';
  S.h1Options.forEach((opt,i)=>{
    const d=document.createElement('div');
    d.className='h1-opt fu';
    d.style.animationDelay=`${i*60}ms`;
    d.dataset.i=i;
    d.innerHTML=`
      <div class="h1-num">${i+1}</div>
      <div class="h1-text">${esc(opt.text)}</div>
      <div class="h1-type">${TYPE_LBL[opt.type]||opt.type}</div>`;
    d.addEventListener('click',()=>selectH1(i));
    c.appendChild(d);
  });
}

function selectH1(idx){
  document.querySelectorAll('.h1-opt').forEach(el=>el.classList.remove('sel'));
  const el=document.querySelector(`.h1-opt[data-i="${idx}"]`);
  if(el) el.classList.add('sel');
  S.selIdx=idx;
  document.getElementById('btn-confirm-h1').classList.remove('hidden');
}

function renderH2Results(){
  const listEl=document.getElementById('h2-list-el');
  listEl.innerHTML='';
  S.curH2.forEach((h2,i)=>{
    const d=document.createElement('div');
    d.className='h2-item fu';
    d.style.animationDelay=`${i*45}ms`;
    d.innerHTML=`<div class="h2-n">H2.${i+1}</div><div class="h2-t">${esc(h2)}</div>`;
    listEl.appendChild(d);
  });
  document.getElementById('md-out').textContent=buildMd(S.selH1, S.curH2);
  document.getElementById('h2-results').classList.remove('hidden');
}

function showPanel(to){
  for(let i=1;i<=3;i++){
    const s=document.getElementById(`s${i}`);
    const pEl=document.getElementById(`p${i}`);
    if(i<to){s.className='step done'; pEl.classList.remove('hidden');}
    else if(i===to){s.className='step active'; pEl.classList.remove('hidden');}
    else s.className='step';
  }
}

function addHistory(h1, h2s){
  S.history.unshift({h1, h2s:[...h2s], keywords:[...S.keywords.filter(k=>k.trim())], time:new Date()});
  renderHistory();
  updateStats();
}

function renderHistory(){
  const c=document.getElementById('hist-list');
  const badge=document.getElementById('h-badge');
  const exportBtn=document.getElementById('btn-export-all');
  badge.textContent=S.history.length;
  if(!S.history.length){
    c.innerHTML='<div class="hist-empty">æš‚æ— è®°å½•<br><br>å®Œæˆé¦–æ¬¡ç”Ÿæˆå<br>å†å²å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>';
    exportBtn.classList.add('hidden');
    return;
  }
  exportBtn.classList.remove('hidden');
  c.innerHTML='';
  S.history.forEach((item,i)=>{
    const d=document.createElement('div');
    d.className='h-item';
    const t=item.time.toLocaleTimeString('zh-CN',{hour:'2-digit',minute:'2-digit'});
    d.innerHTML=`
      <div class="h-h1">${esc(item.h1)}</div>
      <div class="h-meta">${item.h2s.length} ä¸ª H2 Â· ${t} Â· ${esc(item.keywords.join(' + '))}</div>`;
    d.addEventListener('click',()=>loadHist(i));
    c.appendChild(d);
  });
}

function loadHist(idx){
  const item=S.history[idx];
  S.selH1=item.h1;
  S.selType=detectType(item.h1);
  S.curH2=[...item.h2s];
  document.getElementById('confirmed-h1').textContent=item.h1;
  document.getElementById('confirmed-type').textContent=TYPE_LBL[S.selType]||S.selType;
  showPanel(3);
  renderH2Results();
}

function updateStats(){
  document.getElementById('sn-articles').textContent=S.history.length;
  document.getElementById('sn-titles').textContent=S.totalTitles;
  document.getElementById('sn-dedup').textContent=S.dedupBlocked;
}

function updateKwStat(){
  const kws=S.keywords.filter(k=>k.trim());
  document.getElementById('sn-kw').textContent=kws.length?kws.join(' + '):'â€”';
}

function toast(msg){
  document.querySelectorAll('.toast').forEach(e=>e.remove());
  const el=document.createElement('div');
  el.className='toast';
  el.textContent=msg;
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),2500);
}

function copyText(text, msg){
  if(navigator.clipboard){
    navigator.clipboard.writeText(text).then(()=>toast(msg));
  } else {
    const ta=document.createElement('textarea');
    ta.value=text; ta.style.cssText='position:fixed;opacity:0';
    document.body.appendChild(ta); ta.select(); document.execCommand('copy');
    document.body.removeChild(ta); toast(msg);
  }
}

/* ====================================================
   åˆå§‹åŒ– & äº‹ä»¶ç»‘å®š
   ==================================================== */
function init(){
  S.keywords=[''];
  renderKwRows();
  renderHistory();
  updateStats();

  document.getElementById('btn-add-kw').addEventListener('click',()=>{
    if(S.keywords.length>=3){toast('æœ€å¤šæ”¯æŒ 3 ä¸ªå…³é”®è¯');return;}
    S.keywords.push('');
    renderKwRows();
  });

  document.getElementById('btn-gen-h1').addEventListener('click',()=>{
    const kws=S.keywords.map(k=>k.trim()).filter(Boolean);
    if(!kws.length){toast('âš ï¸ è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªå…³é”®è¯');return;}
    S.keywords=kws;
    renderKwRows();
    updateKwStat();
    S.selIdx=-1;
    S.h1Options=genH1(kws);
    document.getElementById('kw-badge').textContent=kws.join(' + ');
    document.getElementById('btn-confirm-h1').classList.add('hidden');
    renderH1List();
    showPanel(2);
    updateStats();
    setTimeout(()=>document.getElementById('p2').scrollIntoView({behavior:'smooth',block:'nearest'}),100);
  });

  document.getElementById('btn-regen-h1').addEventListener('click',()=>{
    S.h1Options=genH1(S.keywords.filter(Boolean));
    S.selIdx=-1;
    document.getElementById('btn-confirm-h1').classList.add('hidden');
    renderH1List();
    updateStats();
    toast('ğŸ”„ H1 æ ‡é¢˜å·²æ¢ä¸€æ‰¹');
  });

  document.getElementById('btn-confirm-h1').addEventListener('click',()=>{
    if(S.selIdx<0){toast('è¯·å…ˆç‚¹å‡»é€‰æ‹©ä¸€ä¸ª H1 æ ‡é¢˜');return;}
    const opt=S.h1Options[S.selIdx];
    S.selH1=opt.text;
    S.selType=opt.type;
    addSet(opt.text);
    S.totalTitles++;
    document.getElementById('confirmed-h1').textContent=opt.text;
    document.getElementById('confirmed-type').textContent=TYPE_LBL[opt.type]||opt.type;
    document.getElementById('h2-results').classList.add('hidden');
    showPanel(3);
    updateStats();
    setTimeout(()=>document.getElementById('p3').scrollIntoView({behavior:'smooth',block:'nearest'}),100);
  });

  document.getElementById('cnt-m').addEventListener('click',()=>{
    if(S.h2Count>8){S.h2Count--; document.getElementById('cnt-v').textContent=S.h2Count;}
  });
  document.getElementById('cnt-p').addEventListener('click',()=>{
    if(S.h2Count<10){S.h2Count++; document.getElementById('cnt-v').textContent=S.h2Count;}
  });

  document.getElementById('btn-gen-h2').addEventListener('click',()=>{
    if(!S.selH1){toast('è¯·å…ˆç¡®è®¤ H1 æ ‡é¢˜');return;}
    S.curH2=genH2(S.selH1, S.keywords.filter(Boolean), S.h2Count, S.selType);
    renderH2Results();
    addHistory(S.selH1, S.curH2);
    toast('âœ… æ–‡ç« ç»“æ„å·²ç”Ÿæˆï¼');
    setTimeout(()=>document.getElementById('h2-results').scrollIntoView({behavior:'smooth',block:'nearest'}),150);
  });

  document.getElementById('btn-regen-h2').addEventListener('click',()=>{
    S.curH2=genH2(S.selH1, S.keywords.filter(Boolean), S.h2Count, S.selType);
    renderH2Results();
    toast('ğŸ”„ H2 æ ‡é¢˜å·²é‡æ–°ç”Ÿæˆ');
  });

  document.getElementById('btn-copy').addEventListener('click',()=>{
    copyText(buildMd(S.selH1, S.curH2),'ğŸ“‹ Markdown å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
  });

  document.getElementById('btn-new').addEventListener('click',()=>{
    S.selH1=''; S.selIdx=-1; S.h1Options=[]; S.curH2=[]; S.keywords=[''];
    renderKwRows(); updateKwStat();
    document.getElementById('p2').classList.add('hidden');
    document.getElementById('p3').classList.add('hidden');
    document.getElementById('h2-results').classList.add('hidden');
    document.getElementById('btn-confirm-h1').classList.add('hidden');
    for(let i=1;i<=3;i++) document.getElementById(`s${i}`).className=i===1?'step active':'step';
    document.getElementById('p1').scrollIntoView({behavior:'smooth',block:'start'});
    toast('âœ¨ å·²é‡ç½®ï¼Œå¼€å§‹æ–°æ–‡ç« ');
  });

  document.getElementById('btn-export-all').addEventListener('click',()=>{
    if(!S.history.length){toast('æš‚æ— å†å²è®°å½•');return;}
    const all=S.history.map((item,i)=>`<!-- æ–‡ç«  ${i+1} | å…³é”®è¯ï¼š${item.keywords.join(', ')} | ç±»å‹ï¼š${TYPE_LBL[detectType(item.h1)]||'æŒ‡å—å‹'} -->\n`+buildMd(item.h1,item.h2s)).join('\n\n---\n\n');
    copyText(all,`ğŸ“¦ å·²å¯¼å‡º ${S.history.length} ç¯‡æ–‡ç« ç»“æ„åˆ°å‰ªè´´æ¿`);
  });
}

init();
</script>
</body>
</html>
