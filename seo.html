<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>eSIM SEO Blog æ‰¹é‡ç”Ÿæˆå™¨ Pro</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --pri:#2563eb;--pri-d:#1d4ed8;--pri-l:#eff6ff;
  --pur:#7c3aed;--pur-d:#5b21b6;--pur-l:#f5f3ff;
  --grn:#10b981;--grn-d:#059669;--grn-l:#f0fdf4;
  --amb:#f59e0b;--amb-d:#d97706;--amb-l:#fffbeb;
  --pink:#ec4899;--pink-d:#be185d;--pink-l:#fdf2f8;
  --teal:#14b8a6;--teal-d:#0f766e;--teal-l:#f0fdfa;
  --bg:#f0f4f8;--card:#fff;--bdr:#e2e8f0;
  --txt:#1e293b;--muted:#64748b;--light:#f8fafc;
}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','PingFang SC','Microsoft YaHei',sans-serif;background:var(--bg);color:var(--txt);min-height:100vh;font-size:14px}

/* === HEADER === */
.hdr{background:linear-gradient(135deg,#0f2460,#1e3a8a 40%,#2563eb 80%,#3b82f6);color:#fff;padding:14px 24px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;box-shadow:0 2px 18px rgba(37,99,235,.4)}
.hdr-l h1{font-size:17px;font-weight:800;display:flex;align-items:center;gap:7px}
.hdr-l p{font-size:11px;opacity:.72;margin-top:3px}
.hdr-stats{display:flex;gap:6px;flex-wrap:wrap}
.stat-pill{background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.2);padding:4px 11px;border-radius:16px;font-size:11.5px;font-weight:600}
.stat-pill b{color:#fcd34d}
.main{max-width:1120px;margin:0 auto;padding:15px 13px}

/* === KEYWORD MANAGER === */
.kw-mgr{background:var(--card);border-radius:14px;box-shadow:0 1px 8px rgba(0,0,0,.07);margin-bottom:14px;overflow:hidden;border:2px solid var(--bdr);transition:border-color .25s}
.kw-mgr.has-kws{border-color:#fcd34d}
.kw-mgr-hd{padding:11px 18px;background:linear-gradient(135deg,#fffbeb,#fef3c7);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;cursor:pointer;user-select:none}
.kw-mgr-hd:hover{background:linear-gradient(135deg,#fef3c7,#fde68a)}
.kw-mgr-title{font-size:14px;font-weight:800;color:#92400e;display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.tp{display:inline-flex;align-items:center;gap:3px;padding:3px 9px;border-radius:9px;font-size:11px;font-weight:700;border:1.5px solid}
.tp-f{background:#dbeafe;color:#1d4ed8;border-color:#93c5fd}
.tp-c{background:#fdf2f8;color:#be185d;border-color:#f9a8d4}
.tp-l{background:#f0fdfa;color:#0f766e;border-color:#99f6e4}
.kw-mgr-toggle{background:var(--amb);color:#fff;border:none;border-radius:7px;padding:5px 12px;font-size:12px;font-weight:600;cursor:pointer;flex-shrink:0}
.kw-mgr-toggle:hover{background:var(--amb-d)}
.kw-summary{padding:9px 18px;background:#fffef7;border-top:1.5px solid #fde68a;display:none;align-items:center;gap:10px;flex-wrap:wrap}
.kw-summary.show{display:flex}
.sum-chip{display:flex;align-items:center;gap:5px;font-size:12px;font-weight:600;padding:3px 10px;border-radius:8px}
.sc-f{background:#dbeafe;color:#1d4ed8}
.sc-c{background:#fdf2f8;color:#be185d}
.sc-l{background:#f0fdfa;color:#0f766e}
.sum-div{color:#cbd5e1;font-size:13px}

/* Three columns */
.kw-cols{display:none;grid-template-columns:1fr 1fr 1fr;border-top:1.5px solid #fde68a}
.kw-cols.open{display:grid}
.kw-col{padding:14px 16px;border-right:1.5px solid #fde68a;background:#fffef9}
.kw-col:last-child{border-right:none}
.kw-col-hd{margin-bottom:8px}
.kw-col-title{font-size:13px;font-weight:800;display:flex;align-items:center;gap:5px;margin-bottom:2px}
.col-ico{width:21px;height:21px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0}
.ico-f{background:#dbeafe;color:#1d4ed8}
.ico-c{background:#fdf2f8;color:#be185d}
.ico-l{background:#f0fdfa;color:#0f766e}
.kw-col-lim{font-size:10px;font-weight:700;padding:2px 6px;border-radius:5px;margin-left:3px}
.lim-f{background:#dbeafe;color:#1d4ed8}
.lim-c{background:#fdf2f8;color:#be185d}
.lim-l{background:#f0fdfa;color:#0f766e}
.kw-col-desc{font-size:11px;color:var(--muted);margin-bottom:8px}
.kw-ta{width:100%;padding:9px 11px;border:1.5px solid var(--bdr);border-radius:8px;font-size:12px;line-height:1.7;resize:vertical;outline:none;min-height:110px;font-family:'Consolas',monospace;color:var(--txt);background:#fff;transition:border-color .2s,box-shadow .2s}
.kw-ta.ta-f:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1)}
.kw-ta.ta-c:focus{border-color:#ec4899;box-shadow:0 0 0 3px rgba(236,72,153,.1)}
.kw-ta.ta-l:focus{border-color:#14b8a6;box-shadow:0 0 0 3px rgba(20,184,166,.1)}
.kw-col-btns{margin-top:8px;display:flex;gap:5px;align-items:center;flex-wrap:wrap}
.bp{border:none;border-radius:7px;padding:5px 12px;font-size:12px;font-weight:600;cursor:pointer;color:#fff;transition:all .18s}
.bp-f{background:#3b82f6}.bp-f:hover{background:#2563eb}
.bp-c{background:#ec4899}.bp-c:hover{background:#be185d}
.bp-l{background:#14b8a6}.bp-l:hover{background:#0f766e}
.btn-sm-clr{background:#fff;color:var(--muted);border:1.5px solid var(--bdr);border-radius:7px;padding:5px 10px;font-size:11.5px;cursor:pointer;transition:all .18s}
.btn-sm-clr:hover{border-color:var(--muted)}
.ph{font-size:11px;font-weight:600}.ph-ok{color:var(--grn)}

/* Keyword clouds */
.cloud-wrap{margin-top:9px;display:none}
.cloud-wrap.show{display:block}
.cov-row{display:flex;align-items:center;gap:6px;margin-bottom:5px}
.cov-bg{flex:1;height:5px;background:#e2e8f0;border-radius:3px;overflow:hidden}
.cov-fill{height:100%;border-radius:3px;transition:width .4s}
.cf-f{background:linear-gradient(90deg,#3b82f6,#2563eb)}
.cf-c{background:linear-gradient(90deg,#ec4899,#be185d)}
.cf-l{background:linear-gradient(90deg,#14b8a6,#0f766e)}
.cov-pct{font-size:10.5px;font-weight:700;min-width:30px;text-align:right}
.kw-cloud{display:flex;flex-wrap:wrap;gap:4px;max-height:78px;overflow-y:auto;scrollbar-width:thin}
.kw-cloud::-webkit-scrollbar{width:4px}.kw-cloud::-webkit-scrollbar-thumb{border-radius:2px;background:#e2e8f0}
.kt{display:inline-flex;padding:2px 8px;border-radius:10px;font-size:11px;font-weight:500;white-space:nowrap;border:1.5px solid;cursor:default;transition:transform .12s;line-height:1.4}
.kt:hover{transform:scale(1.05)}
.kt-fu{background:#dbeafe;border-color:#93c5fd;color:#1d4ed8;font-weight:700}
.kt-fn{background:#f8fafc;border-color:#e2e8f0;color:#94a3b8}
.kt-cu{background:#fdf2f8;border-color:#f9a8d4;color:#be185d;font-weight:700}
.kt-cn{background:#f8fafc;border-color:#e2e8f0;color:#94a3b8}
.kt-lu{background:#f0fdfa;border-color:#99f6e4;color:#0f766e;font-weight:700}
.kt-ln{background:#f8fafc;border-color:#e2e8f0;color:#94a3b8}

/* === CONTROL PANEL === */
.ctrl{background:var(--card);border-radius:14px;padding:13px 18px;box-shadow:0 1px 8px rgba(0,0,0,.07);margin-bottom:14px;display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap}
.fg{display:flex;flex-direction:column;gap:4px}
.fg label{font-size:10.5px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.6px}
select{padding:8px 10px;border:1.5px solid var(--bdr);border-radius:8px;font-size:13px;color:var(--txt);outline:none;cursor:pointer;background:#fff;transition:border-color .2s;min-width:115px}
select:focus{border-color:var(--pri)}
.btn-grp{display:flex;gap:7px;align-items:flex-end;flex-wrap:wrap}
.btn{display:inline-flex;align-items:center;gap:5px;padding:8px 15px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;border:none;transition:all .2s;white-space:nowrap}
.btn-pri{background:linear-gradient(135deg,var(--pri),var(--pri-d));color:#fff;padding:10px 22px;font-size:14px;box-shadow:0 3px 10px rgba(37,99,235,.28)}
.btn-pri:hover{transform:translateY(-1px);box-shadow:0 5px 16px rgba(37,99,235,.4)}
.btn-out{background:#fff;color:var(--muted);border:1.5px solid var(--bdr)}
.btn-out:hover{border-color:var(--pri);color:var(--pri);background:var(--pri-l)}
.btn-grn{background:var(--grn);color:#fff}
.btn-grn:hover{background:var(--grn-d);transform:translateY(-1px)}
.btn-pur{background:linear-gradient(135deg,var(--pur),var(--pur-d));color:#fff;box-shadow:0 3px 10px rgba(124,58,237,.23)}
.btn-pur:hover{transform:translateY(-1px);box-shadow:0 5px 16px rgba(124,58,237,.36)}

/* === OUTPUT === */
.ocard{background:var(--card);border-radius:14px;box-shadow:0 1px 8px rgba(0,0,0,.07);margin-bottom:14px;overflow:hidden}
.ocard-hd{padding:12px 18px;background:var(--light);border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
.ocard-hd-l{display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.ocard-hd-r{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
.bdg{font-size:11px;font-weight:700;padding:3px 9px;border-radius:10px;color:#fff;white-space:nowrap}
.bg-pri{background:var(--pri)}.bg-grn{background:var(--grn)}.bg-amb{background:var(--amb)}.bg-pur{background:var(--pur)}
.ocard-title{font-size:14px;font-weight:700;color:#374151}
.ocard-body{padding:18px 20px}
.ocard-ft{padding:10px 18px;background:var(--light);border-top:1px solid var(--bdr);display:none;gap:6px;flex-wrap:wrap}

/* H1 block */
.h1-block{background:linear-gradient(135deg,#eff6ff,#dbeafe);border:2px solid #93c5fd;border-radius:12px;padding:13px 15px;margin-bottom:14px;display:flex;align-items:flex-start;gap:9px}
.h1-lbl{flex-shrink:0;background:var(--pri);color:#fff;font-size:9.5px;font-weight:800;padding:3px 7px;border-radius:4px;margin-top:4px}
.h1-body{flex:1;min-width:0}
.h1-txt{font-size:17px;font-weight:700;color:#1e3a8a;line-height:1.45}
.h1-meta{display:flex;gap:5px;margin-top:5px;flex-wrap:wrap;align-items:center}
.h1-len{font-size:10px;color:#3b82f6;font-weight:600}
.ki{font-size:10px;font-weight:700;padding:2px 7px;border-radius:7px;display:inline-flex;align-items:center;gap:3px}
.ki-f{background:#dbeafe;color:#1d4ed8;border:1px solid #93c5fd}
.ki-c{background:#fdf2f8;color:#be185d;border:1px solid #f9a8d4}
.ki-l{background:#f0fdfa;color:#0f766e;border:1px solid #99f6e4}
.h1-copy{flex-shrink:0;background:#fff;color:var(--pri);border:1.5px solid var(--pri);border-radius:7px;padding:4px 9px;font-size:11px;cursor:pointer;transition:all .18s;margin-top:2px}
.h1-copy:hover{background:var(--pri);color:#fff}

/* Dedup notice */
.dedup-row{display:flex;align-items:center;gap:7px;padding:7px 12px;background:#f0fdf4;border:1.5px solid #86efac;border-radius:9px;margin-bottom:12px;font-size:11.5px;color:#15803d;font-weight:600}

/* SEO bar */
.seo-bar{display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap}
.seo-tag{display:inline-flex;align-items:center;gap:3px;padding:3px 9px;border-radius:7px;font-size:11px;font-weight:600}
.so{background:#f0fdf4;border:1px solid #bbf7d0;color:#15803d}
.sw{background:#fffbeb;border:1px solid #fde68a;color:#92400e}
.si{background:#eff6ff;border:1px solid #bfdbfe;color:#1d4ed8}

/* Flow bar */
.flow-bar{display:flex;align-items:center;gap:5px;padding:8px 13px;background:linear-gradient(135deg,#f0fdf4,#dcfce7);border:1.5px solid #86efac;border-radius:10px;margin-bottom:12px;flex-wrap:wrap}
.flow-lbl{font-size:11px;font-weight:700;color:#15803d;flex-shrink:0}
.fp{display:inline-flex;align-items:center;gap:3px;font-size:10.5px;font-weight:600;padding:2px 8px;border-radius:7px;white-space:nowrap}
.fp-rch{background:#dbeafe;color:#1d4ed8;border:1px solid #93c5fd}
.fp-cmp{background:#fdf2f8;color:#be185d;border:1px solid #f9a8d4}
.fp-dec{background:#fef3c7;color:#92400e;border:1px solid #fcd34d}
.fp-act{background:#dcfce7;color:#15803d;border:1px solid #86efac}
.fp-use{background:#ede9fe;color:#5b21b6;border:1px solid #c4b5fd}
.fp-sup{background:#f1f5f9;color:#475569;border:1px solid #cbd5e1}
.flow-arr{color:#cbd5e1;font-size:9px}

/* H2 */
.h2-hd{font-size:10.5px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.6px;margin-bottom:9px;display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.h2-hd-b{font-size:10px;font-weight:700;padding:2px 8px;border-radius:8px;text-transform:none;letter-spacing:0;color:#fff}
.h2-list{display:flex;flex-direction:column;gap:7px}
.h2-item{display:flex;align-items:flex-start;gap:9px;padding:10px 12px;border:1.5px solid var(--bdr);border-radius:10px;transition:all .18s;position:relative}
.h2-item:hover{border-color:#93c5fd;background:#f0f9ff;box-shadow:0 2px 8px rgba(37,99,235,.06)}
.h2-item:not(:last-child)::after{content:'';position:absolute;left:19px;bottom:-8px;width:2px;height:8px;background:#e2e8f0;z-index:1}
.h2-num{width:24px;height:24px;background:var(--pri);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;flex-shrink:0;margin-top:2px;z-index:2;position:relative}
.h2-body{flex:1;min-width:0}
.h2-tags{display:flex;align-items:center;gap:5px;margin-bottom:4px;flex-wrap:wrap}
.cat-bdg{font-size:10px;font-weight:700;color:#fff;padding:2px 7px;border-radius:8px}
.ph-bdg{font-size:10px;font-weight:600;padding:2px 7px;border-radius:8px}
.h2-kw-tag{font-size:10px;font-weight:700;padding:2px 7px;border-radius:7px;display:inline-flex;align-items:center;gap:2px}
.h2-txt{font-size:13.5px;color:var(--txt);line-height:1.4}
.h2-len{font-size:10px;color:var(--muted);margin-top:2px}
.h2-copy{flex-shrink:0;background:none;border:1px solid var(--bdr);border-radius:6px;padding:3px 7px;font-size:11px;color:var(--muted);cursor:pointer;transition:all .18s;margin-top:2px}
.h2-copy:hover{border-color:var(--pri);color:var(--pri);background:var(--pri-l)}

/* Prompt banner */
.prompt-banner{background:linear-gradient(135deg,var(--pur-l),#ede9fe);border:2px solid #c4b5fd;border-radius:11px;padding:12px 16px;margin-top:16px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
.pb-l .pb-title{font-size:13px;font-weight:700;color:#5b21b6;display:flex;align-items:center;gap:6px}
.pb-l .pb-sub{font-size:11px;color:#7c3aed;opacity:.82;margin-top:2px}

/* Empty */
.empty{text-align:center;padding:52px 20px;color:var(--muted)}
.empty-ico{font-size:46px;margin-bottom:12px}
.empty h3{font-size:16px;color:#374151;margin-bottom:5px;font-weight:700}
.empty p{font-size:13px;line-height:1.65}

/* History */
.hist-outer{background:var(--card);border-radius:14px;box-shadow:0 1px 8px rgba(0,0,0,.07);overflow:hidden}
.hist-hd{padding:12px 18px;background:var(--light);border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;cursor:pointer;user-select:none;transition:background .18s}
.hist-hd:hover{background:#f1f5f9}
.hist-hd h3{font-size:14px;font-weight:700;color:#374151;display:flex;align-items:center;gap:8px}
.hist-body{padding:12px;display:none}
.hist-body.open{display:block}
.hist-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(255px,1fr));gap:8px}
.hist-card{border:1.5px solid var(--bdr);border-radius:10px;padding:11px 13px;cursor:pointer;transition:all .18s}
.hist-card:hover{border-color:var(--pri);background:var(--pri-l);transform:translateY(-2px);box-shadow:0 3px 12px rgba(37,99,235,.1)}
.hc-no{font-size:10.5px;font-weight:700;color:var(--pri);margin-bottom:3px}
.hc-kws{display:flex;gap:3px;flex-wrap:wrap;margin-bottom:4px}
.hc-h1{font-size:12px;font-weight:600;color:var(--txt);line-height:1.35;margin-bottom:4px}
.hc-prev{font-size:11px;color:var(--muted);line-height:1.55}

/* Modal */
.modal-ov{position:fixed;inset:0;background:rgba(15,23,42,.65);backdrop-filter:blur(5px);z-index:2000;display:flex;align-items:center;justify-content:center;padding:16px;opacity:0;pointer-events:none;transition:opacity .25s}
.modal-ov.open{opacity:1;pointer-events:all}
.modal-box{background:#fff;border-radius:18px;width:100%;max-width:900px;max-height:92vh;display:flex;flex-direction:column;box-shadow:0 24px 80px rgba(0,0,0,.3);transform:translateY(20px) scale(.97);transition:transform .28s cubic-bezier(.34,1.56,.64,1)}
.modal-ov.open .modal-box{transform:translateY(0) scale(1)}
.modal-hd{padding:14px 18px;border-bottom:1px solid #e9d5ff;display:flex;align-items:center;justify-content:space-between;background:linear-gradient(135deg,var(--pur-l),#ede9fe);border-radius:18px 18px 0 0;flex-shrink:0;gap:10px;flex-wrap:wrap}
.modal-hd-l h3{font-size:15px;font-weight:800;color:#4c1d95}
.modal-hd-l p{font-size:11px;color:#7c3aed;opacity:.8;margin-top:2px}
.modal-info{padding:9px 18px;background:#faf9ff;border-bottom:1px solid #e9d5ff;display:flex;gap:6px;flex-wrap:wrap;flex-shrink:0}
.m-st{padding:4px 11px;border-radius:8px;font-size:11px;font-weight:700}
.msp{background:var(--pur-l);border:1px solid #c4b5fd;color:#5b21b6}
.msa{background:var(--amb-l);border:1px solid #fde68a;color:#92400e}
.mst{background:var(--teal-l);border:1px solid #99f6e4;color:#0f766e}
.modal-tip{padding:7px 18px;background:#fffbeb;border-bottom:1px solid #fde68a;display:flex;align-items:center;gap:6px;flex-shrink:0;font-size:11.5px;color:#92400e;font-weight:500}
.modal-body{flex:1;overflow-y:auto;padding:15px 18px}
.prompt-ta{width:100%;padding:13px;border:2px solid #c4b5fd;border-radius:11px;font-size:12.5px;line-height:1.75;color:#1e293b;font-family:'Consolas',monospace;resize:vertical;background:#faf9ff;outline:none;min-height:400px;transition:border-color .2s}
.prompt-ta:focus{border-color:var(--pur);box-shadow:0 0 0 3px rgba(124,58,237,.11)}
.modal-ft{padding:12px 18px;border-top:1px solid #e9d5ff;display:flex;gap:6px;align-items:center;flex-wrap:wrap;background:#faf9ff;border-radius:0 0 18px 18px;flex-shrink:0}
.modal-ft-hint{margin-left:auto;font-size:11px;color:#9ca3af;font-style:italic}
.modal-cls{background:none;border:none;width:28px;height:28px;border-radius:7px;cursor:pointer;font-size:15px;color:#6b7280;display:flex;align-items:center;justify-content:center;transition:all .18s}
.modal-cls:hover{background:#e9d5ff;color:#5b21b6}

/* Toast */
.toast{position:fixed;bottom:22px;right:22px;background:#1e293b;color:#fff;padding:10px 15px;border-radius:10px;font-size:13px;font-weight:500;z-index:9999;transform:translateY(70px);opacity:0;transition:all .3s;pointer-events:none;box-shadow:0 4px 16px rgba(0,0,0,.2)}
.toast.show{transform:translateY(0);opacity:1}

/* Category colors */
.c-pur{background:#f97316}.c-act{background:#8b5cf6}.c-pri{background:#ef4444}
.c-cov{background:#10b981}.c-faq{background:#3b82f6}.c-cmp{background:#6366f1}
.c-pvd{background:#ec4899}.c-scn{background:#14b8a6}.c-tip{background:#f59e0b}
.c-rev{background:#0891b2}.c-rec{background:#65a30d}.c-pre{background:#be185d}

@media(max-width:780px){
  .kw-cols{grid-template-columns:1fr!important}
  .kw-col{border-right:none;border-bottom:1.5px solid #fde68a}
  .kw-col:last-child{border-bottom:none}
  .hdr{padding:12px 13px}.hdr-l h1{font-size:15px}
  .main{padding:10px 9px}.h1-txt{font-size:14.5px}
  .hist-grid{grid-template-columns:1fr}
  .modal-box{border-radius:14px;max-height:95vh}
}
</style>
</head>
<body>

<div class="hdr">
  <div class="hdr-l">
    <h1>ğŸŒ eSIM SEO Blog æ‰¹é‡ç”Ÿæˆå™¨ Pro</h1>
    <p>3ç±»å…³é”®è¯æ™ºèƒ½æ³¨å…¥ Â· H1å»é‡ä¿éšœ Â· è¯»è€…æ—…ç¨‹æ’åº Â· 12åˆ†ç±»156æ¨¡æ¿ Â· ä¸€é”®å†™ä½œPrompt</p>
  </div>
  <div class="hdr-stats">
    <div class="stat-pill">å·²ç”Ÿæˆ <b id="sGen">0</b> ç¯‡</div>
    <div class="stat-pill">âš¡ åŠŸèƒ½è¯ <b id="sFN">0</b></div>
    <div class="stat-pill">ğŸ† ç«å“è¯ <b id="sCN">0</b></div>
    <div class="stat-pill">ğŸ“ åœ°åŒºè¯ <b id="sLN">0</b></div>
    <div class="stat-pill">H1å”¯ä¸€ <b id="sDedup">0</b> ç¯‡</div>
  </div>
</div>

<div class="main">

  <!-- KEYWORD MANAGER -->
  <div class="kw-mgr" id="kwMgr">
    <div class="kw-mgr-hd" onclick="toggleKwMgr()">
      <div class="kw-mgr-title">
        ğŸ”‘ å…³é”®è¯åˆ†ç±»ç®¡ç†
        <span class="tp tp-f" id="pillF">åŠŸèƒ½è¯ 0</span>
        <span class="tp tp-c" id="pillC">ç«å“è¯ 0</span>
        <span class="tp tp-l" id="pillL">åœ°åŒºè¯ 0</span>
        <span id="kwHint" style="font-size:12px;color:#92400e;font-style:italic;font-weight:400">â† å¯¼å…¥å…³é”®è¯ï¼Œè‡ªåŠ¨æ³¨å…¥H1å’ŒH2æ ‡é¢˜</span>
      </div>
      <button class="kw-mgr-toggle" id="kwToggle">â–¼ å±•å¼€ç®¡ç†</button>
    </div>
    <div class="kw-summary" id="kwSummary">
      <span class="sum-chip sc-f" id="sumF">âš¡ åŠŸèƒ½è¯ 0 Â· å·²è¦†ç›– 0</span>
      <span class="sum-div">|</span>
      <span class="sum-chip sc-c" id="sumC">ğŸ† ç«å“è¯ 0 Â· å·²è¦†ç›– 0</span>
      <span class="sum-div">|</span>
      <span class="sum-chip sc-l" id="sumL">ğŸ“ åœ°åŒºè¯ 0 Â· å·²è¦†ç›– 0</span>
    </div>
    <div class="kw-cols" id="kwCols">
      <div class="kw-col">
        <div class="kw-col-hd">
          <div class="kw-col-title"><span class="col-ico ico-f">âš¡</span><span style="color:#1d4ed8">åŠŸèƒ½è¯</span><span class="kw-col-lim lim-f">å»ºè®®100ä¸ª</span></div>
          <div class="kw-col-desc">eSIMåŠŸèƒ½ã€è´­ä¹°ã€æ¿€æ´»ã€ä»·æ ¼ç­‰æ„å›¾è¯ï¼Œè‡ªåŠ¨æ³¨å…¥H1å’ŒåŠŸèƒ½ç±»H2</div>
        </div>
        <textarea class="kw-ta ta-f" id="taF" placeholder="æ¯è¡Œä¸€ä¸ªï¼Œä¾‹å¦‚ï¼š&#10;best esim for usa&#10;cheap esim usa 2026&#10;how to activate esim&#10;usa esim data plan&#10;esim iphone usa&#10;..."></textarea>
        <div class="kw-col-btns">
          <button class="bp bp-f" onclick="parseKw('func')">âœ… å¯¼å…¥åŠŸèƒ½è¯</button>
          <button class="btn-sm-clr" onclick="clearKw('func')">ğŸ—‘ æ¸…ç©º</button>
          <span class="ph ph-ok" id="phF"></span>
        </div>
        <div class="cloud-wrap" id="cwF">
          <div class="cov-row">
            <span style="font-size:11px;font-weight:600;color:#1d4ed8;min-width:48px">è¦†ç›–ç‡</span>
            <div class="cov-bg"><div class="cov-fill cf-f" id="cbF" style="width:0%"></div></div>
            <span class="cov-pct" id="cpF" style="color:#1d4ed8">0%</span>
          </div>
          <div class="kw-cloud" id="cloudF"></div>
        </div>
      </div>
      <div class="kw-col">
        <div class="kw-col-hd">
          <div class="kw-col-title"><span class="col-ico ico-c">ğŸ†</span><span style="color:#be185d">ç«å“è¯</span><span class="kw-col-lim lim-c">å»ºè®®10ä¸ª</span></div>
          <div class="kw-col-desc">ç«äº‰å“ç‰Œã€å¯¹æ¯”è¯ã€ç«å“ç›¸å…³æœç´¢è¯ï¼Œæ³¨å…¥å¯¹æ¯”å’Œè¯„æµ‹ç±»H2</div>
        </div>
        <textarea class="kw-ta ta-c" id="taC" placeholder="æ¯è¡Œä¸€ä¸ªï¼Œä¾‹å¦‚ï¼š&#10;Airalo esim review&#10;Holafly vs Airalo&#10;Nomad esim alternative&#10;Saily esim&#10;..."></textarea>
        <div class="kw-col-btns">
          <button class="bp bp-c" onclick="parseKw('comp')">âœ… å¯¼å…¥ç«å“è¯</button>
          <button class="btn-sm-clr" onclick="clearKw('comp')">ğŸ—‘ æ¸…ç©º</button>
          <span class="ph ph-ok" id="phC"></span>
        </div>
        <div class="cloud-wrap" id="cwC">
          <div class="cov-row">
            <span style="font-size:11px;font-weight:600;color:#be185d;min-width:48px">è¦†ç›–ç‡</span>
            <div class="cov-bg"><div class="cov-fill cf-c" id="cbC" style="width:0%"></div></div>
            <span class="cov-pct" id="cpC" style="color:#be185d">0%</span>
          </div>
          <div class="kw-cloud" id="cloudC"></div>
        </div>
      </div>
      <div class="kw-col">
        <div class="kw-col-hd">
          <div class="kw-col-title"><span class="col-ico ico-l">ğŸ“</span><span style="color:#0f766e">åœ°åŒºè¯</span><span class="kw-col-lim lim-l">å»ºè®®50ä¸ª</span></div>
          <div class="kw-col-desc">å…·ä½“åŸå¸‚ã€åœ°åŒºã€æ™¯ç‚¹æœç´¢è¯ï¼Œæ³¨å…¥è¦†ç›–å’Œåœºæ™¯ç±»H2</div>
        </div>
        <textarea class="kw-ta ta-l" id="taL" placeholder="æ¯è¡Œä¸€ä¸ªï¼Œä¾‹å¦‚ï¼š&#10;esim new york&#10;esim las vegas&#10;chicago esim&#10;esim manhattan&#10;..."></textarea>
        <div class="kw-col-btns">
          <button class="bp bp-l" onclick="parseKw('loc')">âœ… å¯¼å…¥åœ°åŒºè¯</button>
          <button class="btn-sm-clr" onclick="clearKw('loc')">ğŸ—‘ æ¸…ç©º</button>
          <span class="ph ph-ok" id="phL"></span>
        </div>
        <div class="cloud-wrap" id="cwL">
          <div class="cov-row">
            <span style="font-size:11px;font-weight:600;color:#0f766e;min-width:48px">è¦†ç›–ç‡</span>
            <div class="cov-bg"><div class="cov-fill cf-l" id="cbL" style="width:0%"></div></div>
            <span class="cov-pct" id="cpL" style="color:#0f766e">0%</span>
          </div>
          <div class="kw-cloud" id="cloudL"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- CONTROL -->
  <div class="ctrl">
    <div class="fg">
      <label>ç›®æ ‡åœ°åŒº</label>
      <select id="selDest">
        <option value="usa">ğŸ‡ºğŸ‡¸ ç¾å›½</option>
        <option value="uk">ğŸ‡¬ğŸ‡§ è‹±å›½</option>
        <option value="japan">ğŸ‡¯ğŸ‡µ æ—¥æœ¬</option>
        <option value="europe">ğŸ‡ªğŸ‡º æ¬§æ´²</option>
        <option value="thailand">ğŸ‡¹ğŸ‡­ æ³°å›½</option>
        <option value="korea">ğŸ‡°ğŸ‡· éŸ©å›½</option>
        <option value="russia">ğŸ‡·ğŸ‡º ä¿„ç½—æ–¯</option>
      </select>
    </div>
    <div class="fg">
      <label>å¹´ä»½</label>
      <select id="selYear"><option value="2026">2026</option><option value="2025">2025</option></select>
    </div>
    <div class="fg">
      <label>H2 æ•°é‡</label>
      <select id="selH2n"><option value="8">8 ä¸ª</option><option value="10">10 ä¸ª</option><option value="12">12 ä¸ª</option></select>
    </div>
    <div class="fg">
      <label>ç”Ÿæˆæ•°é‡</label>
      <select id="selBatch"><option value="1">å•ç¯‡</option><option value="3">3 ç¯‡</option><option value="5">5 ç¯‡</option><option value="10">10 ç¯‡</option></select>
    </div>
    <div class="btn-grp">
      <button class="btn btn-pri" onclick="generate()">âš¡ ç”Ÿæˆç»“æ„</button>
      <button class="btn btn-out" onclick="doReset()">ğŸ”„ é‡ç½®</button>
      <button class="btn btn-grn" id="btnExpAll" onclick="exportAll()" style="display:none">ğŸ“¥ å¯¼å‡ºå…¨éƒ¨</button>
    </div>
  </div>

  <!-- OUTPUT -->
  <div class="ocard">
    <div class="ocard-hd">
      <div class="ocard-hd-l">
        <span class="bdg bg-pri" id="bdgGen" style="display:none">ç¬¬ 1 ç¯‡</span>
        <span class="bdg bg-amb" id="bdgKw" style="display:none">ğŸ”‘ å…³é”®è¯å·²æ³¨å…¥</span>
        <span class="bdg bg-grn" id="bdgDed" style="display:none">âœ“ æ ‡é¢˜å”¯ä¸€</span>
        <span class="ocard-title">SEO Blog æ–‡ç« ç»“æ„</span>
      </div>
      <div class="ocard-hd-r">
        <button class="btn btn-pur" id="btnPrompt" onclick="generatePrompt()" style="display:none;padding:6px 12px;font-size:12px">ğŸ“ ç”ŸæˆPrompt</button>
        <button class="btn btn-out" id="btnCopySet" onclick="copySet()" style="display:none;padding:6px 12px;font-size:12px">ğŸ“‹ å¤åˆ¶æœ¬ç¯‡</button>
      </div>
    </div>
    <div class="ocard-body" id="outputBody">
      <div class="empty">
        <div class="empty-ico">âœ¨</div>
        <h3>ç‚¹å‡»ã€Œç”Ÿæˆç»“æ„ã€å¼€å§‹æ‰¹é‡äº§å‡º</h3>
        <p>å…ˆåœ¨ä¸Šæ–¹å¯¼å…¥3ç±»å…³é”®è¯ï¼ˆåŠŸèƒ½è¯Â·ç«å“è¯Â·åœ°åŒºè¯ï¼‰<br>ç³»ç»Ÿè‡ªåŠ¨å°†å…³é”®è¯æ³¨å…¥H1ä¸»æ ‡é¢˜å’Œå¯¹åº”ç±»å‹çš„H2æ ‡é¢˜<br>H1å…¨å±€å»é‡ Â· æ ‡é¢˜æŒ‰è¯»è€…æ—…ç¨‹é€»è¾‘æ’åº Â· æ”¯æŒæ‰¹é‡ç”Ÿæˆ</p>
      </div>
    </div>
    <div class="ocard-ft" id="oFt">
      <button class="btn btn-pri" onclick="generate()" style="font-size:13px;padding:9px 18px">âš¡ ç»§ç»­ç”Ÿæˆ</button>
      <button class="btn btn-out" onclick="copySet()">ğŸ“‹ å¤åˆ¶æœ¬ç¯‡</button>
      <button class="btn btn-out" onclick="exportCurrent()">ğŸ“¤ å¯¼å‡ºæœ¬ç¯‡</button>
      <button class="btn btn-pur" onclick="generatePrompt()">ğŸ“ å†™ä½œPrompt</button>
    </div>
  </div>

  <!-- HISTORY -->
  <div class="hist-outer" id="histSec" style="display:none">
    <div class="hist-hd" onclick="toggleHist()">
      <h3>ğŸ“š å†å²è®°å½• <span id="histCnt" style="color:var(--pri)">0</span> ç¯‡</h3>
      <span id="histArr" style="font-size:12px;color:var(--muted)">â–¼ å±•å¼€</span>
    </div>
    <div class="hist-body" id="histBody">
      <div class="hist-grid" id="histGrid"></div>
    </div>
  </div>
</div>

<!-- PROMPT MODAL -->
<div class="modal-ov" id="pModal" onclick="closeModalBg(event)">
  <div class="modal-box">
    <div class="modal-hd">
      <div class="modal-hd-l">
        <h3>ğŸ“ SEO å†™ä½œ Prompt ç”Ÿæˆå™¨</h3>
        <p>å¤åˆ¶åˆ° ChatGPT / Claude / Gemini â†’ ä¸€é”®ç”Ÿæˆå®Œæ•´ SEO æ–‡ç« </p>
      </div>
      <div style="display:flex;gap:7px;align-items:center">
        <button class="btn btn-pur" onclick="copyPrompt()" style="padding:7px 13px;font-size:12px">ğŸ“‹ å¤åˆ¶</button>
        <button class="modal-cls" onclick="closeModal()">âœ•</button>
      </div>
    </div>
    <div class="modal-info" id="mInfo"><span class="m-st msp">åŠ è½½ä¸­...</span></div>
    <div class="modal-tip">ğŸ’¡ å®Œæ•´å¤åˆ¶ Prompt â†’ ç²˜è´´åˆ° AI â†’ è‡ªåŠ¨ç”Ÿæˆ 2500-3500 å­— SEO æ–‡ç« ï¼Œ3ç±»å…³é”®è¯è‡ªç„¶æ¤å…¥</div>
    <div class="modal-body">
      <textarea class="prompt-ta" id="promptTa" readonly onclick="this.select()"></textarea>
    </div>
    <div class="modal-ft">
      <button class="btn btn-pur" onclick="copyPrompt()">ğŸ“‹ å¤åˆ¶ Prompt</button>
      <button class="btn btn-out" onclick="exportPrompt()">ğŸ“¤ å¯¼å‡º TXT</button>
      <button class="btn btn-out" onclick="closeModal()">âœ• å…³é—­</button>
      <span class="modal-ft-hint">ç‚¹å‡»æ–‡æœ¬åŒº â†’ Ctrl+A å…¨é€‰</span>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ============================================================
// DATABASE
// ============================================================
var DB = {
  usa:{kw:'ç¾å›½eSIM',name:'ç¾å›½',
    cities:['çº½çº¦','æ´›æ‰çŸ¶','æ‹‰æ–¯ç»´åŠ æ–¯','æ—§é‡‘å±±','èŠåŠ å“¥','è¿ˆé˜¿å¯†','æ³¢å£«é¡¿','è¥¿é›…å›¾','å¥¥å…°å¤š','åç››é¡¿DC'],
    carriers:['T-Mobile','AT&T','Verizon','Mint Mobile','Visible','Google Fi','US Mobile'],
    providers:['Airalo','Holafly','Nomad','Saily','Maya Mobile','GigSky','Ubigi'],
    parks:['é»„çŸ³å…¬å›­','å¤§å³¡è°·','ä¼˜èƒœç¾åœ°','å¤§çƒŸå±±','ç§‘ç½—æ‹‰å¤šé«˜åŸ'],
    userTypes:['æ—…è¡Œè€…','å•†åŠ¡äººå£«','ç•™å­¦ç”Ÿ','è‡ªç”±è¡Œæ—…å®¢','èƒŒåŒ…å®¢','åäººæ¸¸å®¢','æ•°å­—æ¸¸æ°‘'],
    scenes:['çŸ­é€”æ—…æ¸¸','å•†åŠ¡å‡ºå·®','é•¿æœŸç•™å­¦','è‡ªé©¾æ¸¸','èƒŒåŒ…æ—…è¡Œ','å®¶åº­å‡ºæ¸¸'],
    durations:['3å¤©','5å¤©','7å¤©','10å¤©','14å¤©','30å¤©','90å¤©'],
    issues:['ä¿¡å·ä¸ç¨³å®š','æ¿€æ´»å¤±è´¥','è¶…é¢æ”¶è´¹','ç½‘é€Ÿè¿‡æ…¢','è®¾å¤‡ä¸å…¼å®¹','å¥—é¤åˆ°æœŸ']},
  uk:{kw:'è‹±å›½eSIM',name:'è‹±å›½',
    cities:['ä¼¦æ•¦','æ›¼å½»æ–¯ç‰¹','çˆ±ä¸å ¡','åˆ©ç‰©æµ¦','ç‰›æ´¥','å‰‘æ¡¥','ä¼¯æ˜ç¿°','æ ¼æ‹‰æ–¯å“¥'],
    carriers:['EE','O2','Vodafone','Three UK','Sky Mobile'],
    providers:['Airalo','Holafly','Nomad','Saily','Three UK','GigSky'],
    parks:['æ¹–åŒº','çº¦å…‹éƒ¡','å³°åŒº','è‹æ ¼å…°é«˜åœ°','æ–¯è¯ºç™»å°¼äºš'],
    userTypes:['æ—…è¡Œè€…','å•†åŠ¡äººå£«','ç•™å­¦ç”Ÿ','èƒŒåŒ…å®¢','åäººæ¸¸å®¢'],
    scenes:['çŸ­é€”æ—…æ¸¸','å•†åŠ¡å‡ºå·®','ç•™å­¦','è‡ªé©¾æ¸¸','èƒŒåŒ…æ—…è¡Œ'],
    durations:['3å¤©','5å¤©','7å¤©','10å¤©','14å¤©','30å¤©'],
    issues:['ä¿¡å·ä¸ç¨³å®š','æ¿€æ´»å¤±è´¥','è¶…é¢æ”¶è´¹','ç½‘é€Ÿè¿‡æ…¢']},
  japan:{kw:'æ—¥æœ¬eSIM',name:'æ—¥æœ¬',
    cities:['ä¸œäº¬','å¤§é˜ª','äº¬éƒ½','åŒ—æµ·é“','å†²ç»³','åå¤å±‹','æ¨ªæ»¨','ç¦å†ˆ'],
    carriers:['NTT Docomo','SoftBank','au (KDDI)','Rakuten Mobile'],
    providers:['Airalo','Holafly','IIJmio','GTN Mobile','Nomad','Saily'],
    parks:['å¯Œå£«å±±','æ—¥å…‰å›½ç«‹å…¬å›­','çŸ¥åºŠåŠå²›','å±‹ä¹…å²›','è¥¿è¡¨å²›'],
    userTypes:['æ—…è¡Œè€…','åŠ¨æ¼«çˆ±å¥½è€…','ç¾é£Ÿæ—…è¡Œè€…','æ‘„å½±çˆ±å¥½è€…','å•†åŠ¡äººå£«'],
    scenes:['è§‚å…‰æ—…æ¸¸','ç¾é£Ÿä¹‹æ—…','åŠ¨æ¼«åœ£åœ°å·¡ç¤¼','å•†åŠ¡å‡ºå·®','èœœæœˆæ—…è¡Œ'],
    durations:['5å¤©','7å¤©','10å¤©','14å¤©','30å¤©'],
    issues:['æ¿€æ´»å¤±è´¥','é™é€Ÿé—®é¢˜','æµé‡ä¸è¶³','è®¾å¤‡ä¸å…¼å®¹']},
  europe:{kw:'æ¬§æ´²eSIM',name:'æ¬§æ´²',
    cities:['å·´é»','ç½—é©¬','å·´å¡ç½—é‚£','é˜¿å§†æ–¯ç‰¹ä¸¹','æŸæ—','ç»´ä¹Ÿçº³','å¸ƒæ‹‰æ ¼','è‹é»ä¸–'],
    carriers:['Vodafone','Orange','Deutsche Telekom','Three','O2'],
    providers:['Airalo','Holafly','Nomad','Saily','Global Yo','OneSimCard'],
    parks:['é˜¿å°”å‘æ–¯å±±åŒº','å¤šç‘™æ²³æµåŸŸ','åœ°ä¸­æµ·æ²¿å²¸','åŒ—æ¬§å³¡æ¹¾'],
    userTypes:['æ—…è¡Œè€…','èƒŒåŒ…å®¢','å•†åŠ¡äººå£«','èœœæœˆæ—…è¡Œè€…','ç•™å­¦ç”Ÿ'],
    scenes:['å¤šå›½æ—…è¡Œ','è·¨å¢ƒå•†åŠ¡','è‡ªé©¾æ¸¸','é“è·¯æ—…è¡Œ','ç•™å­¦'],
    durations:['7å¤©','14å¤©','21å¤©','30å¤©','60å¤©'],
    issues:['å¤šå›½åˆ‡æ¢é—®é¢˜','ä¿¡å·ä¸ç¨³å®š','æ¿€æ´»å¤±è´¥','è¦†ç›–ä¸å…¨']},
  thailand:{kw:'æ³°å›½eSIM',name:'æ³°å›½',
    cities:['æ›¼è°·','æ™®å‰å²›','æ¸…è¿ˆ','èŠ­æé›…','è‹æ¢…å²›','åæ¬£','å–€æ¯”'],
    carriers:['AIS','DTAC','TrueMove H','NT Mobile'],
    providers:['Airalo','Holafly','AIS SIM2Fly','Nomad','Saily'],
    parks:['è€ƒè‰¾å›½å®¶å…¬å›­','å®‰è¾¾æ›¼æµ·','è‹æ¢…å²›','æ–¯ç±³å…°ç¾¤å²›'],
    userTypes:['æ—…è¡Œè€…','åº¦å‡æ—…å®¢','èƒŒåŒ…å®¢','å•†åŠ¡äººå£«','èœœæœˆæ—…è¡Œè€…'],
    scenes:['æµ·å²›åº¦å‡','åŸå¸‚è§‚å…‰','ç¾é£Ÿä¹‹æ—…','å•†åŠ¡å‡ºå·®'],
    durations:['3å¤©','5å¤©','7å¤©','10å¤©','14å¤©','30å¤©'],
    issues:['ä¿¡å·ä¸ç¨³å®š','æ¿€æ´»å¤±è´¥','æµé‡é™é€Ÿ','æµ·å²›è¦†ç›–å·®']},
  korea:{kw:'éŸ©å›½eSIM',name:'éŸ©å›½',
    cities:['é¦–å°”','é‡œå±±','æµå·å²›','ä»å·','å¤§é‚±','æ°´åŸ','åº†å·'],
    carriers:['SK Telecom','KT','LG U+','SK7Mobile'],
    providers:['Airalo','Holafly','SKT eSIM','KT eSIM','Nomad','Saily'],
    parks:['æ±‰æ‹¿å±±','é›ªå²³å±±','æ™ºå¼‚å±±','åŒ—æ±‰å±±'],
    userTypes:['è¿½æ˜Ÿæ—','æ—…è¡Œè€…','ç¾é£Ÿçˆ±å¥½è€…','ç•™å­¦ç”Ÿ','å•†åŠ¡äººå£«'],
    scenes:['è¿½æ˜Ÿæ—…è¡Œ','ç¾é£Ÿä¹‹æ—…','è´­ç‰©æ—…æ¸¸','æ–‡åŒ–ä½“éªŒ','ç•™å­¦'],
    durations:['3å¤©','5å¤©','7å¤©','10å¤©','14å¤©'],
    issues:['é™é€Ÿé—®é¢˜','æ¿€æ´»å¤±è´¥','æµé‡ä¸è¶³','æ‰‹æœºé”ç½‘']},
  russia:{kw:'ä¿„ç½—æ–¯eSIM',name:'ä¿„ç½—æ–¯',
    cities:['è«æ–¯ç§‘','åœ£å½¼å¾—å ¡','å¶å¡æ·ç³å ¡','æ–°è¥¿ä¼¯åˆ©äºš','å–€å±±','ç´¢å¥‘','ç¬¦æ‹‰è¿ªæ²ƒæ–¯æ‰˜å…‹','ä¼Šå°”åº“èŒ¨å…‹'],
    carriers:['MTS','Beeline','MegaFon','Tele2 Russia','Yota','Rostelecom'],
    providers:['Airalo','Holafly','Nomad','Saily','SimOptions','GigSky','OneSimCard'],
    parks:['è´åŠ å°”æ¹–','å ªå¯ŸåŠ ç«å±±','é˜¿å°”æ³°é‡‘å±±','è¥¿ä¼¯åˆ©äºšå¤§è‰åŸ','ç§‘ç±³åŸå§‹æ£®æ—'],
    userTypes:['æ—…è¡Œè€…','å•†åŠ¡äººå£«','ç•™å­¦ç”Ÿ','æ¢é™©æ—…è¡Œè€…','æ‘„å½±çˆ±å¥½è€…','æ–‡åŒ–æ—…æ¸¸è€…'],
    scenes:['åŸå¸‚è§‚å…‰','å•†åŠ¡å‡ºå·®','è¥¿ä¼¯åˆ©äºšé“è·¯ä¹‹æ—…','å†¬å­£æ—…è¡Œ','æ–‡åŒ–ä½“éªŒæ¸¸','ç•™å­¦'],
    durations:['3å¤©','5å¤©','7å¤©','14å¤©','30å¤©','90å¤©'],
    issues:['ç½‘ç»œè®¿é—®å—é™','æ¿€æ´»æ­¥éª¤å¤æ‚','è¦†ç›–ä¸å‡åŒ€','é€Ÿåº¦ä¸ç¨³å®š','æ”¯ä»˜æ–¹å¼å—é™']}
};

var DEVICES = ['iPhone','å®‰å“æ‰‹æœº','ä¸‰æ˜ŸGalaxy','iPhone 16 Pro','è°·æ­ŒPixel','å°ç±³æ‰‹æœº'];
var COUNTS = ['3','5','6','7','8','10'];
var TOPICS = ['ä»·æ ¼ä¸è¦†ç›–å…¨æ','è´­ä¹°æ¿€æ´»æ”»ç•¥','å¥—é¤æ·±åº¦æ¨è','å®åœ°æµ‹è¯„æŠ¥å‘Š','çœé’±å®Œå…¨æŒ‡å—','çœŸå®ä½¿ç”¨è¯„æµ‹'];

// ============================================================
// LOGICAL ORDERING & PHASE MAPPING
// ============================================================
var CAT_ORDER = ['review','comparison','price','coverage','provider','recommend','purchase','prepare','activation','scenario','tips','faq'];

var CAT_PHASE = {
  review:     {phase:'è®¤çŸ¥ç ”ç©¶', cls:'fp-rch', icon:'ğŸ”'},
  comparison: {phase:'æ¯”è¾ƒç­›é€‰', cls:'fp-cmp', icon:'âš–ï¸'},
  price:      {phase:'æ¯”è¾ƒç­›é€‰', cls:'fp-cmp', icon:'âš–ï¸'},
  coverage:   {phase:'æ¯”è¾ƒç­›é€‰', cls:'fp-cmp', icon:'âš–ï¸'},
  provider:   {phase:'æ¯”è¾ƒç­›é€‰', cls:'fp-cmp', icon:'âš–ï¸'},
  recommend:  {phase:'å†³ç­–ç¡®å®š', cls:'fp-dec', icon:'âœ…'},
  purchase:   {phase:'è´­ä¹°è¡ŒåŠ¨', cls:'fp-act', icon:'ğŸ›’'},
  prepare:    {phase:'è´­ä¹°è¡ŒåŠ¨', cls:'fp-act', icon:'ğŸ›’'},
  activation: {phase:'æ¿€æ´»ä½¿ç”¨', cls:'fp-use', icon:'ğŸ“±'},
  scenario:   {phase:'æ¿€æ´»ä½¿ç”¨', cls:'fp-use', icon:'ğŸ“±'},
  tips:       {phase:'æ¿€æ´»ä½¿ç”¨', cls:'fp-use', icon:'ğŸ“±'},
  faq:        {phase:'è§£æƒ‘æ”¯æŒ', cls:'fp-sup', icon:'ğŸ’¬'}
};

// ============================================================
// CATEGORY TEMPLATES
// kwType: 'func' | 'comp' | 'loc'
// tStd: standard templates  tKw: keyword-injected ({injKw})
// ============================================================
var CATS = {
  purchase:{name:'è´­ä¹°æŒ‡å—',cls:'c-pur',kwType:'func',
    tStd:[
      '{kw}å¦‚ä½•è´­ä¹°ï¼Ÿ{year}åœ¨çº¿è´­ä¹°å®Œæ•´æ­¥éª¤è¯¦è§£',
      'è´­ä¹°{kw}å‰å¿…çŸ¥çš„{cnt}å¤§å…³é”®äº‹é¡¹',
      '{kw}å“ªé‡Œä¹°æœ€åˆ’ç®—ï¼Ÿå®˜ç½‘vsç¬¬ä¸‰æ–¹å¹³å°å…¨å¯¹æ¯”',
      '{p1}è´­ä¹°æ•™ç¨‹ï¼šä»æ³¨å†Œåˆ°ä¸‹å•å›¾æ–‡æ­¥éª¤è§£æ',
      '{kw}è´­ä¹°æ”»ç•¥ï¼š{dur}å¥—é¤å“ªæ¬¾æœ€å€¼',
      '{kw}è´­ä¹°åå¤šä¹…åˆ°è´¦ï¼Ÿä»ä¸‹å•åˆ°æ¿€æ´»å…¨æµç¨‹'
    ],
    tKw:[
      '{injKw}è´­ä¹°å®Œæ•´æ•™ç¨‹ï¼š{year}ä¸»æµæ¸ é“æ“ä½œæ­¥éª¤å…¨æŒ‡å—',
      '{injKw}å“ªé‡Œä¹°æœ€ä¾¿å®œï¼Ÿå®˜ç½‘ä¸ç¬¬ä¸‰æ–¹å¹³å°ä»·æ ¼æ¨ªå‘å¯¹æ¯”',
      'å¦‚ä½•è´­ä¹°{injKw}ï¼Ÿå›¾æ–‡æ­¥éª¤ä»æ³¨å†Œåˆ°æ¿€æ´»ä¸€æ­¥è¯¦è§£',
      '{injKw}è´­ä¹°å‰å¿…çœ‹ï¼š{cnt}ä¸ªé¿å‘å…³é”®è¦ç‚¹å…¨è§£æ',
      '{injKw}å›½å†…æå‰è´­ä¹°vsåˆ°è¾¾åè´­ä¹°ï¼šå“ªç§æ–¹æ¡ˆæ›´åˆ’ç®—'
    ]},
  activation:{name:'æ¿€æ´»æ•™ç¨‹',cls:'c-act',kwType:'func',
    tStd:[
      '{kw}æ¿€æ´»å…¨æ”»ç•¥ï¼š{device}é€æ­¥æ“ä½œå®Œæ•´æ•™ç¨‹',
      '{kw}æ¿€æ´»å¤±è´¥æ€ä¹ˆåŠï¼Ÿå¸¸è§åŸå› ä¸è§£å†³æ–¹æ¡ˆ',
      '{device}ä½¿ç”¨{kw}è®¾ç½®æ•™ç¨‹ï¼šä»ä¸‹è½½åˆ°æ¿€æ´»å…¨ç¨‹å›¾è§£',
      '{kw}äºŒç»´ç æ‰«ææ¿€æ´»è¯¦ç»†æ­¥éª¤ä¸æ³¨æ„äº‹é¡¹'
    ],
    tKw:[
      '{injKw}æ¿€æ´»å®Œæ•´æ•™ç¨‹ï¼š{device}é€æ­¥æ“ä½œå›¾æ–‡è¯¦è§£',
      'æ¿€æ´»{injKw}å¤±è´¥ï¼Ÿ{cnt}ç§å¸¸è§é”™è¯¯åŸå› ä¸è§£å†³æ–¹æ¡ˆ',
      '{device}å¦‚ä½•æ¿€æ´»{injKw}ï¼Ÿä»æ‰«ç åˆ°æ­£å¸¸è”ç½‘å…¨æµç¨‹',
      '{injKw}æ¿€æ´»æ—¶æœºé€‰æ‹©ï¼šå‡ºå‘å‰è¿˜æ˜¯è½åœ°åæ¿€æ´»æ›´åˆé€‚'
    ]},
  price:{name:'ä»·æ ¼å¯¹æ¯”',cls:'c-pri',kwType:'func',
    tStd:[
      '{year}{kw}ä»·æ ¼å…¨å¯¹æ¯”ï¼š{c1} vs {c2}',
      '{kw}{dur}å¥—é¤è´¹ç”¨åˆ†æï¼šå“ªå®¶æœ€åˆ’ç®—',
      '{kw}éšè—è´¹ç”¨æ­ç§˜ï¼šå®é™…ä½¿ç”¨æˆæœ¬å…¨è§£æ',
      '{kw} vs å›½é™…æ¼«æ¸¸ï¼šå“ªä¸ªæ›´çœé’±ï¼Ÿè´¹ç”¨å…¨å¯¹æ¯”'
    ],
    tKw:[
      '{injKw}ä»·æ ¼æ·±åº¦åˆ†æï¼š{year}å„å¤§å¹³å°å¥—é¤è´¹ç”¨æ¨ªå‘å…¨å¯¹æ¯”',
      '{injKw}å¤šå°‘é’±åˆç†ï¼Ÿ{dur}å‡ºè¡Œå¥—é¤æ€§ä»·æ¯”è¯„æµ‹æŠ¥å‘Š',
      '{injKw}éšè—è´¹ç”¨å…¨æ­ç§˜ï¼šå®é™…æ€»èŠ±è´¹ä¸å®˜æ–¹æ ‡ä»·å·®è·åˆ†æ',
      '{injKw}æŠ˜æ‰£ç ä¸ä¼˜æƒ ï¼š{year}æœ€æ–°çœé’±è´­ä¹°é€”å¾„å¤§æ±‡æ€»'
    ]},
  coverage:{name:'ç½‘é€Ÿè¦†ç›–',cls:'c-cov',kwType:'loc',
    tStd:[
      '{kw}ç½‘é€Ÿå®æµ‹ï¼š{city} 5G/4G LTEè¦†ç›–æµ‹è¯•æŠ¥å‘Š',
      '{dest}å„åœ°åŒº{kw}ä¿¡å·è¦†ç›–åœ°å›¾ä¸å®æµ‹åˆ†æ',
      '{c1}ä¸{c2} {kw}çœŸå®ç½‘é€Ÿæ¨ªå‘å¯¹æ¯”æµ‹è¯•',
      '{city}åœ°é“å’Œå®¤å†…{kw}ä¿¡å·è¡¨ç°å®æµ‹æŠ¥å‘Š'
    ],
    tKw:[
      '{injKw} eSIMä¿¡å·å®æµ‹ï¼šè¦†ç›–èŒƒå›´ã€ç½‘é€Ÿä¸ç¨³å®šæ€§å…¨æŠ¥å‘Š',
      'å»{injKw}ç”¨ä»€ä¹ˆeSIMæœ€å¥½ï¼Ÿä¿¡å·æµ‹è¯•ä¸å¥—é¤ç²¾é€‰æ¨è',
      '{injKw}åœ°åŒº5G/4G LTEæ·±åº¦æµ‹è¯•ï¼šåŸåŒºvséƒŠåŒºä¿¡å·å¯¹æ¯”',
      '{injKw}æ—…è¡ŒeSIMæ¨èï¼šå½“åœ°å®æµ‹æœ€ä½³ä¿¡å·æ–¹æ¡ˆæŒ‡å—'
    ]},
  faq:{name:'å¸¸è§é—®é¢˜',cls:'c-faq',kwType:'func',
    tStd:[
      '{kw}å¸¸è§é—®é¢˜è§£ç­”ï¼šæ–°æ‰‹æœ€æƒ³çŸ¥é“çš„{cnt}ä¸ªç–‘é—®',
      '{kw}èƒ½æ‰“ç”µè¯å‘çŸ­ä¿¡å—ï¼ŸåŠŸèƒ½è¯¦è§£ä¸æ³¨æ„äº‹é¡¹',
      'eSIMå’Œå®ä½“SIMæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ{year}æ·±åº¦è§£æ',
      '{kw}å®‰å…¨å—ï¼Ÿæ•°æ®éšç§ä¸ä½¿ç”¨å®‰å…¨å…¨è§£æ'
    ],
    tKw:[
      '{injKw}å¸¸è§é—®é¢˜è§£ç­”ï¼š{cnt}ä¸ªç”¨æˆ·æœ€é¢‘ç¹å’¨è¯¢çš„ç–‘é—®æƒå¨è§£ç­”',
      'å…³äº{injKw}çš„{cnt}å¤§å¸¸è§è¯¯åŒºï¼šä¸“å®¶é€ä¸€çº æ­£è¯¦è§£',
      '{injKw}ä½¿ç”¨å…¨æŒ‡å—ï¼šåŠŸèƒ½é™åˆ¶ã€æ³¨æ„äº‹é¡¹ä¸å®ç”¨å»ºè®®',
      '{injKw}æ•°æ®å®‰å…¨è§£æï¼šéšç§ä¿æŠ¤ä¸ç½‘ç»œå®‰å…¨æ€§å…¨é¢è¯„ä¼°'
    ]},
  comparison:{name:'äº§å“å¯¹æ¯”',cls:'c-cmp',kwType:'comp',
    tStd:[
      '{p1} vs {p2}ï¼š{kw}æ·±åº¦æ¨ªå‘è¯„æµ‹',
      '{kw} vs å®ä½“SIMï¼š{year}å®é™…ä½¿ç”¨ä½“éªŒå…¨é¢å¯¹æ¯”',
      'é¡¶çº§{kw}æä¾›å•†å¤§å¯¹æ¯”ï¼šè¦†ç›–ã€ä»·æ ¼ã€æœåŠ¡ç»¼åˆè¯„åˆ†',
      '{kw}ä¸‰å¤§ä¸»æµæ–¹æ¡ˆæ¨ªè¯„ï¼šæœ€é€‚åˆ{userType}çš„é€‰æ‹©'
    ],
    tKw:[
      '{injKw}ä¸ä¸»æµç«äº‰å¯¹æ‰‹å…¨é¢å¯¹æ¯”ï¼š{year}æ¨ªå‘ç»¼åˆè¯„æµ‹æŠ¥å‘Š',
      '{injKw} vs å…¶ä»–eSIMæ–¹æ¡ˆï¼š{dest}å‡ºè¡Œå“ªä¸ªé€‰æ‹©æ›´ä¼˜',
      '{injKw}ä¸ä¼ ç»Ÿå®ä½“SIMçš„åŒºåˆ«ï¼šåŠŸèƒ½ã€ä¾¿åˆ©æ€§ä¸æˆæœ¬æ·±åº¦å¯¹æ¯”',
      '{injKw}å¯¹æ¯”è¯„æµ‹ï¼šä»·æ ¼ã€ç½‘é€Ÿã€å®¢æœå…¨æ–¹ä½æ‰“åˆ†åˆ†æ'
    ]},
  provider:{name:'æä¾›å•†è¯„æµ‹',cls:'c-pvd',kwType:'comp',
    tStd:[
      '{p1} {kw}æ·±åº¦è¯„æµ‹ï¼š{year}ç»¼åˆä½¿ç”¨ä½“éªŒæŠ¥å‘Š',
      '{year}æœ€å€¼å¾—æ¨èçš„{kw}æä¾›å•†TOP5æƒå¨æ’å',
      '{p1}é€€æ¬¾æ”¿ç­–è¯¦è§£ï¼šæ¶ˆè´¹ä¿éšœæœºåˆ¶å…¨è§£è¯»',
      'å°ä¼—ä½†å¥½ç”¨çš„{kw}æä¾›å•†ï¼šè¢«å¿½è§†çš„ä¼˜è´¨é€‰æ‹©'
    ],
    tKw:[
      '{injKw}æ·±åº¦è¯„æµ‹æŠ¥å‘Šï¼š{year}ç»¼åˆä½¿ç”¨ä½“éªŒä¸çœŸå®å£ç¢‘åˆ†æ',
      '{injKw}å€¼å¾—ä¿¡èµ–å—ï¼ŸæœåŠ¡è´¨é‡ã€é€€æ¬¾æ”¿ç­–ä¸å®¢æœå…¨é¢è¯„åˆ†',
      '{injKw}æ–°ç”¨æˆ·ä¸“å±ä¼˜æƒ ï¼šé¦–æ¬¡è´­ä¹°æŠ˜æ‰£ä¸ä¸“å±ç¦åˆ©å…¨è§£æ',
      '{injKw}è¯„æµ‹ç»“è®ºï¼šé€‚åˆå“ªç±»ç”¨æˆ·ï¼Ÿä¼˜ç¼ºç‚¹ä¸æ¨èåœºæ™¯åˆ†æ'
    ]},
  scenario:{name:'ä½¿ç”¨åœºæ™¯',cls:'c-scn',kwType:'loc',
    tStd:[
      '{dur}{dest}{scene}ï¼š{kw}å¥—é¤æœ€ä¼˜é€‰æ‹©æ–¹æ¡ˆ',
      '{dest}è‡ªé©¾æ¸¸{kw}æ”»ç•¥ï¼šå…¨ç¨‹ä¸æ–­ç½‘å¥—é¤æ¨è',
      'ç•™å­¦ç”Ÿå¿…çœ‹ï¼š{dest}é•¿æœŸ{kw}è§£å†³æ–¹æ¡ˆä¸è´¹ç”¨è§„åˆ’',
      'æ•°å­—æ¸¸æ°‘åœ¨{dest}ï¼šé•¿æœŸç¨³å®š{kw}è§£å†³æ–¹æ¡ˆ'
    ],
    tKw:[
      '{injKw}æ—…è¡ŒeSIMå®Œæ•´æŒ‡å—ï¼š{dur}å‡ºè¡Œå¥—é¤é€‰æ‹©ä¸ä¸Šç½‘æ”»ç•¥',
      'å»{injKw}æ—…æ¸¸ä¸Šç½‘æ¨èï¼š{year}æœ€æ–°eSIMæ–¹æ¡ˆç»¼åˆæµ‹è¯„',
      '{injKw}å•†åŠ¡å‡ºè¡ŒeSIMï¼šé«˜é€Ÿç¨³å®šå¥—é¤ç²¾é€‰æ¨èæŒ‡å—',
      '{injKw}ç•™å­¦ä¸Šç½‘è§£å†³æ–¹æ¡ˆï¼šé•¿æœŸä½¿ç”¨ä½æˆæœ¬eSIMå¥—é¤å®Œå…¨æŒ‡å—'
    ]},
  tips:{name:'ä½¿ç”¨æŠ€å·§',cls:'c-tip',kwType:'func',
    tStd:[
      '{kw}çœé’±å¤§æ³•ï¼š{cnt}ä¸ªå®ç”¨æŠ€å·§å‡å°‘é€šè®¯è´¹',
      '{kw}æµé‡ç®¡ç†æŠ€å·§ï¼šç”¨å¾—æ›´å°‘ä½†ç½‘é€Ÿä¸é™çº§',
      '{kw}ç»­è´¹æ”»ç•¥ï¼šå¦‚ä½•æ— ç¼ç»­æœŸä¸æ–­çº¿',
      'å»¶é•¿{kw}æœ‰æ•ˆæœŸçš„æŠ€å·§ï¼šå¥—é¤åˆ°æœŸå‰å¿…çœ‹'
    ],
    tKw:[
      '{injKw}çœæµé‡ä½¿ç”¨æŠ€å·§ï¼š{cnt}æ‹›å®æµ‹æœ‰æ•ˆçš„çœé’±å®æˆ˜æ–¹æ³•',
      '{injKw}å¥—é¤ä»·å€¼æœ€å¤§åŒ–ï¼šé«˜æ•ˆä½¿ç”¨æŒ‡å—ä¸æµé‡ç®¡ç†æŠ€å·§',
      'ç”¨{injKw}çœæ›´å¤šé’±ï¼š{year}æœ€æ–°ä¼˜æƒ æŠ€å·§ä¸å¥—é¤é€‰è´­å»ºè®®',
      '{injKw}ç»­è´¹ä¸æµé‡è¿½åŠ å®Œå…¨æŒ‡å—ï¼šå¦‚ä½•æ— ç¼ç»­æœŸä¸æ–­ç½‘'
    ]},
  review:{name:'ç”¨æˆ·çœŸå®è¯„æµ‹',cls:'c-rev',kwType:'comp',
    tStd:[
      '{year}çœŸå®ç”¨æˆ·è¯„æµ‹ï¼š{kw}ç»¼åˆå£ç¢‘ä¸ä½“éªŒæ€»ç»“',
      '{dest}æ—…è¡Œè¾¾äººåˆ†äº«ï¼š{kw}äº²èº«ä½¿ç”¨å¿ƒå¾—ç²¾é€‰',
      '{kw}ç”¨å®Œä¸€å‘¨åï¼šçœŸå®ç½‘é€Ÿä¸æœåŠ¡ä½“éªŒå¤ç›˜',
      'é«˜åˆ†è¿˜æ˜¯å·®è¯„ï¼Ÿ{kw}çœŸå®ç”¨æˆ·åé¦ˆä¸å»ºè®®'
    ],
    tKw:[
      '{injKw}çœŸå®ç”¨æˆ·è¯„æµ‹æ±‡æ€»ï¼š{year}ç»¼åˆå£ç¢‘ä¸æ»¡æ„åº¦æ·±åº¦åˆ†æ',
      '{injKw}ä¹°äº†å€¼ä¸å€¼ï¼Ÿ{dest}æ—…è¡Œç”¨æˆ·çœŸå®åé¦ˆä¸ä½¿ç”¨ä½“éªŒ',
      '{cnt}ä½ç”¨æˆ·äº²æµ‹{injKw}ï¼šå¥½è¯„å·®è¯„èƒŒåçš„çœŸç›¸å…¨è§£æ',
      '{injKw}ä½¿ç”¨ä½“éªŒæ·±åº¦æŠ¥å‘Šï¼šé€Ÿåº¦æµ‹è¯•ã€å®¢æœè¯„åˆ†ä¸æ€»ç»“'
    ]},
  recommend:{name:'å¥—é¤ç²¾é€‰æ¨è',cls:'c-rec',kwType:'func',
    tStd:[
      '{year}æ€§ä»·æ¯”æœ€é«˜çš„{kw}å¥—é¤ï¼šç²¾é€‰{cnt}æ¬¾å¼ºåŠ›æ¨è',
      '{userType}ä¸“å±æ¨èï¼š{kw}æœ€é€‚åˆä½ çš„{cnt}æ¬¾å¥—é¤',
      'ä¸åŒéœ€æ±‚ä¸åŒé€‰æ‹©ï¼š{kw}åˆ†åœºæ™¯å¥—é¤ç²¾å‡†æ¨è',
      'æ‡’äººå¿…çœ‹ï¼{kw}æ— è„‘è´­ä¹°ï¼šç›´æ¥ä¹°è¿™{cnt}æ¬¾'
    ],
    tKw:[
      '{injKw}å¥—é¤ç²¾é€‰æ¨èï¼š{year}{dest}å‡ºè¡Œæœ€å€¼å¾—ä¹°çš„{cnt}æ¬¾æ–¹æ¡ˆ',
      '{injKw}å“ªæ¬¾æœ€å¥½ï¼Ÿ{year}ç¼–è¾‘ç²¾é€‰æ€§ä»·æ¯”æœ€é«˜å¥—é¤æ¨èæ¦œ',
      '{userType}å¿…ä¹°{injKw}æ¨èï¼šç»¼åˆè¯„åˆ†æœ€é«˜çš„{cnt}æ¬¾å¥—é¤ç›˜ç‚¹',
      '{injKw}å…¥é—¨é¦–é€‰ï¼šæ–°æ‰‹æœ€é€‚åˆçš„{cnt}æ¬¾å¥—é¤é€‰è´­å®Œæ•´æŒ‡å—'
    ]},
  prepare:{name:'å‡ºè¡Œå‰å‡†å¤‡',cls:'c-pre',kwType:'func',
    tStd:[
      'å‡ºå‘{dest}å‰{cnt}ä»¶å¿…åšï¼š{kw}å‡†å¤‡å®Œæ•´æ£€æŸ¥æ¸…å•',
      '{dest}å‡ºè¡Œå‰{kw}å‡†å¤‡æŒ‡å—ï¼šæ‰‹æœºè®¾ç½®ä¸å¥—é¤é€‰è´­æ¸…å•',
      '{device}å‡ºè¡Œå‰{kw}å‡†å¤‡ï¼šè®¾ç½®ã€æµ‹è¯•ã€å¤‡ä»½å®Œæ•´æŒ‡å—',
      '{dest}å‡ºå‘å‰ä¸€å‘¨{kw}å‡†å¤‡æ”»ç•¥ï¼šåˆ†æ­¥éª¤å®Œæ•´å®‰æ’'
    ],
    tKw:[
      'å‡ºå‘å‰å¿…å¤‡{injKw}å‡†å¤‡æ”»ç•¥ï¼š{cnt}æ­¥éª¤å®Œæ•´æ“ä½œæ¸…å•',
      '{dest}å‡ºè¡Œå‰{injKw}è®¾ç½®æŒ‡å—ï¼šæ‰‹æœºé…ç½®ä¸æ¿€æ´»å…¨æ•™ç¨‹',
      'æå‰è´­ä¹°{injKw}çš„å®Œæ•´æŒ‡å—ï¼šå‡ºå‘å‰{dur}çš„æœ€ä¼˜æ—¶æœºä¸æ“ä½œ',
      '{injKw}å‡ºè¡Œå‡†å¤‡å®Œæ•´æ‰‹å†Œï¼šé¿å…è½åœ°æ‰åæ‚”çš„å…³é”®æ­¥éª¤'
    ]}
};

// H1 standard templates
var H1T_STD = [
  '{year}å¹´{kw}ç»ˆææŒ‡å—ï¼š{topic}',
  '{kw}å®Œæ•´æ”»ç•¥ï¼š{userType}å¿…è¯»æ‰‹å†Œ',
  '{kw}é€‰è´­åœ£ç»ï¼šè´­ä¹°æ¿€æ´»åˆ°ä½¿ç”¨å…¨æµç¨‹è¯¦è§£',
  '{year}æœ€æ–°{kw}æ·±åº¦è¯„æµ‹ï¼šå“ªå®¶æœ€å€¼å¾—ä¹°',
  '{kw}å®Œå…¨è§£æï¼š{scene}ä¸“å±æ¨èæŒ‡å—',
  'ä»é›¶å¼€å§‹ç”¨{kw}ï¼š{userType}ä¸“å±å®Œå…¨æ•™ç¨‹',
  '{kw}ç»ˆæå¯¹æ¯”ï¼š{c1} vs {c2}è°æ›´èƒœä¸€ç­¹',
  '{year}å‡ºè¡Œå¿…å¤‡{kw}ï¼šä»·æ ¼ã€è¦†ç›–ã€æ¿€æ´»å…¨è§£æ',
  '{kw}æ·±åº¦æµ‹è¯„ï¼š{city}åŠå‘¨è¾¹åœ°åŒºå®æµ‹æŠ¥å‘Š',
  'å‘Šåˆ«æ¼«æ¸¸è´¹ï¼{kw}å®Œæ•´è´­ä¹°ä¸ä½¿ç”¨æŒ‡å—',
  '{kw}æƒå¨æ¨èï¼š{year}æ€§ä»·æ¯”æœ€é«˜å¥—é¤å¤§ç›˜ç‚¹',
  '{kw}æ–°æ‰‹å…¥é—¨ï¼šä»è´­ä¹°åˆ°æ¿€æ´»çš„ä¿å§†çº§æ•™ç¨‹',
  '{device}ä½¿ç”¨{kw}è®¾ç½®æŒ‡å—ï¼š{year}æœ€æ–°å®Œæ•´æ•™ç¨‹',
  '{kw}æ·±åº¦æ¨ªè¯„ï¼š{p1} vs {p2}å…¨é¢å¯¹æ¯”',
  '{year}æ—…è¡Œå¿…å¤‡ï¼š{kw}é€‰è´­æ¿€æ´»ä½¿ç”¨å®Œå…¨æŒ‡å—',
  '{kw}ç»ˆæçœé’±æ‰‹å†Œï¼š{userType}å¿…çœ‹å¥—é¤åˆ†æ',
  '{kw}å®æµ‹æŠ¥å‘Šï¼šé€Ÿåº¦ã€è¦†ç›–ã€ä»·æ ¼å…¨æ–¹ä½è¯„åˆ†',
  'ä¸è¸©å‘ï¼{kw}è´­ä¹°é¿å‘æŒ‡å—ï¼š{year}æœ€æ–°ç‰ˆ',
  '{kw}å®Œå…¨æŒ‡å—ï¼š{dur}å‡ºè¡Œæœ€ä¼˜æ–¹æ¡ˆæ¨è',
  '{year}{kw}å¤§è¯„æµ‹ï¼šä»·æ ¼é€Ÿåº¦è¦†ç›–ç»¼åˆæ’å',
  '{kw}ä¿å§†çº§æ”»ç•¥ï¼š{device}ç”¨æˆ·ä¸“å±å®Œæ•´æ•™ç¨‹',
  '{city}å®æµ‹{kw}ï¼šçœŸå®ç½‘é€Ÿä¸è¦†ç›–æƒ…å†µå…¨è®°å½•',
  '{userType}é¦–é€‰{kw}ï¼š{year}ä¸“ä¸šæ¨èä¸å®æˆ˜å¿ƒå¾—',
  '{kw}å®Œå…¨æŒ‡å—{year}ï¼š{userType}çš„æœ€ä¼˜æ–¹æ¡ˆæ¨è',
  '{year}å¹´åº¦æœ€ä½³{kw}ï¼šç»¼åˆè¯„æµ‹ä¸é€‰è´­å»ºè®®å¤§å…¨'
];

// H1 keyword-first templates (use {injKw} = user's functional keyword)
var H1T_KW = [
  '{injKw}ï¼š{year}{dest}å‡ºè¡Œå®Œæ•´ä¸Šç½‘æŒ‡å—',
  '{injKw}æ·±åº¦æµ‹è¯„ï¼š{year}é€Ÿåº¦è¦†ç›–ä»·æ ¼å…¨è§£ææŠ¥å‘Š',
  '{injKw}æ€ä¹ˆç”¨ï¼Ÿ{dest}è´­ä¹°æ¿€æ´»ä½¿ç”¨å®Œå…¨æ”»ç•¥',
  '{injKw}å€¼å¾—ä¹°å—ï¼Ÿ{year}çœŸå®ç”¨æˆ·ä½“éªŒæ·±åº¦æŠ¥å‘Š',
  '{injKw}å“ªé‡Œä¹°æœ€å¥½ï¼Ÿ{year}ä¸»æµè´­ä¹°æ¸ é“å…¨é¢å¯¹æ¯”',
  '{injKw}å®Œæ•´ä½¿ç”¨æŒ‡å—ï¼š{userType}å‡ºè¡Œä¸Šç½‘ä¿å§†çº§æ•™ç¨‹',
  '{injKw}çœé’±è´­ä¹°æ”»ç•¥ï¼š{year}æœ€ä½ä»·æ ¼ä¸å¥—é¤é€‰è´­æŠ€å·§',
  '{injKw}æ—…è¡Œå®æµ‹æŠ¥å‘Šï¼š{dest}{dur}çœŸå®ä¸Šç½‘ä½“éªŒå…¨è®°å½•',
  '{injKw}å¯¹æ¯”è¯„æµ‹ï¼š{year}æœ€é€‚åˆ{userType}çš„æ–¹æ¡ˆæ¨è',
  '{dest}æ—…è¡Œå¿…å¤‡{injKw}ï¼š{year}è´­ä¹°æ¿€æ´»ä¸ä½¿ç”¨å®Œæ•´æ•™ç¨‹',
  '{injKw}ç»ˆæé€‰è´­æŒ‡å—ï¼š{year}{dest}å‡ºè¡Œå¥—é¤ç»¼åˆæ¨ªè¯„',
  '{injKw}ä½¿ç”¨å¸¸è§é—®é¢˜ï¼šæ¿€æ´»å¤±è´¥ä¿¡å·å·®é™é€Ÿå…¨è§£å†³æ–¹æ¡ˆ',
  '{injKw}çœŸå®ç”¨æˆ·è¯„æµ‹ï¼š{cnt}ä½ç”¨æˆ·ä½¿ç”¨å¿ƒå¾—ä¸ç»¼åˆè¯„åˆ†',
  '{year}{dest}æœ€ä½³{injKw}æ¨èï¼šä»·æ ¼é€Ÿåº¦è¦†ç›–ç»¼åˆæ’å'
];

// ============================================================
// STATE
// ============================================================
var kwPools = {func:[], comp:[], loc:[]};
var kwUsed  = {func:{}, comp:{}, loc:{}};
var kwRR    = {func:0, comp:0, loc:0};
var genCount = 0;
var curSet = null;
var hist = [];
var usedH1Set = {};
var kwMgrOpen = false;

// ============================================================
// KEYWORD MANAGEMENT
// ============================================================
function parseKw(type) {
  var taMap = {func:'taF', comp:'taC', loc:'taL'};
  var raw = document.getElementById(taMap[type]).value.trim();
  if (!raw) { showToast('è¯·å…ˆç²˜è´´å…³é”®è¯'); return; }
  var max = {func:200, comp:30, loc:120}[type];
  var parts = raw.split(/[\n\r,ï¼Œ;ï¼›]+/);
  var result = [], seen = {};
  for (var i = 0; i < parts.length; i++) {
    var kw = parts[i].trim();
    if (kw.length > 0 && kw.length <= 100 && !seen[kw] && result.length < max) {
      seen[kw] = true; result.push(kw);
    }
  }
  if (!result.length) { showToast('æœªè¯†åˆ«åˆ°æœ‰æ•ˆå…³é”®è¯'); return; }
  kwPools[type] = result;
  kwUsed[type] = {};
  kwRR[type] = 0;
  var phMap = {func:'phF', comp:'phC', loc:'phL'};
  var ph = document.getElementById(phMap[type]);
  ph.textContent = 'âœ… å·²å¯¼å…¥ ' + result.length + ' ä¸ª';
  ph.className = 'ph ph-ok';
  renderCloud(type);
  updateSummary();
  showToast('âœ… ' + {func:'åŠŸèƒ½è¯',comp:'ç«å“è¯',loc:'åœ°åŒºè¯'}[type] + ' å¯¼å…¥ ' + result.length + ' ä¸ª');
}

function clearKw(type) {
  var taMap = {func:'taF', comp:'taC', loc:'taL'};
  var phMap = {func:'phF', comp:'phC', loc:'phL'};
  document.getElementById(taMap[type]).value = '';
  document.getElementById(phMap[type]).textContent = '';
  kwPools[type] = []; kwUsed[type] = {};
  renderCloud(type);
  updateSummary();
  showToast('ğŸ—‘ ' + {func:'åŠŸèƒ½è¯',comp:'ç«å“è¯',loc:'åœ°åŒºè¯'}[type] + ' å·²æ¸…ç©º');
}

function renderCloud(type) {
  var pool = kwPools[type], used = kwUsed[type];
  var cloudMap = {func:'cloudF', comp:'cloudC', loc:'cloudL'};
  var wrapMap  = {func:'cwF', comp:'cwC', loc:'cwL'};
  var barMap   = {func:'cbF', comp:'cbC', loc:'cbL'};
  var pctMap   = {func:'cpF', comp:'cpC', loc:'cpL'};
  var cloudEl = document.getElementById(cloudMap[type]);
  var wrapEl  = document.getElementById(wrapMap[type]);
  var barEl   = document.getElementById(barMap[type]);
  var pctEl   = document.getElementById(pctMap[type]);
  if (!pool.length) { if (wrapEl) wrapEl.classList.remove('show'); return; }
  var usedCnt = 0;
  for (var k in used) { if (used[k] > 0) usedCnt++; }
  var pct = pool.length > 0 ? Math.round(usedCnt / pool.length * 100) : 0;
  if (barEl) barEl.style.width = pct + '%';
  if (pctEl) pctEl.textContent = pct + '%';
  var uCls = {func:'kt-fu', comp:'kt-cu', loc:'kt-lu'}[type];
  var nCls = {func:'kt-fn', comp:'kt-cn', loc:'kt-ln'}[type];
  var html = '';
  for (var i = 0; i < pool.length; i++) {
    html += '<span class="kt ' + (used[i] > 0 ? uCls : nCls) + '">' + escHtml(pool[i]) + '</span>';
  }
  if (cloudEl) cloudEl.innerHTML = html;
  if (wrapEl) wrapEl.classList.add('show');
}

function updateSummary() {
  var types = ['func','comp','loc'];
  var names = {func:'åŠŸèƒ½è¯',comp:'ç«å“è¯',loc:'åœ°åŒºè¯'};
  var icons = {func:'âš¡',comp:'ğŸ†',loc:'ğŸ“'};
  var pillMap = {func:'pillF',comp:'pillC',loc:'pillL'};
  var sumMap  = {func:'sumF',comp:'sumC',loc:'sumL'};
  var hdrMap  = {func:'sFN',comp:'sCN',loc:'sLN'};
  var hasAny = false;
  for (var i = 0; i < types.length; i++) {
    var t = types[i];
    var total = kwPools[t].length;
    var usedCnt = 0;
    for (var k in kwUsed[t]) { if (kwUsed[t][k] > 0) usedCnt++; }
    var pill = document.getElementById(pillMap[t]);
    var sum  = document.getElementById(sumMap[t]);
    var hdr  = document.getElementById(hdrMap[t]);
    if (pill) pill.textContent = names[t] + ' ' + total;
    if (sum) sum.textContent = icons[t] + ' ' + names[t] + ' ' + total + ' Â· å·²è¦†ç›– ' + usedCnt;
    if (hdr) hdr.textContent = total;
    if (total > 0) hasAny = true;
  }
  var mgr = document.getElementById('kwMgr');
  var hint = document.getElementById('kwHint');
  var summary = document.getElementById('kwSummary');
  if (hasAny) {
    mgr.classList.add('has-kws');
    if (hint) hint.style.display = 'none';
    if (!kwMgrOpen && summary) summary.classList.add('show');
  } else {
    mgr.classList.remove('has-kws');
    if (hint) hint.style.display = 'inline';
    if (summary) summary.classList.remove('show');
  }
}

function toggleKwMgr() {
  kwMgrOpen = !kwMgrOpen;
  var cols = document.getElementById('kwCols');
  var btn  = document.getElementById('kwToggle');
  var sum  = document.getElementById('kwSummary');
  cols.className = 'kw-cols' + (kwMgrOpen ? ' open' : '');
  btn.textContent = kwMgrOpen ? 'â–² æ”¶èµ·' : 'â–¼ å±•å¼€ç®¡ç†';
  var hasAny = kwPools.func.length > 0 || kwPools.comp.length > 0 || kwPools.loc.length > 0;
  if (hasAny) {
    if (kwMgrOpen) sum.classList.remove('show');
    else sum.classList.add('show');
  }
}

// ============================================================
// GENERATION CORE
// ============================================================
function pickItem(arr, n) {
  if (!arr || !arr.length) return '';
  return arr[((n % arr.length) + arr.length) % arr.length];
}

function getPoolKw(type, offset) {
  var pool = kwPools[type];
  if (!pool || !pool.length) return null;
  var idx = (kwRR[type] + (offset || 0)) % pool.length;
  return {kw: pool[idx], idx: idx};
}

function markUsed(type, idx) {
  if (idx == null || idx < 0) return;
  if (!kwUsed[type][idx]) kwUsed[type][idx] = 0;
  kwUsed[type][idx]++;
}

function advanceRR() {
  var types = ['func','comp','loc'];
  for (var i = 0; i < types.length; i++) {
    var t = types[i];
    if (kwPools[t].length > 0) kwRR[t] = (kwRR[t] + 1) % kwPools[t].length;
  }
}

function buildCtx(destKey, year, seed, injKw) {
  var d = DB[destKey];
  var s = Math.abs(seed) | 0;
  var hl = d.carriers.length, pl = d.providers.length;
  var ci1 = s % hl;
  var ci2 = (s + Math.ceil(hl / 2) + 1) % hl;
  if (ci2 === ci1) ci2 = (ci2 + 1) % hl;
  var pi1 = s % pl;
  var pi2 = (s + Math.ceil(pl / 2) + 1) % pl;
  if (pi2 === pi1) pi2 = (pi2 + 1) % pl;
  return {
    kw: d.kw, dest: d.name, year: year,
    city:     pickItem(d.cities, s),
    c1:       d.carriers[ci1], c2: d.carriers[ci2],
    p1:       d.providers[pi1], p2: d.providers[pi2],
    device:   pickItem(DEVICES, s),
    dur:      pickItem(d.durations, s),
    userType: pickItem(d.userTypes, s),
    scene:    pickItem(d.scenes, s + 2),
    topic:    pickItem(TOPICS, s),
    cnt:      pickItem(COUNTS, s),
    issue:    pickItem(d.issues, s),
    park:     pickItem(d.parks, s),
    injKw:    injKw || d.kw
  };
}

function fill(tpl, ctx) {
  var r = tpl;
  var keys = ['kw','dest','year','city','c1','c2','p1','p2','device','dur','userType','scene','topic','cnt','issue','park','injKw'];
  for (var i = 0; i < keys.length; i++) {
    r = r.split('{' + keys[i] + '}').join(ctx[keys[i]] || '');
  }
  return r;
}

function escHtml(s) {
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function getLogicalCats(n, seed) {
  var all = CAT_ORDER.slice();
  var s = Math.abs(seed) | 0;
  for (var i = all.length - 1; i > 0; i--) {
    s = (s * 1664525 + 1013904223) & 0x7fffffff;
    var j = s % (i + 1);
    var tmp = all[i]; all[i] = all[j]; all[j] = tmp;
  }
  var selected = all.slice(0, Math.min(n, all.length));
  selected.sort(function(a, b) { return CAT_ORDER.indexOf(a) - CAT_ORDER.indexOf(b); });
  return selected;
}

function tryH1(destKey, year, seed, attempt) {
  var d = DB[destKey];
  var s = Math.abs(seed * 7 + attempt * 19) | 0;
  var fkw = getPoolKw('func', attempt % Math.max(kwPools.func.length, 1));
  var hasF = fkw !== null;
  var useKw = hasF && ((s % 10) < 7);
  var arr = useKw ? H1T_KW : H1T_STD;
  var tpl = arr[s % arr.length];
  var ctx = buildCtx(destKey, year, s, hasF ? fkw.kw : d.kw);
  return {text: fill(tpl, ctx), funcIdx: hasF ? fkw.idx : -1, funcKw: hasF ? fkw.kw : null, kwFirst: useKw};
}

function generate() {
  var destKey = document.getElementById('selDest').value;
  var year    = document.getElementById('selYear').value;
  var h2n     = parseInt(document.getElementById('selH2n').value, 10);
  var batch   = parseInt(document.getElementById('selBatch').value, 10);

  for (var b = 0; b < batch; b++) {
    var g = genCount;

    // ---- H1 with deduplication ----
    var h1r = null;
    for (var att = 0; att < 25; att++) {
      var c = tryH1(destKey, year, g * 41 + b * 13, att);
      if (!usedH1Set[c.text]) { h1r = c; break; }
    }
    if (!h1r) {
      var fb = tryH1(destKey, year, g * 41 + b * 13, 0);
      fb.text = fb.text + 'ï¼ˆNo.' + (g + 1) + 'ï¼‰';
      h1r = fb;
    }
    usedH1Set[h1r.text] = true;
    if (h1r.funcIdx >= 0) markUsed('func', h1r.funcIdx);

    // ---- H2 keyword sources for this article ----
    var fkwSrc = getPoolKw('func', 0);
    var ckwSrc = getPoolKw('comp', 0);
    var lkwSrc = getPoolKw('loc', 0);

    // ---- H2 generation ----
    var selCats = getLogicalCats(h2n, g * 53 + b * 17);
    var h2s = [];

    for (var j = 0; j < selCats.length; j++) {
      var ck  = selCats[j];
      var cat = CATS[ck];
      var cSeed = Math.abs(g * 11 + j * 13 + CAT_ORDER.indexOf(ck) * 7) | 0;

      var src = null;
      if (cat.kwType === 'func' && fkwSrc) src = fkwSrc;
      else if (cat.kwType === 'comp' && ckwSrc) src = ckwSrc;
      else if (cat.kwType === 'loc' && lkwSrc) src = lkwSrc;

      var useKwTpl = src && cat.tKw && cat.tKw.length > 0 && ((cSeed % 10) < 7);
      var tpl, injTxt, usedType = null;

      if (useKwTpl) {
        tpl = cat.tKw[cSeed % cat.tKw.length];
        injTxt = src.kw;
        usedType = cat.kwType;
        markUsed(cat.kwType, src.idx);
      } else {
        tpl = cat.tStd[cSeed % cat.tStd.length];
        injTxt = src ? src.kw : DB[destKey].kw;
        usedType = null;
      }

      var lCtx = buildCtx(destKey, year, cSeed, injTxt);
      h2s.push({ck: ck, catName: cat.name, cls: cat.cls, text: fill(tpl, lCtx), kwType: usedType, injKw: usedType ? injTxt : null});
    }

    advanceRR();
    genCount++;

    var item = {
      id: genCount, destKey: destKey, destName: DB[destKey].name, year: year,
      h1: h1r.text, h2s: h2s,
      mainFuncKw: h1r.funcKw, h1KwFirst: h1r.kwFirst
    };
    curSet = item;
    hist.unshift(JSON.parse(JSON.stringify(item)));
  }

  renderAllClouds();
  updateSummary();
  renderOutput();
  renderHist();
  updateHdrStats();
}

function renderAllClouds() {
  renderCloud('func'); renderCloud('comp'); renderCloud('loc');
}

// ============================================================
// OUTPUT RENDERING
// ============================================================
function buildFlowBar(h2s) {
  var phases = [], seen = {};
  for (var i = 0; i < h2s.length; i++) {
    var ph = CAT_PHASE[h2s[i].ck];
    if (ph && !seen[ph.phase]) { seen[ph.phase] = true; phases.push(ph); }
  }
  var html = '<div class="flow-bar"><span class="flow-lbl">ğŸ“ è¯»è€…æ—…ç¨‹ï¼š</span>';
  for (var i = 0; i < phases.length; i++) {
    if (i > 0) html += '<span class="flow-arr">â†’</span>';
    html += '<span class="fp ' + phases[i].cls + '">' + phases[i].icon + ' ' + phases[i].phase + '</span>';
  }
  return html + '</div>';
}

function renderOutput() {
  if (!curSet) return;
  var h1 = curSet.h1, h2s = curSet.h2s;
  var h1Len = h1.length, lenOk = h1Len >= 30 && h1Len <= 80;

  document.getElementById('bdgGen').style.display = 'inline';
  document.getElementById('bdgGen').textContent = 'ç¬¬ ' + curSet.id + ' ç¯‡';
  document.getElementById('bdgDed').style.display = 'inline';
  document.getElementById('btnCopySet').style.display = 'inline-flex';
  document.getElementById('btnPrompt').style.display = 'inline-flex';
  document.getElementById('oFt').style.display = 'flex';

  var hasKw = !!curSet.mainFuncKw;
  document.getElementById('bdgKw').style.display = hasKw ? 'inline' : 'none';
  if (hasKw) document.getElementById('bdgKw').textContent = 'ğŸ”‘ å…³é”®è¯å·²æ³¨å…¥';

  // Count injected H2s
  var injCnt = 0, injF = 0, injC = 0, injL = 0;
  for (var m = 0; m < h2s.length; m++) {
    if (h2s[m].kwType) {
      injCnt++;
      if (h2s[m].kwType === 'func') injF++;
      else if (h2s[m].kwType === 'comp') injC++;
      else if (h2s[m].kwType === 'loc') injL++;
    }
  }

  // SEO bar
  var seoHtml = '<div class="seo-bar">'
    + '<span class="seo-tag so">âœ“ å«æ ¸å¿ƒå…³é”®è¯</span>'
    + '<span class="seo-tag ' + (lenOk ? 'so' : 'sw') + '">' + (lenOk ? 'âœ“' : 'âš ') + ' H1å­—ç¬¦ ' + h1Len + (lenOk ? '' : 'ï¼ˆå»ºè®®30-80ï¼‰') + '</span>'
    + '<span class="seo-tag so">âœ“ è¯»è€…æ—…ç¨‹æ’åº</span>'
    + '<span class="seo-tag si">âœ“ æ„å›¾å¤šæ ·æ€§è¦†ç›–</span>'
    + (injF > 0 ? '<span class="seo-tag si">âš¡ åŠŸèƒ½è¯Ã—' + injF + '</span>' : '')
    + (injC > 0 ? '<span class="seo-tag" style="background:#fdf2f8;border:1px solid #f9a8d4;color:#be185d">ğŸ† ç«å“è¯Ã—' + injC + '</span>' : '')
    + (injL > 0 ? '<span class="seo-tag" style="background:#f0fdfa;border:1px solid #99f6e4;color:#0f766e">ğŸ“ åœ°åŒºè¯Ã—' + injL + '</span>' : '')
    + '</div>';

  // Dedup
  var dedHtml = '<div class="dedup-row">âœ… H1æ ‡é¢˜å·²å»é‡éªŒè¯ Â· æœ¬ä¼šè¯å·²ç”Ÿæˆ '
    + genCount + ' ç¯‡ Â· H1å”¯ä¸€åº“ ' + Object.keys(usedH1Set).length + ' æ¡</div>';

  // H1
  var kwBadges = '';
  if (curSet.mainFuncKw) kwBadges += '<span class="ki ki-f">âš¡ ' + escHtml(curSet.mainFuncKw) + '</span>';
  var h1Html = '<div class="h1-block">'
    + '<span class="h1-lbl">H1</span>'
    + '<div class="h1-body">'
    + '<div class="h1-txt">' + escHtml(h1) + '</div>'
    + '<div class="h1-meta"><span class="h1-len">å­—ç¬¦ï¼š' + h1Len + '</span>' + kwBadges + '</div>'
    + '</div>'
    + '<button class="h1-copy" onclick="cpH1()">ğŸ“‹ å¤åˆ¶</button>'
    + '</div>';

  var flowBar = buildFlowBar(h2s);

  var h2Hd = '<div class="h2-hd">H2 å­æ ‡é¢˜ Â· å…± ' + h2s.length + ' ä¸ª'
    + ' <span class="h2-hd-b" style="background:var(--grn)">âœ“ è¯»è€…æ—…ç¨‹æ’åº</span>'
    + (injCnt > 0 ? ' <span class="h2-hd-b" style="background:var(--amb)">ğŸ”‘ ' + injCnt + ' ä¸ªæ³¨å…¥å…³é”®è¯</span>' : '')
    + '</div>';

  var h2Html = '';
  for (var m = 0; m < h2s.length; m++) {
    var item = h2s[m];
    var phInfo = CAT_PHASE[item.ck] || {phase:'', cls:'fp-sup', icon:''};
    var phBdg = '<span class="ph-bdg ' + phInfo.cls + '">' + phInfo.icon + ' ' + phInfo.phase + '</span>';
    var kwBdg = '';
    if (item.kwType) {
      var kwBdgCls = {func:'ki-f', comp:'ki-c', loc:'ki-l'}[item.kwType];
      var kwBdgIcon = {func:'âš¡', comp:'ğŸ†', loc:'ğŸ“'}[item.kwType];
      kwBdg = '<span class="h2-kw-tag ' + kwBdgCls + '">' + kwBdgIcon + ' ' + escHtml(item.injKw) + '</span>';
    }
    h2Html += '<div class="h2-item">'
      + '<div class="h2-num">' + (m + 1) + '</div>'
      + '<div class="h2-body">'
      + '<div class="h2-tags"><span class="cat-bdg ' + item.cls + '">' + item.catName + '</span>' + phBdg + kwBdg + '</div>'
      + '<div class="h2-txt">' + escHtml(item.text) + '</div>'
      + '<div class="h2-len">å­—ç¬¦ï¼š' + item.text.length + '</div>'
      + '</div>'
      + '<button class="h2-copy" onclick="cpH2(' + m + ')">ğŸ“‹</button>'
      + '</div>';
  }

  var banner = '<div class="prompt-banner">'
    + '<div class="pb-l"><div class="pb-title">ğŸ“ ä¸€é”®ç”Ÿæˆ SEO å†™ä½œ Prompt</div>'
    + '<div class="pb-sub">åŸºäºè¯»è€…æ—…ç¨‹ç»“æ„ + 3ç±»å…³é”®è¯è‡ªåŠ¨æ³¨å…¥ï¼Œç”Ÿæˆå®Œæ•´ AI å†™ä½œæŒ‡ä»¤</div></div>'
    + '<button class="btn btn-pur" onclick="generatePrompt()" style="font-size:13px;padding:9px 17px">ğŸ“ ç”Ÿæˆ Prompt</button>'
    + '</div>';

  document.getElementById('outputBody').innerHTML =
    seoHtml + dedHtml + h1Html + flowBar + h2Hd
    + '<div class="h2-list">' + h2Html + '</div>' + banner;
}

function renderHist() {
  document.getElementById('histSec').style.display = hist.length > 1 ? 'block' : 'none';
  document.getElementById('histCnt').textContent = hist.length;
  document.getElementById('btnExpAll').style.display = genCount > 0 ? 'inline-flex' : 'none';
  var limit = Math.min(hist.length, 40), html = '';
  for (var p = 0; p < limit; p++) {
    var it = hist[p], preview = '';
    for (var q = 0; q < it.h2s.length && q < 3; q++) {
      var txt = it.h2s[q].text;
      if (txt.length > 36) txt = txt.slice(0, 36) + '...';
      preview += 'Â· ' + escHtml(txt) + '<br>';
    }
    var kwBg = it.mainFuncKw ? '<span class="kt kt-fu" style="font-size:10px">' + escHtml(it.mainFuncKw) + '</span>' : '';
    html += '<div class="hist-card" onclick="viewHist(' + it.id + ')">'
      + '<div class="hc-no">ç¬¬ ' + it.id + ' ç¯‡ Â· ' + it.destName + ' ' + it.year + '</div>'
      + '<div class="hc-kws">' + kwBg + '</div>'
      + '<div class="hc-h1">' + escHtml(it.h1) + '</div>'
      + '<div class="hc-prev">' + preview + '</div>'
      + '</div>';
  }
  document.getElementById('histGrid').innerHTML = html;
}

function viewHist(id) {
  for (var p = 0; p < hist.length; p++) {
    if (hist[p].id === id) {
      curSet = hist[p];
      renderOutput();
      window.scrollTo({top: 0, behavior: 'smooth'});
      showToast('ğŸ“– æŸ¥çœ‹ç¬¬ ' + id + ' ç¯‡å†å²');
      return;
    }
  }
}

function toggleHist() {
  var body = document.getElementById('histBody');
  var arr  = document.getElementById('histArr');
  var open = body.classList.toggle('open');
  arr.textContent = open ? 'â–² æ”¶èµ·' : 'â–¼ å±•å¼€';
}

function updateHdrStats() {
  document.getElementById('sGen').textContent = genCount;
  document.getElementById('sDedup').textContent = Object.keys(usedH1Set).length;
}

// ============================================================
// COPY / EXPORT
// ============================================================
function cpH1() { if (curSet) copyText(curSet.h1); }
function cpH2(i) { if (curSet && curSet.h2s[i]) copyText(curSet.h2s[i].text); }

function copySet() {
  if (!curSet) return;
  var t = 'ã€ç¬¬ ' + curSet.id + ' ç¯‡ | ' + curSet.destName + ' ' + curSet.year + 'ã€‘\n\nH1ï¼ˆä¸»æ ‡é¢˜ï¼‰ï¼š\n' + curSet.h1 + '\n\n';
  t += 'H2ï¼ˆå­æ ‡é¢˜ Â· æŒ‰è¯»è€…æ—…ç¨‹æ’åºï¼‰ï¼š\n';
  for (var n = 0; n < curSet.h2s.length; n++) {
    var kw = curSet.h2s[n].injKw ? '  [' + {func:'åŠŸèƒ½è¯',comp:'ç«å“è¯',loc:'åœ°åŒºè¯'}[curSet.h2s[n].kwType] + 'ï¼š' + curSet.h2s[n].injKw + ']' : '';
    t += (n + 1) + '. [' + curSet.h2s[n].catName + '] ' + curSet.h2s[n].text + kw + '\n';
  }
  copyText(t);
}

function exportCurrent() {
  if (!curSet) return;
  var t = '=== ç¬¬ ' + curSet.id + ' ç¯‡ | ' + curSet.destName + ' ' + curSet.year;
  if (curSet.mainFuncKw) t += ' | ä¸»å…³é”®è¯ï¼š' + curSet.mainFuncKw;
  t += ' ===\n\nH1: ' + curSet.h1 + '\n\n';
  for (var n = 0; n < curSet.h2s.length; n++) {
    t += 'H2-' + (n + 1) + ' [' + curSet.h2s[n].catName + ']: ' + curSet.h2s[n].text + '\n';
  }
  downloadFile(t, 'seo-article-' + curSet.id + '.txt');
  showToast('ğŸ“¤ å¯¼å‡ºæˆåŠŸ');
}

function exportAll() {
  if (!hist.length) return;
  var sep = '--------------------------------------------\n';
  var t = 'eSIM SEO Blog ç»“æ„è®°å½• Â· å…± ' + hist.length + ' ç¯‡\nç”Ÿæˆæ—¶é—´ï¼š' + new Date().toLocaleString() + '\n\n';
  for (var p = 0; p < hist.length; p++) {
    var it = hist[p];
    t += sep + 'ç¬¬ ' + it.id + ' ç¯‡ | ' + it.destName + ' ' + it.year;
    if (it.mainFuncKw) t += ' | ä¸»å…³é”®è¯ï¼š' + it.mainFuncKw;
    t += '\n' + sep + 'H1: ' + it.h1 + '\n\n';
    for (var n = 0; n < it.h2s.length; n++) {
      var kw = it.h2s[n].injKw ? ' (' + it.h2s[n].injKw + ')' : '';
      t += 'H2-' + (n + 1) + ' [' + it.h2s[n].catName + ']: ' + it.h2s[n].text + kw + '\n';
    }
    t += '\n';
  }
  downloadFile(t, 'seo-all-' + hist.length + 'articles.txt');
  showToast('âœ… å·²å¯¼å‡º ' + hist.length + ' ç¯‡æ–‡ç« ç»“æ„');
}

// ============================================================
// PROMPT GENERATION
// ============================================================
function generatePrompt() {
  if (!curSet) { showToast('è¯·å…ˆç”Ÿæˆæ–‡ç« ç»“æ„'); return; }
  var d = DB[curSet.destKey];
  var h1 = curSet.h1, h2s = curSet.h2s;
  var dest = curSet.destName, yr = curSet.year, kw = d.kw;
  var city = pickItem(d.cities, curSet.id);
  var p1 = d.providers[0], p2 = d.providers[1] || d.providers[0];

  // Collect injected keywords
  var injF = [], injC = [], injL = [], seen = {};
  if (curSet.mainFuncKw && !seen[curSet.mainFuncKw]) {
    seen[curSet.mainFuncKw] = true; injF.push(curSet.mainFuncKw);
  }
  for (var i = 0; i < h2s.length; i++) {
    if (h2s[i].kwType && h2s[i].injKw && !seen[h2s[i].injKw]) {
      seen[h2s[i].injKw] = true;
      if (h2s[i].kwType === 'func') injF.push(h2s[i].injKw);
      else if (h2s[i].kwType === 'comp') injC.push(h2s[i].injKw);
      else if (h2s[i].kwType === 'loc') injL.push(h2s[i].injKw);
    }
  }

  var sep = '================================================================\n';
  var sep2 = '----------------------------------------------------------------\n';
  var pt = '';
  pt += sep + '# SEO è½¯æ–‡å†™ä½œä»»åŠ¡ | ' + dest + ' eSIM Â· ' + yr + '\n' + sep + '\n';
  pt += '## ä¸€ã€è§’è‰²å®šä½\n' + sep2;
  pt += 'ä½ æ˜¯ä¸€ä½æ‹¥æœ‰ 10 å¹´ç»éªŒçš„ Google SEO å†…å®¹ä¸“å®¶ï¼Œç²¾é€šä¸­æ–‡å†…å®¹è¥é”€ï¼Œ\n';
  pt += 'è¯·æ’°å†™åŒæ—¶æ»¡è¶³ä»¥ä¸‹ç›®æ ‡çš„é«˜è´¨é‡æ–‡ç« ï¼š\n';
  pt += '  1. ç¬¦åˆ Google E-E-A-T è´¨é‡è¯„ä¼°æ ‡å‡†ï¼Œæœ‰åŠ©äºè‡ªç„¶æœç´¢æ’å\n';
  pt += '  2. çœŸæ­£è§£å†³ç›®æ ‡è¯»è€…çš„å®é™…ç—›ç‚¹ï¼Œæä¾›å¯æ“ä½œçš„å®ç”¨ä¿¡æ¯\n';
  pt += '  3. ä¸‰ç±»å…³é”®è¯ï¼ˆåŠŸèƒ½è¯Â·ç«å“è¯Â·åœ°åŒºè¯ï¼‰è‡ªç„¶èå…¥ï¼Œç»ä¸ç”Ÿç¡¬å †ç Œ\n\n';
  pt += '## äºŒã€æ–‡ç« åŸºæœ¬ä¿¡æ¯\n' + sep2;
  pt += 'ä¸»æ ‡é¢˜ï¼ˆH1ï¼‰ï¼š' + h1 + '\n';
  pt += 'ç›®æ ‡åœ°åŒº    ï¼š' + dest + '\n';
  pt += 'å‘å¸ƒå¹´ä»½    ï¼š' + yr + '\n';
  pt += 'æ ¸å¿ƒå…³é”®è¯  ï¼š' + kw + '\n';
  pt += 'å‚è€ƒæœåŠ¡å•†  ï¼š' + p1 + 'ã€' + p2 + ' ç­‰\n';
  pt += 'ç›®æ ‡è¯»è€…    ï¼šè®¡åˆ’å‰å¾€' + dest + 'çš„ä¸­æ–‡ç”¨æˆ·ï¼ˆæ—…è¡Œè€…ã€å•†åŠ¡äººå£«ã€ç•™å­¦ç”Ÿç­‰ï¼‰\n\n';
  pt += '## ä¸‰ã€æ–‡ç« ç»“æ„ï¼ˆæŒ‰è¯»è€…æ—…ç¨‹é€»è¾‘æ’åºï¼Œä¸¥æ ¼æŒ‰æ­¤å±•å¼€ï¼‰\n' + sep2;
  pt += 'ã€å¼•è¨€ã€‘100-150å­—ï¼šä»¥è¯»è€…ç—›ç‚¹åœºæ™¯å¼€ç¯‡ï¼Œå‰100å­—å†…è‡ªç„¶æ¤å…¥ã€Œ' + kw + 'ã€ä¸€æ¬¡\n\n';
  for (var i = 0; i < h2s.length; i++) {
    var ph = CAT_PHASE[h2s[i].ck] || {phase:'', icon:''};
    pt += (i + 1) + '. ã€' + h2s[i].catName + ' Â· ' + ph.phase + 'ã€‘' + h2s[i].text + '\n';
    if (h2s[i].injKw) {
      var typeLabel = {func:'åŠŸèƒ½è¯',comp:'ç«å“è¯',loc:'åœ°åŒºè¯'}[h2s[i].kwType];
      pt += '   ^ æœ¬èŠ‚å…³é”®è¯ç„¦ç‚¹ï¼ˆ' + typeLabel + 'ï¼‰ï¼šã€Œ' + h2s[i].injKw + 'ã€è‡ªç„¶å‡ºç° 1-2 æ¬¡\n';
    }
  }
  pt += '\nã€ç»“å°¾æ€»ç»“ã€‘100-150å­—ï¼šæç‚¼3æ¡æ ¸å¿ƒå»ºè®®ï¼Œå†æ¬¡å‘¼åº”ã€Œ' + kw + 'ã€ï¼Œå«è¡ŒåŠ¨å·å¬\n\n';
  pt += '## å››ã€ä¸‰ç±»å…³é”®è¯æ¤å…¥è§„èŒƒ\n' + sep2;
  pt += '\næ ¸å¿ƒå…³é”®è¯ã€Œ' + kw + 'ã€å…¨æ–‡å‡ºç° 5-8 æ¬¡ï¼Œå¯†åº¦æ§åˆ¶åœ¨ 1.5%-2%\n\n';
  if (injF.length > 0) {
    pt += 'ã€âš¡ åŠŸèƒ½è¯ Â· æœ€é«˜ä¼˜å…ˆçº§æ¤å…¥ã€‘åˆ†æ•£æ³¨å…¥å¯¹åº”ç« èŠ‚ï¼Œæ¯ä¸ªå‡ºç° 1-2 æ¬¡ï¼š\n';
    for (var i = 0; i < injF.length; i++) pt += '  Â· ' + injF[i] + '\n';
    pt += '\n';
  }
  if (injC.length > 0) {
    pt += 'ã€ğŸ† ç«å“è¯ Â· å¯¹æ¯”/è¯„æµ‹ç« èŠ‚é‡ç‚¹ä½¿ç”¨ã€‘\n';
    for (var i = 0; i < injC.length; i++) pt += '  Â· ' + injC[i] + '\n';
    pt += '\n';
  }
  if (injL.length > 0) {
    pt += 'ã€ğŸ“ åœ°åŒºè¯ Â· è¦†ç›–/åœºæ™¯ç« èŠ‚ä½¿ç”¨ã€‘\n';
    for (var i = 0; i < injL.length; i++) pt += '  Â· ' + injL[i] + '\n';
    pt += '\n';
  }

  // Extra keywords from pool
  var extF = kwPools.func.filter(function(k) { return injF.indexOf(k) < 0; }).slice(0, 15);
  var extC = kwPools.comp.filter(function(k) { return injC.indexOf(k) < 0; }).slice(0, 8);
  var extL = kwPools.loc.filter(function(k) { return injL.indexOf(k) < 0; }).slice(0, 15);
  if (extF.length > 0) {
    pt += 'ã€é¢å¤–åŠŸèƒ½è¯å‚è€ƒåº“ï¼ˆæ‹©ä¼˜é€‰ç”¨ 5-8 ä¸ªï¼‰ã€‘\n';
    for (var i = 0; i < extF.length; i++) pt += '  Â· ' + extF[i] + '\n';
    pt += '\n';
  }
  if (extC.length > 0) {
    pt += 'ã€é¢å¤–ç«å“è¯å‚è€ƒåº“ï¼ˆæ‹©ä¼˜é€‰ç”¨ï¼‰ã€‘\n';
    for (var i = 0; i < extC.length; i++) pt += '  Â· ' + extC[i] + '\n';
    pt += '\n';
  }
  if (extL.length > 0) {
    pt += 'ã€é¢å¤–åœ°åŒºè¯å‚è€ƒåº“ï¼ˆæ‹©ä¼˜é€‰ç”¨ï¼‰ã€‘\n';
    for (var i = 0; i < extL.length; i++) pt += '  Â· ' + extL[i] + '\n';
    pt += '\n';
  }
  pt += '## äº”ã€E-E-A-T å†™ä½œè§„èŒƒ\n' + sep2;
  pt += 'Â· å…¨æ–‡æ€»å­—æ•°ï¼š2500-3500 å­—\n';
  pt += 'Â· æ¯ä¸ªH2ç« èŠ‚ï¼š200-350å­—\n';
  pt += 'Â· Experienceï¼šèå…¥çœŸå®ä½¿ç”¨åœºæ™¯ï¼Œå¦‚ã€Œåœ¨' + city + 'è½åœ°åæ‰“å¼€eSIMè®¾ç½®...ã€\n';
  pt += 'Â· Expertiseï¼šå¼•ç”¨å…·ä½“æ•°æ®ï¼ˆä»·æ ¼åŒºé—´å¦‚ $X-$Yï¼Œç½‘é€Ÿå¦‚ 50-100 Mbpsï¼‰\n';
  pt += 'Â· Authoritativenessï¼šè‡ªç„¶æåŠçœŸå®æœåŠ¡å•†ï¼ˆ' + p1 + 'ã€' + p2 + 'ç­‰ï¼‰\n';
  pt += 'Â· Trustworthinessï¼šå®¢è§‚å‘ˆç°ä¼˜ç¼ºç‚¹ï¼Œä¸è¿‡åº¦å¤¸å¤§ï¼Œå»ºç«‹ä¿¡ä»»\n';
  pt += 'Â· å…¨éƒ¨å…³é”®è¯æ€»å¯†åº¦ä¸è¶…è¿‡ 2.5%ï¼›åŒä¸€æ®µè½ä¸è¶…è¿‡ 3 ä¸ªï¼›é¦–æ¬¡å‡ºç°å¯åŠ ç²—\n\n';
  pt += sep + '## å¼€å§‹å†™ä½œ\n' + sep;
  pt += 'è¯·ä»ã€å¼•è¨€ã€‘å¼€å§‹ä¾æ¬¡å±•å¼€æ‰€æœ‰ç« èŠ‚ï¼Œ\næœ€åå•ç‹¬é™„ï¼šâ‘  Meta Title â‘¡ Meta æè¿°ï¼ˆå«æ ¸å¿ƒå…³é”®è¯ï¼‰â‘¢ 3æ¡å†…é“¾å»ºè®®ã€‚\n' + sep;

  var kwAll = injF.length + injC.length + injL.length;
  document.getElementById('mInfo').innerHTML =
    '<span class="m-st msp">ğŸ“Š çº¦' + Math.round(pt.length / 2.2) + 'å­—</span>'
    + '<span class="m-st msp">ğŸ“ ' + h2s.length + 'ä¸ªç« èŠ‚</span>'
    + (injF.length > 0 ? '<span class="m-st msp">âš¡ åŠŸèƒ½è¯Ã—' + injF.length + '</span>' : '')
    + (injC.length > 0 ? '<span class="m-st" style="background:#fdf2f8;border:1px solid #f9a8d4;color:#be185d">ğŸ† ç«å“è¯Ã—' + injC.length + '</span>' : '')
    + (injL.length > 0 ? '<span class="m-st mst">ğŸ“ åœ°åŒºè¯Ã—' + injL.length + '</span>' : '')
    + (kwAll > 0 ? '<span class="m-st msa">ğŸ”‘ å…± ' + kwAll + ' ä¸ªå…³é”®è¯æ³¨å…¥</span>' : '');

  document.getElementById('promptTa').value = pt;
  document.getElementById('pModal').classList.add('open');
  document.body.style.overflow = 'hidden';
}

// ============================================================
// MODAL
// ============================================================
function closeModal() {
  document.getElementById('pModal').classList.remove('open');
  document.body.style.overflow = '';
}
function closeModalBg(e) {
  if (e && e.target === document.getElementById('pModal')) closeModal();
}
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape' && document.getElementById('pModal').classList.contains('open')) closeModal();
});
function copyPrompt() { var t = document.getElementById('promptTa').value; if (t) copyText(t); }
function exportPrompt() {
  var t = document.getElementById('promptTa').value;
  if (!t || !curSet) return;
  downloadFile(t, 'prompt-' + curSet.destName + curSet.year + '-' + curSet.id + '.txt');
  showToast('ğŸ“¤ Prompt å·²å¯¼å‡º');
}

// ============================================================
// RESET
// ============================================================
function doReset() {
  genCount = 0; curSet = null; hist = []; usedH1Set = {};
  document.getElementById('sGen').textContent = '0';
  document.getElementById('sDedup').textContent = '0';
  var ids = ['bdgGen','bdgKw','bdgDed','btnCopySet','btnPrompt'];
  for (var i = 0; i < ids.length; i++) document.getElementById(ids[i]).style.display = 'none';
  document.getElementById('oFt').style.display = 'none';
  document.getElementById('histSec').style.display = 'none';
  document.getElementById('btnExpAll').style.display = 'none';
  document.getElementById('outputBody').innerHTML =
    '<div class="empty"><div class="empty-ico">âœ¨</div>'
    + '<h3>ç‚¹å‡»ã€Œç”Ÿæˆç»“æ„ã€å¼€å§‹æ‰¹é‡äº§å‡º</h3>'
    + '<p>å…ˆåœ¨ä¸Šæ–¹å¯¼å…¥3ç±»å…³é”®è¯ï¼ˆåŠŸèƒ½è¯Â·ç«å“è¯Â·åœ°åŒºè¯ï¼‰<br>'
    + 'ç³»ç»Ÿè‡ªåŠ¨å°†å…³é”®è¯æ³¨å…¥H1ä¸»æ ‡é¢˜å’Œå¯¹åº”ç±»å‹çš„H2æ ‡é¢˜<br>'
    + 'H1å…¨å±€å»é‡ Â· æ ‡é¢˜æŒ‰è¯»è€…æ—…ç¨‹é€»è¾‘æ’åº Â· æ”¯æŒæ‰¹é‡ç”Ÿæˆ</p></div>';
  showToast('ğŸ”„ å·²é‡ç½®æ‰€æœ‰è®°å½•');
}

// ============================================================
// UTILITIES
// ============================================================
function copyText(text) {
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text)
      .then(function() { showToast('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'); })
      .catch(function() { copyFallback(text); });
  } else { copyFallback(text); }
}
function copyFallback(text) {
  var ta = document.createElement('textarea');
  ta.value = text; ta.style.cssText = 'position:fixed;opacity:0;top:0;left:0';
  document.body.appendChild(ta); ta.focus(); ta.select();
  try { document.execCommand('copy'); showToast('âœ… å·²å¤åˆ¶'); }
  catch(e) { showToast('âŒ è¯·æ‰‹åŠ¨å…¨é€‰å¤åˆ¶'); }
  document.body.removeChild(ta);
}
function downloadFile(text, filename) {
  var a = document.createElement('a');
  a.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(text);
  a.download = filename;
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
}
var toastTimer = null;
function showToast(msg) {
  var el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('show');
  if (toastTimer) clearTimeout(toastTimer);
  toastTimer = setTimeout(function() { el.classList.remove('show'); }, 2800);
}
</script>
</body>
</html>
