<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¿„ç½—æ–¯ eSIM SEO Blog æ‰¹é‡ç”Ÿæˆå™¨</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --pri:#2563eb;--pri-d:#1d4ed8;--pri-l:#eff6ff;
  --pur:#7c3aed;--pur-d:#5b21b6;--pur-l:#f5f3ff;
  --grn:#10b981;--grn-d:#059669;--grn-l:#f0fdf4;
  --amb:#f59e0b;--amb-d:#d97706;--amb-l:#fffbeb;
  --pink:#ec4899;--pink-d:#be185d;--pink-l:#fdf2f8;
  --teal:#14b8a6;--teal-d:#0f766e;--teal-l:#f0fdfa;
  --orn:#ea580c;--orn-d:#c2410c;--orn-l:#fff7ed;
  --bg:#f0f4f8;--card:#fff;--bdr:#e2e8f0;
  --txt:#1e293b;--muted:#64748b;--light:#f8fafc;
}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','PingFang SC','Microsoft YaHei',sans-serif;background:var(--bg);color:var(--txt);min-height:100vh;font-size:14px}

.hdr{background:linear-gradient(135deg,#0f2460,#1e3a8a 40%,#2563eb 80%,#3b82f6);color:#fff;padding:14px 24px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;box-shadow:0 2px 18px rgba(37,99,235,.4)}
.hdr-l h1{font-size:17px;font-weight:800;display:flex;align-items:center;gap:7px}
.hdr-l p{font-size:11px;opacity:.72;margin-top:3px}
.hdr-stats{display:flex;gap:6px;flex-wrap:wrap}
.stat-pill{background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.2);padding:4px 11px;border-radius:16px;font-size:11.5px;font-weight:600}
.stat-pill b{color:#fcd34d}
.main{max-width:1120px;margin:0 auto;padding:15px 13px}

/* KEYWORD MANAGER */
.kw-mgr{background:var(--card);border-radius:14px;box-shadow:0 1px 8px rgba(0,0,0,.07);margin-bottom:14px;overflow:hidden;border:2px solid var(--bdr);transition:border-color .25s}
.kw-mgr.has-kws{border-color:#fcd34d}
.kw-mgr-hd{padding:11px 18px;background:linear-gradient(135deg,#fffbeb,#fef3c7);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;cursor:pointer;user-select:none}
.kw-mgr-hd:hover{background:linear-gradient(135deg,#fef3c7,#fde68a)}
.kw-mgr-title{font-size:14px;font-weight:800;color:#92400e;display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.tp{display:inline-flex;align-items:center;gap:3px;padding:3px 9px;border-radius:9px;font-size:11px;font-weight:700;border:1.5px solid}
.tp-f{background:#dbeafe;color:#1d4ed8;border-color:#93c5fd}
.tp-c{background:#fdf2f8;color:#be185d;border-color:#f9a8d4}
.tp-l{background:#f0fdfa;color:#0f766e;border-color:#99f6e4}
.tp-v{background:var(--orn-l);color:var(--orn-d);border-color:#fdba74}
.kw-mgr-toggle{background:var(--amb);color:#fff;border:none;border-radius:7px;padding:5px 12px;font-size:12px;font-weight:600;cursor:pointer;flex-shrink:0}
.kw-mgr-toggle:hover{background:var(--amb-d)}
.kw-summary{padding:9px 18px;background:#fffef7;border-top:1.5px solid #fde68a;display:none;align-items:center;gap:10px;flex-wrap:wrap}
.kw-summary.show{display:flex}
.sum-chip{display:flex;align-items:center;gap:5px;font-size:12px;font-weight:600;padding:3px 10px;border-radius:8px}
.sc-f{background:#dbeafe;color:#1d4ed8}.sc-c{background:#fdf2f8;color:#be185d}.sc-l{background:#f0fdfa;color:#0f766e}.sc-v{background:var(--orn-l);color:var(--orn-d)}
.sum-div{color:#cbd5e1;font-size:13px}
.kw-cols{display:none;grid-template-columns:repeat(4,1fr);border-top:1.5px solid #fde68a}
.kw-cols.open{display:grid}
.kw-col{padding:12px 13px;border-right:1.5px solid #fde68a;background:#fffef9}
.kw-col:last-child{border-right:none}
.kw-col-hd{margin-bottom:8px}
.kw-col-title{font-size:13px;font-weight:800;display:flex;align-items:center;gap:5px;margin-bottom:2px}
.col-ico{width:21px;height:21px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0}
.ico-f{background:#dbeafe;color:#1d4ed8}.ico-c{background:#fdf2f8;color:#be185d}.ico-l{background:#f0fdfa;color:#0f766e}.ico-v{background:var(--orn-l);color:var(--orn)}
.kw-col-lim{font-size:10px;font-weight:700;padding:2px 6px;border-radius:5px;margin-left:3px}
.lim-f{background:#dbeafe;color:#1d4ed8}.lim-c{background:#fdf2f8;color:#be185d}.lim-l{background:#f0fdfa;color:#0f766e}.lim-v{background:var(--orn-l);color:var(--orn-d)}
.kw-col-desc{font-size:11px;color:var(--muted);margin-bottom:8px}
.kw-ta{width:100%;padding:9px 11px;border:1.5px solid var(--bdr);border-radius:8px;font-size:12px;line-height:1.7;resize:vertical;outline:none;min-height:110px;font-family:'Consolas',monospace;color:var(--txt);background:#fff;transition:border-color .2s,box-shadow .2s}
.kw-ta.ta-f:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.1)}
.kw-ta.ta-c:focus{border-color:#ec4899;box-shadow:0 0 0 3px rgba(236,72,153,.1)}
.kw-ta.ta-l:focus{border-color:#14b8a6;box-shadow:0 0 0 3px rgba(20,184,166,.1)}
.kw-ta.ta-v:focus{border-color:var(--orn);box-shadow:0 0 0 3px rgba(234,88,12,.1)}
.kw-col-btns{margin-top:8px;display:flex;gap:5px;align-items:center;flex-wrap:wrap}
.bp{border:none;border-radius:7px;padding:5px 12px;font-size:12px;font-weight:600;cursor:pointer;color:#fff;transition:all .18s}
.bp-f{background:#3b82f6}.bp-f:hover{background:#2563eb}
.bp-c{background:#ec4899}.bp-c:hover{background:#be185d}
.bp-l{background:#14b8a6}.bp-l:hover{background:#0f766e}
.bp-v{background:var(--orn)}.bp-v:hover{background:var(--orn-d)}
.btn-sm-clr{background:#fff;color:var(--muted);border:1.5px solid var(--bdr);border-radius:7px;padding:5px 10px;font-size:11.5px;cursor:pointer;transition:all .18s}
.btn-sm-clr:hover{border-color:var(--muted)}
.ph{font-size:11px;font-weight:600}.ph-ok{color:var(--grn)}
.cloud-wrap{margin-top:9px;display:none}
.cloud-wrap.show{display:block}
.cov-row{display:flex;align-items:center;gap:6px;margin-bottom:5px}
.cov-bg{flex:1;height:5px;background:#e2e8f0;border-radius:3px;overflow:hidden}
.cov-fill{height:100%;border-radius:3px;transition:width .4s}
.cf-f{background:linear-gradient(90deg,#3b82f6,#2563eb)}.cf-c{background:linear-gradient(90deg,#ec4899,#be185d)}.cf-l{background:linear-gradient(90deg,#14b8a6,#0f766e)}.cf-v{background:linear-gradient(90deg,var(--orn),var(--orn-d))}
.cov-pct{font-size:10.5px;font-weight:700;min-width:30px;text-align:right}
.kw-cloud{display:flex;flex-wrap:wrap;gap:4px;max-height:78px;overflow-y:auto;scrollbar-width:thin}
.kw-cloud::-webkit-scrollbar{width:4px}.kw-cloud::-webkit-scrollbar-thumb{border-radius:2px;background:#e2e8f0}
.kt{display:inline-flex;padding:2px 8px;border-radius:10px;font-size:11px;font-weight:500;white-space:nowrap;border:1.5px solid;cursor:default;transition:transform .12s;line-height:1.4}
.kt:hover{transform:scale(1.05)}
.kt-fu{background:#dbeafe;border-color:#93c5fd;color:#1d4ed8;font-weight:700}.kt-fn{background:#f8fafc;border-color:#e2e8f0;color:#94a3b8}
.kt-cu{background:#fdf2f8;border-color:#f9a8d4;color:#be185d;font-weight:700}.kt-cn{background:#f8fafc;border-color:#e2e8f0;color:#94a3b8}
.kt-lu{background:#f0fdfa;border-color:#99f6e4;color:#0f766e;font-weight:700}.kt-ln{background:#f8fafc;border-color:#e2e8f0;color:#94a3b8}
.kt-vu{background:var(--orn-l);border-color:#fdba74;color:var(--orn-d);font-weight:700}.kt-vn{background:#f8fafc;border-color:#e2e8f0;color:#94a3b8}
.kt-cu2{background:#f3e8ff;border-color:#c4b5fd;color:#5b21b6;font-weight:700}

/* CONTROLS */
.ctrl{background:var(--card);border-radius:14px;padding:13px 18px;box-shadow:0 1px 8px rgba(0,0,0,.07);margin-bottom:14px;display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap}
.fg{display:flex;flex-direction:column;gap:4px}
.fg label{font-size:10.5px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.6px}
select{padding:8px 10px;border:1.5px solid var(--bdr);border-radius:8px;font-size:13px;color:var(--txt);outline:none;cursor:pointer;background:#fff;transition:border-color .2s;min-width:100px}
select:focus{border-color:var(--pri)}
.btn-grp{display:flex;gap:7px;align-items:flex-end;flex-wrap:wrap}
.btn{display:inline-flex;align-items:center;gap:5px;padding:8px 15px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;border:none;transition:all .2s;white-space:nowrap}
.btn-pri{background:linear-gradient(135deg,var(--pri),var(--pri-d));color:#fff;padding:10px 22px;font-size:14px;box-shadow:0 3px 10px rgba(37,99,235,.28)}
.btn-pri:hover{transform:translateY(-1px);box-shadow:0 5px 16px rgba(37,99,235,.4)}
.btn-out{background:#fff;color:var(--muted);border:1.5px solid var(--bdr)}
.btn-out:hover{border-color:var(--pri);color:var(--pri);background:var(--pri-l)}
.btn-grn{background:var(--grn);color:#fff}
.btn-grn:hover{background:var(--grn-d);transform:translateY(-1px)}
.btn-pur{background:linear-gradient(135deg,var(--pur),var(--pur-d));color:#fff;box-shadow:0 3px 10px rgba(124,58,237,.23)}
.btn-pur:hover{transform:translateY(-1px);box-shadow:0 5px 16px rgba(124,58,237,.36)}

/* ====================== */
/* STEP 1 FLOW UI         */
/* ====================== */
.s1-prog{display:flex;align-items:center;gap:0;margin-bottom:14px;padding:11px 16px;background:#f0f9ff;border:1.5px solid #bae6fd;border-radius:11px}
.s1-step{display:flex;flex-direction:column;align-items:center;gap:4px;flex-shrink:0}
.s1-dot{width:28px;height:28px;border-radius:50%;background:var(--pri);color:#fff;font-size:13px;font-weight:800;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(37,99,235,.3)}
.s1-dot-i{background:#e2e8f0;color:#94a3b8;box-shadow:none}
.s1-lbl{font-size:11px;font-weight:700;color:#1d4ed8;white-space:nowrap}
.s1-lbl-i{color:#94a3b8}
.s1-line-wrap{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:0 10px;padding-bottom:16px}
.s1-line{width:100%;height:2.5px;background:linear-gradient(90deg,#3b82f6,#e2e8f0);border-radius:2px;position:relative;overflow:visible}
.s1-line-arr{position:absolute;right:-1px;top:-5px;color:#e2e8f0;font-size:12px}

.s1-tip{padding:10px 14px;background:#fffbeb;border:1.5px solid #fde68a;border-radius:9px;font-size:12px;color:#92400e;line-height:1.7;margin-bottom:14px}
.s1-list{display:flex;flex-direction:column;gap:11px;margin-bottom:14px}
.s1-item{border:2px solid #bfdbfe;border-radius:13px;overflow:hidden;background:#fff;transition:box-shadow .2s}
.s1-item:hover{box-shadow:0 3px 14px rgba(37,99,235,.1)}
.s1-item-conv{border-color:#fdba74}
.s1-item-conv:hover{box-shadow:0 3px 14px rgba(234,88,12,.1)}
.s1-item-hd{padding:9px 15px;background:#eff6ff;border-bottom:1px solid #bfdbfe;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.s1-item-conv .s1-item-hd{background:#fff7ed;border-bottom-color:#fdba74}
.s1-item-no{font-size:12px;font-weight:800;color:#1d4ed8}
.s1-item-conv .s1-item-no{color:#c2410c}
.s1-item-body{padding:15px 17px}
.s1-h1-text{font-size:17px;font-weight:700;color:#1e3a8a;line-height:1.48;margin-bottom:9px}
.s1-item-conv .s1-h1-text{color:#9a3412}
.s1-h1-meta{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
.s1-item-actions{padding:10px 15px;background:#f8fafc;border-top:1px solid #e2e8f0;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.s1-item-conv .s1-item-actions{background:#fffef9;border-top-color:#fde68a}

.s1-confirm-bar{padding:15px 17px;background:linear-gradient(135deg,#f0fdf4,#dcfce7);border:2px solid #86efac;border-radius:13px;display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.s1-confirm-l .s1-confirm-title{font-size:13.5px;font-weight:800;color:#15803d;margin-bottom:3px}
.s1-confirm-l .s1-confirm-hint{font-size:11.5px;color:#16a34a}
.btn-confirm{background:linear-gradient(135deg,#10b981,#059669);color:#fff;border:none;border-radius:9px;padding:11px 22px;font-size:14px;font-weight:700;cursor:pointer;box-shadow:0 3px 10px rgba(16,185,129,.28);transition:all .2s;display:inline-flex;align-items:center;gap:7px}
.btn-confirm:hover{transform:translateY(-1px);box-shadow:0 5px 16px rgba(16,185,129,.4)}

/* OUTPUT CARD */
.ocard{background:var(--card);border-radius:14px;box-shadow:0 1px 8px rgba(0,0,0,.07);margin-bottom:14px;overflow:hidden;transition:box-shadow .4s}
.ocard.flash{box-shadow:0 0 0 4px rgba(37,99,235,.45),0 4px 20px rgba(37,99,235,.2)}
.ocard-hd{padding:12px 18px;background:var(--light);border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
.ocard-hd-l{display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.ocard-hd-r{display:flex;gap:6px;flex-wrap:wrap;align-items:center}
.bdg{font-size:11px;font-weight:700;padding:3px 9px;border-radius:10px;color:#fff;white-space:nowrap}
.bg-pri{background:var(--pri)}.bg-grn{background:var(--grn)}.bg-amb{background:var(--amb)}.bg-pur{background:var(--pur)}.bg-orn{background:var(--orn)}
.bg-step{background:linear-gradient(135deg,#0f766e,#14b8a6)}
.ocard-title{font-size:14px;font-weight:700;color:#374151}
.ocard-body{padding:18px 20px}
.ocard-ft{padding:10px 18px;background:var(--light);border-top:1px solid var(--bdr);display:none;gap:6px;flex-wrap:wrap}

/* H1 BLOCK */
.h1-block{background:linear-gradient(135deg,#eff6ff,#dbeafe);border:2px solid #93c5fd;border-radius:12px;padding:13px 15px;margin-bottom:14px;display:flex;align-items:flex-start;gap:9px}
.h1-lbl{flex-shrink:0;background:var(--pri);color:#fff;font-size:9.5px;font-weight:800;padding:3px 7px;border-radius:4px;margin-top:4px}
.h1-body{flex:1;min-width:0}
.h1-txt{font-size:16px;font-weight:700;color:#1e3a8a;line-height:1.45}
.h1-meta{display:flex;gap:5px;margin-top:5px;flex-wrap:wrap;align-items:center}
.h1-len{font-size:10px;color:#3b82f6;font-weight:600}
.ki{font-size:10px;font-weight:700;padding:2px 7px;border-radius:7px;display:inline-flex;align-items:center;gap:3px}
.ki-f{background:#dbeafe;color:#1d4ed8;border:1px solid #93c5fd}
.ki-c{background:#fdf2f8;color:#be185d;border:1px solid #f9a8d4}
.ki-l{background:#f0fdfa;color:#0f766e;border:1px solid #99f6e4}
.ki-v{background:var(--orn-l);color:var(--orn-d);border:1px solid #fdba74}
.h1-copy{flex-shrink:0;background:#fff;color:var(--pri);border:1.5px solid var(--pri);border-radius:7px;padding:4px 9px;font-size:11px;cursor:pointer;transition:all .18s;margin-top:2px}
.h1-copy:hover{background:var(--pri);color:#fff}
.h1-block-conv{background:linear-gradient(135deg,#fff7ed,#fed7aa);border-color:#fdba74}
.h1-block-conv .h1-txt{color:#9a3412}
.h1-block-conv .h1-copy{color:var(--orn);border-color:var(--orn)}
.h1-block-conv .h1-copy:hover{background:var(--orn);color:#fff}

.dedup-row{display:flex;align-items:center;gap:7px;padding:7px 12px;background:#f0fdf4;border:1.5px solid #86efac;border-radius:9px;margin-bottom:12px;font-size:11.5px;color:#15803d;font-weight:600}
.seo-bar{display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap}
.seo-tag{display:inline-flex;align-items:center;gap:3px;padding:3px 9px;border-radius:7px;font-size:11px;font-weight:600}
.so{background:#f0fdf4;border:1px solid #bbf7d0;color:#15803d}
.sw{background:#fffbeb;border:1px solid #fde68a;color:#92400e}
.si{background:#eff6ff;border:1px solid #bfdbfe;color:#1d4ed8}
.sv{background:var(--orn-l);border:1px solid #fdba74;color:var(--orn-d)}

.flow-bar{display:flex;align-items:center;gap:5px;padding:8px 13px;background:linear-gradient(135deg,#f0fdf4,#dcfce7);border:1.5px solid #86efac;border-radius:10px;margin-bottom:12px;flex-wrap:wrap}
.flow-lbl{font-size:11px;font-weight:700;color:#15803d;flex-shrink:0}
.fp{display:inline-flex;align-items:center;gap:3px;font-size:10.5px;font-weight:600;padding:2px 8px;border-radius:7px;white-space:nowrap}
.fp-rch{background:#dbeafe;color:#1d4ed8;border:1px solid #93c5fd}
.fp-cmp{background:#fdf2f8;color:#be185d;border:1px solid #f9a8d4}
.fp-dec{background:#fef3c7;color:#92400e;border:1px solid #fcd34d}
.fp-conv{background:var(--orn-l);color:var(--orn-d);border:1px solid #fdba74}
.fp-act{background:#dcfce7;color:#15803d;border:1px solid #86efac}
.fp-use{background:#ede9fe;color:#5b21b6;border:1px solid #c4b5fd}
.fp-sup{background:#f1f5f9;color:#475569;border:1px solid #cbd5e1}
.flow-arr{color:#cbd5e1;font-size:9px}

.h2-hd{font-size:10.5px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.6px;margin-bottom:9px;display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.h2-hd-b{font-size:10px;font-weight:700;padding:2px 8px;border-radius:8px;text-transform:none;letter-spacing:0;color:#fff}
.h2-list{display:flex;flex-direction:column;gap:7px}
.h2-item{display:flex;align-items:flex-start;gap:9px;padding:10px 12px;border:1.5px solid var(--bdr);border-radius:10px;transition:all .18s;position:relative}
.h2-item:hover{border-color:#93c5fd;background:#f0f9ff;box-shadow:0 2px 8px rgba(37,99,235,.06)}
.h2-item.h2-conv{border-color:#fdba74;background:#fffdf9}
.h2-item.h2-conv:hover{border-color:var(--orn);background:#fff7ed}
.h2-item:not(:last-child)::after{content:'';position:absolute;left:19px;bottom:-8px;width:2px;height:8px;background:#e2e8f0;z-index:1}
.h2-num{width:24px;height:24px;background:var(--pri);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;flex-shrink:0;margin-top:2px;z-index:2;position:relative}
.h2-num-conv{background:var(--orn)!important}
.h2-body{flex:1;min-width:0}
.h2-tags{display:flex;align-items:center;gap:5px;margin-bottom:4px;flex-wrap:wrap}
.cat-bdg{font-size:10px;font-weight:700;color:#fff;padding:2px 7px;border-radius:8px}
.ph-bdg{font-size:10px;font-weight:600;padding:2px 7px;border-radius:8px}
.h2-kw-tag{font-size:10px;font-weight:700;padding:2px 7px;border-radius:7px;display:inline-flex;align-items:center;gap:2px}
.h2-txt{font-size:13.5px;color:var(--txt);line-height:1.4}
.h2-len{font-size:10px;color:var(--muted);margin-top:2px}
.h2-copy{flex-shrink:0;background:none;border:1px solid var(--bdr);border-radius:6px;padding:3px 7px;font-size:11px;color:var(--muted);cursor:pointer;transition:all .18s;margin-top:2px}
.h2-copy:hover{border-color:var(--pri);color:var(--pri);background:var(--pri-l)}

.prompt-banner{background:linear-gradient(135deg,var(--pur-l),#ede9fe);border:2px solid #c4b5fd;border-radius:11px;padding:12px 16px;margin-top:16px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
.pb-l .pb-title{font-size:13px;font-weight:700;color:#5b21b6;display:flex;align-items:center;gap:6px}
.pb-l .pb-sub{font-size:11px;color:#7c3aed;opacity:.82;margin-top:2px}

.empty{text-align:center;padding:52px 20px;color:var(--muted)}
.empty-ico{font-size:46px;margin-bottom:12px}
.empty h3{font-size:16px;color:#374151;margin-bottom:5px;font-weight:700}
.empty p{font-size:13px;line-height:1.65}

/* HISTORY */
.hist-outer{background:var(--card);border-radius:14px;box-shadow:0 1px 8px rgba(0,0,0,.07);overflow:hidden;margin-bottom:14px}
.hist-hd{padding:12px 18px;background:var(--light);border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;cursor:pointer;user-select:none;transition:background .18s}
.hist-hd:hover{background:#f1f5f9}
.hist-hd h3{font-size:14px;font-weight:700;color:#374151;display:flex;align-items:center;gap:8px}
.hist-body{padding:12px;display:none}
.hist-body.open{display:block}
.hist-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(248px,1fr));gap:8px}
.hist-card{border:1.5px solid var(--bdr);border-radius:10px;padding:11px 13px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.hist-card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,var(--pri-l),transparent);opacity:0;transition:opacity .2s}
.hist-card:hover::before{opacity:1}
.hist-card:hover{border-color:var(--pri);transform:translateY(-2px);box-shadow:0 4px 16px rgba(37,99,235,.14)}
.hist-card-inner{position:relative;z-index:1}
.hc-no{font-size:10.5px;font-weight:700;color:var(--pri);margin-bottom:3px;display:flex;align-items:center;justify-content:space-between}
.hc-eye{font-size:11px;opacity:0;transition:opacity .2s;color:var(--pri)}
.hist-card:hover .hc-eye{opacity:1}
.hc-kws{display:flex;gap:3px;flex-wrap:wrap;margin-bottom:4px}
.hc-h1{font-size:12px;font-weight:600;color:var(--txt);line-height:1.4;margin-bottom:5px}
.hc-prev{font-size:11px;color:var(--muted);line-height:1.6}
.hc-foot{display:flex;align-items:center;justify-content:space-between;margin-top:6px;padding-top:6px;border-top:1px solid var(--bdr)}
.hc-cnt{font-size:10px;color:var(--muted)}
.hc-btn{font-size:10.5px;font-weight:600;color:var(--pri);background:var(--pri-l);border:none;border-radius:5px;padding:2px 8px;cursor:pointer;opacity:0;transition:opacity .2s}
.hist-card:hover .hc-btn{opacity:1}

/* MODALS */
.modal-ov{position:fixed;inset:0;background:rgba(15,23,42,.65);backdrop-filter:blur(5px);z-index:2000;display:flex;align-items:center;justify-content:center;padding:16px;opacity:0;pointer-events:none;transition:opacity .25s}
.modal-ov.open{opacity:1;pointer-events:all}
.modal-box{background:#fff;border-radius:18px;width:100%;max-width:900px;max-height:92vh;display:flex;flex-direction:column;box-shadow:0 24px 80px rgba(0,0,0,.3);transform:translateY(20px) scale(.97);transition:transform .28s cubic-bezier(.34,1.56,.64,1)}
.modal-ov.open .modal-box{transform:translateY(0) scale(1)}
.modal-hd{padding:14px 18px;border-bottom:1px solid #e9d5ff;display:flex;align-items:center;justify-content:space-between;background:linear-gradient(135deg,var(--pur-l),#ede9fe);border-radius:18px 18px 0 0;flex-shrink:0;gap:10px;flex-wrap:wrap}
.modal-hd-blue{background:linear-gradient(135deg,#eff6ff,#dbeafe);border-bottom-color:#bfdbfe}
.modal-hd-l h3{font-size:15px;font-weight:800;color:#4c1d95}
.modal-hd-blue .modal-hd-l h3{color:#1e3a8a}
.modal-hd-l p{font-size:11px;color:#7c3aed;opacity:.8;margin-top:2px}
.modal-hd-blue .modal-hd-l p{color:#3b82f6;opacity:1}
.modal-info{padding:9px 18px;background:#faf9ff;border-bottom:1px solid #e9d5ff;display:flex;gap:6px;flex-wrap:wrap;flex-shrink:0}
.modal-info-blue{background:#f0f9ff;border-bottom-color:#bfdbfe}
.m-st{padding:4px 11px;border-radius:8px;font-size:11px;font-weight:700}
.msp{background:var(--pur-l);border:1px solid #c4b5fd;color:#5b21b6}
.msa{background:var(--amb-l);border:1px solid #fde68a;color:#92400e}
.mst{background:var(--teal-l);border:1px solid #99f6e4;color:#0f766e}
.msb{background:#dbeafe;border:1px solid #93c5fd;color:#1d4ed8}
.msv{background:var(--orn-l);border:1px solid #fdba74;color:var(--orn-d)}
.msc{background:#f3e8ff;border:1px solid #c4b5fd;color:#5b21b6}
.modal-tip{padding:7px 18px;background:#fffbeb;border-bottom:1px solid #fde68a;display:flex;align-items:center;gap:6px;flex-shrink:0;font-size:11.5px;color:#92400e;font-weight:500}
.modal-body{flex:1;overflow-y:auto;padding:15px 18px}
.modal-body::-webkit-scrollbar{width:5px}.modal-body::-webkit-scrollbar-thumb{border-radius:3px;background:#e2e8f0}
.prompt-ta{width:100%;padding:13px;border:2px solid #c4b5fd;border-radius:11px;font-size:12.5px;line-height:1.75;color:#1e293b;font-family:'Consolas',monospace;resize:vertical;background:#faf9ff;outline:none;min-height:380px;transition:border-color .2s}
.prompt-ta:focus{border-color:var(--pur);box-shadow:0 0 0 3px rgba(124,58,237,.11)}
.modal-ft{padding:12px 18px;border-top:1px solid #e9d5ff;display:flex;gap:6px;align-items:center;flex-wrap:wrap;background:#faf9ff;border-radius:0 0 18px 18px;flex-shrink:0}
.modal-ft-blue{background:#f0f9ff;border-top-color:#bfdbfe}
.modal-ft-hint{margin-left:auto;font-size:11px;color:#9ca3af;font-style:italic}
.modal-cls{background:none;border:none;width:28px;height:28px;border-radius:7px;cursor:pointer;font-size:15px;color:#6b7280;display:flex;align-items:center;justify-content:center;transition:all .18s}
.modal-cls:hover{background:#e9d5ff;color:#5b21b6}
.modal-cls-blue:hover{background:#dbeafe;color:#1d4ed8}
.hp-nav{display:flex;align-items:center;justify-content:space-between;padding:8px 14px;background:#f0f9ff;border-bottom:1px solid #dbeafe;flex-shrink:0;gap:8px;flex-wrap:wrap}
.hp-nav-info{font-size:12px;color:#3b82f6;font-weight:600}
.hp-nav-btns{display:flex;gap:5px}
.hp-nav-btn{padding:4px 10px;border-radius:6px;font-size:11.5px;font-weight:600;cursor:pointer;border:1.5px solid;transition:all .18s}
.hp-nav-prev{background:#fff;color:var(--muted);border-color:var(--bdr)}
.hp-nav-prev:hover{border-color:var(--pri);color:var(--pri)}
.hp-nav-next{background:var(--pri-l);color:var(--pri);border-color:#93c5fd}
.hp-nav-next:hover{background:var(--pri);color:#fff}

/* CUSTOM KEYWORDS SECTION */
.ckw-outer{border-bottom:1px solid #e9d5ff;flex-shrink:0;background:#faf7ff}
.ckw-hd{padding:9px 18px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;user-select:none;transition:background .15s}
.ckw-hd:hover{background:#f0e9ff}
.ckw-hd-l{display:flex;align-items:center;gap:7px;font-size:13px;font-weight:700;color:#5b21b6}
.ckw-cnt-bdg{font-size:10.5px;font-weight:700;padding:2px 8px;border-radius:8px;background:#ede9fe;color:#5b21b6;border:1px solid #c4b5fd;display:none}
.ckw-hint{font-size:11px;color:#7c3aed;opacity:.75;font-weight:400}
.ckw-arr{font-size:11.5px;color:#7c3aed;font-weight:600;white-space:nowrap}
.ckw-bd{display:none;padding:10px 18px 14px;border-top:1px solid #ede9fe}
.ckw-bd.open{display:block}
.ckw-desc{font-size:11.5px;color:var(--muted);margin-bottom:9px;line-height:1.65;padding:7px 11px;background:#f3e8ff;border-radius:7px;border:1px solid #e9d5ff}
.ckw-input-row{display:flex;gap:9px;align-items:flex-start}
.ckw-ta{flex:1;padding:9px 11px;border:1.5px solid #c4b5fd;border-radius:8px;font-size:12px;line-height:1.7;resize:vertical;outline:none;min-height:80px;max-height:150px;font-family:'Consolas',monospace;background:#fff;color:var(--txt);transition:border-color .2s,box-shadow .2s}
.ckw-ta:focus{border-color:var(--pur);box-shadow:0 0 0 3px rgba(124,58,237,.1)}
.ckw-side{display:flex;flex-direction:column;gap:6px;flex-shrink:0}
.ckw-btns{margin-top:9px;display:flex;gap:7px;align-items:center;flex-wrap:wrap}
.ckw-chips-wrap{margin-top:9px}
.ckw-chips-title{font-size:10.5px;font-weight:700;color:#7c3aed;margin-bottom:5px;display:none}
.ckw-chips{display:flex;flex-wrap:wrap;gap:4px;max-height:62px;overflow-y:auto;scrollbar-width:thin}
.ckw-chips::-webkit-scrollbar{width:4px}.ckw-chips::-webkit-scrollbar-thumb{border-radius:2px;background:#e2e8f0}

/* TOAST */
.toast{position:fixed;bottom:22px;right:22px;background:#1e293b;color:#fff;padding:10px 15px;border-radius:10px;font-size:13px;font-weight:500;z-index:9999;transform:translateY(70px);opacity:0;transition:all .3s;pointer-events:none;box-shadow:0 4px 16px rgba(0,0,0,.2)}
.toast.show{transform:translateY(0);opacity:1}

/* CATEGORY COLORS */
.c-pur{background:#f97316}.c-act{background:#8b5cf6}.c-pri{background:#ef4444}
.c-cov{background:#10b981}.c-faq{background:#3b82f6}.c-cmp{background:#6366f1}
.c-scn{background:#14b8a6}.c-tip{background:#f59e0b}
.c-rec{background:#65a30d}.c-pre{background:#be185d}
.c-deal{background:#dc2626}

@media(max-width:960px){
  .kw-cols.open{grid-template-columns:1fr 1fr}
  .kw-col{border-bottom:1.5px solid #fde68a}
  .kw-col:nth-child(2n){border-right:none}
  .kw-col:nth-last-child(-n+2){border-bottom:none}
}
@media(max-width:580px){
  .kw-cols.open{grid-template-columns:1fr!important}
  .kw-col{border-right:none!important;border-bottom:1.5px solid #fde68a!important}
  .kw-col:last-child{border-bottom:none!important}
  .ckw-input-row{flex-direction:column}
  .s1-confirm-bar{flex-direction:column;align-items:flex-start}
}
@media(max-width:780px){
  .hdr{padding:12px 13px}.hdr-l h1{font-size:15px}
  .main{padding:10px 9px}.h1-txt{font-size:14px}
  .hist-grid{grid-template-columns:1fr}
  .modal-box{border-radius:14px;max-height:95vh}
  .s1-h1-text{font-size:14px}
}
</style>
</head>
<body>

<div class="hdr">
  <div class="hdr-l">
    <h1>ğŸ‡·ğŸ‡º ä¿„ç½—æ–¯ eSIM SEO Blog æ‰¹é‡ç”Ÿæˆå™¨</h1>
    <p>ä¸¤æ­¥å¼ç”Ÿæˆï¼šå…ˆç¡®è®¤H1 â†’ å†å›´ç»•H1ç”ŸæˆH2 Â· 4ç±»å…³é”®è¯æ³¨å…¥ Â· é«˜è½¬åŒ–è¯ä¼˜å…ˆ Â· è‡ªå®šä¹‰è¯Prompt</p>
  </div>
  <div class="hdr-stats">
    <div class="stat-pill">å·²ç”Ÿæˆ <b id="sGen">0</b> ç¯‡</div>
    <div class="stat-pill">âš¡ åŠŸèƒ½è¯ <b id="sFN">0</b></div>
    <div class="stat-pill">ğŸ† ç«å“è¯ <b id="sCN">0</b></div>
    <div class="stat-pill">ğŸ“ åœ°åŒºè¯ <b id="sLN">0</b></div>
    <div class="stat-pill">ğŸ”¥ é«˜è½¬åŒ–è¯ <b id="sVN">0</b></div>
    <div class="stat-pill">H1å”¯ä¸€ <b id="sDedup">0</b> ç¯‡</div>
  </div>
</div>

<div class="main">

  <!-- KEYWORD MANAGER -->
  <div class="kw-mgr" id="kwMgr">
    <div class="kw-mgr-hd" onclick="toggleKwMgr()">
      <div class="kw-mgr-title">
        ğŸ”‘ å…³é”®è¯åˆ†ç±»ç®¡ç†
        <span class="tp tp-f" id="pillF">åŠŸèƒ½è¯ 0</span>
        <span class="tp tp-c" id="pillC">ç«å“è¯ 0</span>
        <span class="tp tp-l" id="pillL">åœ°åŒºè¯ 0</span>
        <span class="tp tp-v" id="pillV">é«˜è½¬åŒ–è¯ 0</span>
        <span id="kwHint" style="font-size:12px;color:#92400e;font-style:italic;font-weight:400">â† å¯¼å…¥å…³é”®è¯ï¼Œè‡ªåŠ¨æ³¨å…¥H1å’ŒH2æ ‡é¢˜</span>
      </div>
      <button class="kw-mgr-toggle" id="kwToggle">â–¼ å±•å¼€ç®¡ç†</button>
    </div>
    <div class="kw-summary" id="kwSummary">
      <span class="sum-chip sc-f" id="sumF">âš¡ åŠŸèƒ½è¯ 0 Â· å·²è¦†ç›– 0</span>
      <span class="sum-div">|</span>
      <span class="sum-chip sc-c" id="sumC">ğŸ† ç«å“è¯ 0 Â· å·²è¦†ç›– 0</span>
      <span class="sum-div">|</span>
      <span class="sum-chip sc-l" id="sumL">ğŸ“ åœ°åŒºè¯ 0 Â· å·²è¦†ç›– 0</span>
      <span class="sum-div">|</span>
      <span class="sum-chip sc-v" id="sumV">ğŸ”¥ é«˜è½¬åŒ–è¯ 0 Â· å·²è¦†ç›– 0</span>
    </div>
    <div class="kw-cols" id="kwCols">
      <div class="kw-col">
        <div class="kw-col-hd">
          <div class="kw-col-title"><span class="col-ico ico-f">âš¡</span><span style="color:#1d4ed8">åŠŸèƒ½è¯</span><span class="kw-col-lim lim-f">å»ºè®®100ä¸ª</span></div>
          <div class="kw-col-desc">eSIMåŠŸèƒ½ã€è´­ä¹°ã€æ¿€æ´»ã€ä»·æ ¼ç­‰æ„å›¾è¯ï¼Œæ³¨å…¥H1å’ŒåŠŸèƒ½ç±»H2</div>
        </div>
        <textarea class="kw-ta ta-f" id="taF" placeholder="æ¯è¡Œä¸€ä¸ªï¼Œä¾‹å¦‚ï¼š&#10;best esim for russia&#10;russia esim plan&#10;how to activate esim&#10;cheap esim russia 2026&#10;..."></textarea>
        <div class="kw-col-btns">
          <button class="bp bp-f" onclick="parseKw('func')">âœ… å¯¼å…¥åŠŸèƒ½è¯</button>
          <button class="btn-sm-clr" onclick="clearKw('func')">ğŸ—‘ æ¸…ç©º</button>
          <span class="ph ph-ok" id="phF"></span>
        </div>
        <div class="cloud-wrap" id="cwF">
          <div class="cov-row"><span style="font-size:11px;font-weight:600;color:#1d4ed8;min-width:48px">è¦†ç›–ç‡</span><div class="cov-bg"><div class="cov-fill cf-f" id="cbF" style="width:0%"></div></div><span class="cov-pct" id="cpF" style="color:#1d4ed8">0%</span></div>
          <div class="kw-cloud" id="cloudF"></div>
        </div>
      </div>
      <div class="kw-col">
        <div class="kw-col-hd">
          <div class="kw-col-title"><span class="col-ico ico-c">ğŸ†</span><span style="color:#be185d">ç«å“è¯</span><span class="kw-col-lim lim-c">å»ºè®®10ä¸ª</span></div>
          <div class="kw-col-desc">ç«äº‰å“ç‰Œã€å¯¹æ¯”è¯ã€ç«å“ç›¸å…³æœç´¢è¯ï¼Œæ³¨å…¥å¯¹æ¯”ç±»H2</div>
        </div>
        <textarea class="kw-ta ta-c" id="taC" placeholder="æ¯è¡Œä¸€ä¸ªï¼Œä¾‹å¦‚ï¼š&#10;Airalo esim review&#10;Holafly vs Airalo&#10;Nomad esim&#10;Saily esim&#10;..."></textarea>
        <div class="kw-col-btns">
          <button class="bp bp-c" onclick="parseKw('comp')">âœ… å¯¼å…¥ç«å“è¯</button>
          <button class="btn-sm-clr" onclick="clearKw('comp')">ğŸ—‘ æ¸…ç©º</button>
          <span class="ph ph-ok" id="phC"></span>
        </div>
        <div class="cloud-wrap" id="cwC">
          <div class="cov-row"><span style="font-size:11px;font-weight:600;color:#be185d;min-width:48px">è¦†ç›–ç‡</span><div class="cov-bg"><div class="cov-fill cf-c" id="cbC" style="width:0%"></div></div><span class="cov-pct" id="cpC" style="color:#be185d">0%</span></div>
          <div class="kw-cloud" id="cloudC"></div>
        </div>
      </div>
      <div class="kw-col">
        <div class="kw-col-hd">
          <div class="kw-col-title"><span class="col-ico ico-l">ğŸ“</span><span style="color:#0f766e">åœ°åŒºè¯</span><span class="kw-col-lim lim-l">å»ºè®®50ä¸ª</span></div>
          <div class="kw-col-desc">åŸå¸‚ã€åœ°åŒºã€æ™¯ç‚¹è¯ï¼Œæ³¨å…¥è¦†ç›–å’Œåœºæ™¯ç±»H2</div>
        </div>
        <textarea class="kw-ta ta-l" id="taL" placeholder="æ¯è¡Œä¸€ä¸ªï¼Œä¾‹å¦‚ï¼š&#10;esim moscow&#10;esim st petersburg&#10;russia sim card&#10;baikal lake esim&#10;..."></textarea>
        <div class="kw-col-btns">
          <button class="bp bp-l" onclick="parseKw('loc')">âœ… å¯¼å…¥åœ°åŒºè¯</button>
          <button class="btn-sm-clr" onclick="clearKw('loc')">ğŸ—‘ æ¸…ç©º</button>
          <span class="ph ph-ok" id="phL"></span>
        </div>
        <div class="cloud-wrap" id="cwL">
          <div class="cov-row"><span style="font-size:11px;font-weight:600;color:#0f766e;min-width:48px">è¦†ç›–ç‡</span><div class="cov-bg"><div class="cov-fill cf-l" id="cbL" style="width:0%"></div></div><span class="cov-pct" id="cpL" style="color:#0f766e">0%</span></div>
          <div class="kw-cloud" id="cloudL"></div>
        </div>
      </div>
      <div class="kw-col" style="background:linear-gradient(180deg,#fffaf5,#fff7ed)">
        <div class="kw-col-hd">
          <div class="kw-col-title"><span class="col-ico ico-v">ğŸ”¥</span><span style="color:#c2410c">é«˜è½¬åŒ–è¯</span><span class="kw-col-lim lim-v">å»ºè®®30ä¸ª</span></div>
          <div class="kw-col-desc">ä¼˜æƒ ç ã€æœ€ä½ä»·ã€æŠ˜æ‰£ã€è´­ä¹°æ¨èç­‰é«˜æ„å‘è¯ï¼Œä¼˜å…ˆé©±åŠ¨H1ä¸»æ ‡é¢˜</div>
        </div>
        <textarea class="kw-ta ta-v" id="taV" placeholder="æ¯è¡Œä¸€ä¸ªï¼Œä¾‹å¦‚ï¼š&#10;ä¿„ç½—æ–¯eSIMä¼˜æƒ ç &#10;ä¿„ç½—æ–¯eSIMæœ€ä¾¿å®œ&#10;ä¹°ä¿„ç½—æ–¯eSIMæ¨è&#10;russia esim deal&#10;..."></textarea>
        <div class="kw-col-btns">
          <button class="bp bp-v" onclick="parseKw('conv')">âœ… å¯¼å…¥é«˜è½¬åŒ–è¯</button>
          <button class="btn-sm-clr" onclick="clearKw('conv')">ğŸ—‘ æ¸…ç©º</button>
          <span class="ph ph-ok" id="phV"></span>
        </div>
        <div class="cloud-wrap" id="cwV">
          <div class="cov-row"><span style="font-size:11px;font-weight:600;color:#c2410c;min-width:48px">è¦†ç›–ç‡</span><div class="cov-bg"><div class="cov-fill cf-v" id="cbV" style="width:0%"></div></div><span class="cov-pct" id="cpV" style="color:#c2410c">0%</span></div>
          <div class="kw-cloud" id="cloudV"></div>
        </div>
        <div style="margin-top:9px;padding:7px 10px;background:#fff0e6;border:1px solid #fdba74;border-radius:8px;font-size:10.5px;color:#9a3412;line-height:1.6">
          <b>ğŸ”¥ é«˜è½¬åŒ–è¯ä¼˜å…ˆçº§æœ€é«˜ï¼š</b>æœ‰é«˜è½¬åŒ–è¯æ—¶ï¼ŒH1ä¼˜å…ˆä½¿ç”¨é«˜è½¬åŒ–è¯æ¨¡æ¿ï¼›ç¡®è®¤H1åï¼ŒH2ä¿ƒé”€æŠ˜æ‰£ç« èŠ‚ä¸“å±æ³¨å…¥
        </div>
      </div>
    </div>
  </div>

  <!-- CONTROL -->
  <div class="ctrl">
    <div class="fg">
      <label>å¹´ä»½</label>
      <select id="selYear"><option value="2026">2026</option><option value="2025">2025</option></select>
    </div>
    <div class="fg">
      <label>H2 æ•°é‡</label>
      <select id="selH2n"><option value="8">8 ä¸ª</option><option value="10">10 ä¸ª</option><option value="11">11 ä¸ª</option></select>
    </div>
    <div class="fg">
      <label>ç”Ÿæˆæ•°é‡</label>
      <select id="selBatch"><option value="1">å•ç¯‡</option><option value="3">3 ç¯‡</option><option value="5">5 ç¯‡</option><option value="10">10 ç¯‡</option></select>
    </div>
    <div class="btn-grp">
      <button class="btn btn-pri" onclick="generateH1Step()">âš¡ ç”ŸæˆH1æ ‡é¢˜</button>
      <button class="btn btn-out" onclick="doReset()">ğŸ”„ é‡ç½®</button>
      <button class="btn btn-grn" id="btnExpAll" onclick="exportAll()" style="display:none">ğŸ“¥ å¯¼å‡ºå…¨éƒ¨</button>
    </div>
  </div>

  <!-- OUTPUT -->
  <div class="ocard" id="mainOCard">
    <div class="ocard-hd">
      <div class="ocard-hd-l">
        <span class="bdg bg-pri" id="bdgGen" style="display:none">æ­¥éª¤ 1/2</span>
        <span class="bdg bg-step" id="bdgStep" style="display:none">âœ… H1å·²ç¡®è®¤</span>
        <span class="bdg bg-orn" id="bdgConv" style="display:none">ğŸ”¥ é«˜è½¬åŒ–è¯é©±åŠ¨</span>
        <span class="bdg bg-amb" id="bdgKw" style="display:none">ğŸ”‘ å…³é”®è¯å·²æ³¨å…¥</span>
        <span class="bdg bg-grn" id="bdgDed" style="display:none">âœ“ æ ‡é¢˜å”¯ä¸€</span>
        <span class="ocard-title" id="ocardTitle">SEO Blog æ–‡ç« ç»“æ„</span>
      </div>
      <div class="ocard-hd-r">
        <button class="btn btn-pur" id="btnPrompt" onclick="generatePrompt()" style="display:none;padding:6px 12px;font-size:12px">ğŸ“ ç”ŸæˆPrompt</button>
        <button class="btn btn-out" id="btnCopySet" onclick="copySet()" style="display:none;padding:6px 12px;font-size:12px">ğŸ“‹ å¤åˆ¶æœ¬ç¯‡</button>
      </div>
    </div>
    <div class="ocard-body" id="outputBody">
      <div class="empty">
        <div class="empty-ico">ğŸ‡·ğŸ‡º</div>
        <h3>ä¸¤æ­¥å¼ç”Ÿæˆï¼Œç»“æ„æ›´ç²¾å‡†</h3>
        <p>
          <b>â‘  ç‚¹å‡»ã€Œç”ŸæˆH1æ ‡é¢˜ã€</b> â†’ æŸ¥çœ‹å¹¶ç¡®è®¤ä¸»æ ‡é¢˜<br>
          <b>â‘¡ ç‚¹å‡»ã€Œç¡®è®¤H1ï¼Œç”ŸæˆH2ã€</b> â†’ H2å›´ç»•H1è‡ªåŠ¨åŒ¹é…<br><br>
          åŸå¸‚ã€æœåŠ¡å•†ã€å…³é”®è¯ä¸Šä¸‹æ–‡ä¸H1å®Œå…¨ä¸€è‡´ Â· è¯»è€…æ—…ç¨‹æ’åº<br>
          å¯¼å…¥é«˜è½¬åŒ–è¯å¯ä¼˜å…ˆé©±åŠ¨H1ä¸ä¿ƒé”€ç« èŠ‚
        </p>
      </div>
    </div>
    <div class="ocard-ft" id="oFt">
      <button class="btn btn-pri" onclick="generateH1Step()" style="font-size:13px;padding:9px 18px">âš¡ ç»§ç»­ç”Ÿæˆ</button>
      <button class="btn btn-out" onclick="copySet()">ğŸ“‹ å¤åˆ¶æœ¬ç¯‡</button>
      <button class="btn btn-out" onclick="exportCurrent()">ğŸ“¤ å¯¼å‡ºæœ¬ç¯‡</button>
      <button class="btn btn-pur" onclick="generatePrompt()">ğŸ“ å†™ä½œPrompt</button>
    </div>
  </div>

  <!-- HISTORY -->
  <div class="hist-outer" id="histSec" style="display:none">
    <div class="hist-hd" onclick="toggleHist()">
      <h3>ğŸ“š å†å²è®°å½• <span id="histCnt" style="color:var(--pri)">0</span> ç¯‡ <span style="font-size:11px;color:var(--muted);font-weight:400">Â· ç‚¹å‡»å¡ç‰‡å¿«é€Ÿé¢„è§ˆ</span></h3>
      <span id="histArr" style="font-size:12px;color:var(--muted)">â–¼ å±•å¼€</span>
    </div>
    <div class="hist-body" id="histBody">
      <div class="hist-grid" id="histGrid"></div>
    </div>
  </div>
</div>

<!-- HISTORY PREVIEW MODAL -->
<div class="modal-ov" id="hpModal" onclick="closeHPModalBg(event)">
  <div class="modal-box" style="max-width:780px">
    <div class="modal-hd modal-hd-blue">
      <div class="modal-hd-l">
        <h3 id="hpTitle">ç¬¬ â€” ç¯‡æ–‡ç« ç»“æ„</h3>
        <p id="hpMeta">ä¿„ç½—æ–¯ Â· 2026</p>
      </div>
      <div style="display:flex;gap:7px;align-items:center;flex-wrap:wrap">
        <button class="btn btn-pri" onclick="loadHistIntoMain()" style="font-size:12px;padding:6px 13px">ğŸ“‚ ä½œä¸ºå½“å‰ç¯‡</button>
        <button class="btn btn-out" onclick="copyHistSet()" style="font-size:12px;padding:6px 11px">ğŸ“‹ å¤åˆ¶</button>
        <button class="modal-cls modal-cls-blue" onclick="closeHPModal()">âœ•</button>
      </div>
    </div>
    <div class="hp-nav" id="hpNav">
      <span class="hp-nav-info" id="hpNavInfo">ç¬¬ 1 / 1 ç¯‡</span>
      <div class="hp-nav-btns">
        <button class="hp-nav-btn hp-nav-prev" onclick="hpNavigate(-1)">â† ä¸Šä¸€ç¯‡</button>
        <button class="hp-nav-btn hp-nav-next" onclick="hpNavigate(1)">ä¸‹ä¸€ç¯‡ â†’</button>
      </div>
    </div>
    <div class="modal-body" id="hpBody"></div>
    <div class="modal-ft modal-ft-blue">
      <button class="btn btn-pri" onclick="loadHistIntoMain()">ğŸ“‚ ä½œä¸ºå½“å‰ç¯‡</button>
      <button class="btn btn-out" onclick="copyHistSet()">ğŸ“‹ å¤åˆ¶å…¨éƒ¨</button>
      <button class="btn btn-pur" onclick="generatePromptFromHP()">ğŸ“ ç”ŸæˆPrompt</button>
      <button class="btn btn-out" onclick="closeHPModal()">âœ• å…³é—­</button>
    </div>
  </div>
</div>

<!-- PROMPT MODAL -->
<div class="modal-ov" id="pModal" onclick="closeModalBg(event)">
  <div class="modal-box">
    <div class="modal-hd">
      <div class="modal-hd-l">
        <h3>ğŸ“ SEO å†™ä½œ Prompt ç”Ÿæˆå™¨</h3>
        <p>å¤åˆ¶åˆ° ChatGPT / Claude / Gemini â†’ ä¸€é”®ç”Ÿæˆå®Œæ•´ SEO æ–‡ç« </p>
      </div>
      <div style="display:flex;gap:7px;align-items:center">
        <button class="btn btn-pur" onclick="copyPrompt()" style="padding:7px 13px;font-size:12px">ğŸ“‹ å¤åˆ¶</button>
        <button class="modal-cls" onclick="closeModal()">âœ•</button>
      </div>
    </div>
    <div class="modal-info" id="mInfo"><span class="m-st msp">åŠ è½½ä¸­...</span></div>
    <div class="modal-tip">ğŸ’¡ å®Œæ•´å¤åˆ¶ Prompt â†’ ç²˜è´´åˆ° AI â†’ è‡ªåŠ¨ç”Ÿæˆ 2500-3500 å­— SEO æ–‡ç«  &nbsp;|&nbsp; ä¿®æ”¹è‡ªå®šä¹‰è¯åç‚¹ã€ŒğŸ”„ æ›´æ–°ã€å³æ—¶åˆ·æ–°</div>

    <div class="ckw-outer">
      <div class="ckw-hd" onclick="toggleCKW()">
        <div class="ckw-hd-l">
          <span>ğŸ¯</span>
          <span>è‡ªå®šä¹‰è¿½åŠ å…³é”®è¯</span>
          <span class="ckw-cnt-bdg" id="ckwCntBdg">0 ä¸ª</span>
          <span class="ckw-hint" id="ckwHintTxt">ï¼ˆå¯é€‰ï¼‰è¾“å…¥é¢å¤–å…³é”®è¯ï¼Œè‡ªåŠ¨è¿½åŠ åˆ°Prompt</span>
        </div>
        <span class="ckw-arr" id="ckwArr">â–¼ å±•å¼€è¾“å…¥</span>
      </div>
      <div class="ckw-bd" id="ckwBd">
        <div class="ckw-desc">
          ğŸ“Œ åœ¨æ­¤è¾“å…¥é¢å¤–å…³é”®è¯ï¼ˆæ¯è¡Œä¸€ä¸ªï¼Œæˆ–é€—å·åˆ†éš”ï¼‰ï¼Œå°†ä½œä¸º<b>ã€è‡ªå®šä¹‰å…³é”®è¯ã€‘</b>å•ç‹¬åŒºå—è¿½åŠ åˆ°Promptä¸­ï¼ŒAIå†™ä½œæ—¶å°†å…¨éƒ¨è‡ªç„¶æ¤å…¥æ–‡ç« ã€‚<br>
          âš¡ é€‚åˆï¼šé•¿å°¾è¯è¡¥å…… Â· ä¸´æ—¶SEOéœ€æ±‚ Â· ç‰¹å®šæ´»åŠ¨è¯ Â· å“ç‰Œè¯ç­‰
        </div>
        <div class="ckw-input-row">
          <textarea class="ckw-ta" id="ckwTa" placeholder="æ¯è¡Œä¸€ä¸ªï¼Œä¾‹å¦‚ï¼š&#10;ä¿„ç½—æ–¯æ—…è¡Œä¸Šç½‘æ¨è&#10;eSIMä¸ç”¨æ¢å¡&#10;russia travel internet&#10;å‡ºå¢ƒæ¸¸ä¸Šç½‘å¡&#10;..." oninput="onCKWInput()"></textarea>
          <div class="ckw-side">
            <button class="btn btn-pur" onclick="refreshPrompt()" style="font-size:12px;padding:7px 13px;white-space:nowrap">ğŸ”„ æ›´æ–°Prompt</button>
            <button class="btn btn-out" onclick="clearCKW()" style="font-size:12px;padding:7px 11px">ğŸ—‘ æ¸…ç©º</button>
          </div>
        </div>
        <div class="ckw-btns">
          <span style="font-size:11px;color:var(--muted);font-style:italic">ä¿®æ”¹åç‚¹å‡»ã€ŒğŸ”„ æ›´æ–°Promptã€å³æ—¶ç”Ÿæ•ˆ</span>
        </div>
        <div class="ckw-chips-wrap">
          <div class="ckw-chips-title" id="ckwChipsTitle">å·²æ·»åŠ å…³é”®è¯é¢„è§ˆï¼š</div>
          <div class="ckw-chips" id="ckwChips"></div>
        </div>
      </div>
    </div>

    <div class="modal-body">
      <textarea class="prompt-ta" id="promptTa" readonly onclick="this.select()"></textarea>
    </div>
    <div class="modal-ft">
      <button class="btn btn-pur" onclick="copyPrompt()">ğŸ“‹ å¤åˆ¶ Prompt</button>
      <button class="btn btn-out" onclick="exportPrompt()">ğŸ“¤ å¯¼å‡º TXT</button>
      <button class="btn btn-out" onclick="closeModal()">âœ• å…³é—­</button>
      <span class="modal-ft-hint">ç‚¹å‡»æ–‡æœ¬åŒº â†’ Ctrl+A å…¨é€‰</span>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ============================================================
// DATABASE
// ============================================================
var DB = {
  russia:{kw:'ä¿„ç½—æ–¯eSIM',name:'ä¿„ç½—æ–¯',
    cities:['è«æ–¯ç§‘','åœ£å½¼å¾—å ¡','å¶å¡æ·ç³å ¡','å–€å±±','ç´¢å¥‘','ç¬¦æ‹‰è¿ªæ²ƒæ–¯æ‰˜å…‹','ä¼Šå°”åº“èŒ¨å…‹','æ–°è¥¿ä¼¯åˆ©äºš'],
    carriers:['MTS','Beeline','MegaFon','Tele2 Russia','Yota','Rostelecom'],
    providers:['Airalo','Holafly','Nomad','Saily','SimOptions','GigSky','OneSimCard'],
    parks:['è´åŠ å°”æ¹–','å ªå¯ŸåŠ ','é˜¿å°”æ³°å±±','è¥¿ä¼¯åˆ©äºš','ç§‘ç±³æ£®æ—'],
    userTypes:['æ—…è¡Œè€…','å•†åŠ¡äººå£«','ç•™å­¦ç”Ÿ','æ¢é™©çˆ±å¥½è€…','æ‘„å½±æ—…è¡Œè€…','æ–‡åŒ–æ¸¸å®¢'],
    scenes:['åŸå¸‚è§‚å…‰','å•†åŠ¡å‡ºå·®','è¥¿ä¼¯åˆ©äºšé“è·¯æ¸¸','å†¬å­£æ—…è¡Œ','æ–‡åŒ–ä½“éªŒ','ç•™å­¦'],
    durations:['3å¤©','5å¤©','7å¤©','14å¤©','30å¤©','90å¤©'],
    issues:['æ¿€æ´»æ­¥éª¤å¤æ‚','è¦†ç›–ä¸å‡åŒ€','é€Ÿåº¦ä¸ç¨³å®š','ç½‘ç»œè®¿é—®å—é™']}
};
var DEVICES = ['iPhone','å®‰å“æ‰‹æœº','ä¸‰æ˜ŸGalaxy','iPhone 16 Pro','è°·æ­ŒPixel'];
var COUNTS = ['3','5','6','7','8'];
var DEST_KEY = 'russia';

// ============================================================
// READER JOURNEY & PHASE MAPPING
// ============================================================
var CAT_ORDER = ['comparison','price','coverage','recommend','deal','purchase','prepare','activation','scenario','tips','faq'];

var CAT_PHASE = {
  comparison: {phase:'æ¯”è¾ƒç­›é€‰',  cls:'fp-cmp',  icon:'âš–ï¸'},
  price:      {phase:'æ¯”è¾ƒç­›é€‰',  cls:'fp-cmp',  icon:'âš–ï¸'},
  coverage:   {phase:'æ¯”è¾ƒç­›é€‰',  cls:'fp-cmp',  icon:'âš–ï¸'},
  recommend:  {phase:'å†³ç­–ç¡®å®š',  cls:'fp-dec',  icon:'âœ…'},
  deal:       {phase:'ä¿ƒé”€è½¬åŒ–',  cls:'fp-conv', icon:'ğŸ”¥'},
  purchase:   {phase:'è´­ä¹°è¡ŒåŠ¨',  cls:'fp-act',  icon:'ğŸ›’'},
  prepare:    {phase:'è´­ä¹°è¡ŒåŠ¨',  cls:'fp-act',  icon:'ğŸ›’'},
  activation: {phase:'æ¿€æ´»ä½¿ç”¨',  cls:'fp-use',  icon:'ğŸ“±'},
  scenario:   {phase:'æ¿€æ´»ä½¿ç”¨',  cls:'fp-use',  icon:'ğŸ“±'},
  tips:       {phase:'æ¿€æ´»ä½¿ç”¨',  cls:'fp-use',  icon:'ğŸ“±'},
  faq:        {phase:'è§£æƒ‘æ”¯æŒ',  cls:'fp-sup',  icon:'ğŸ’¬'}
};

var CATS = {
  purchase:{name:'è´­ä¹°æŒ‡å—',cls:'c-pur',kwType:'func',altKwType:'conv',
    tStd:['{kw}è´­ä¹°æ¸ é“å¯¹æ¯”{year}','{p1}å¦‚ä½•è´­ä¹°ï¼Ÿæ­¥éª¤è¯¦è§£','{kw}ï¼šå®˜ç½‘vsç¬¬ä¸‰æ–¹å¹³å°','{kw}è´­ä¹°å‰{cnt}å¤§æ³¨æ„ç‚¹','{dur}è¡Œç¨‹å¥—é¤æ€ä¹ˆé€‰'],
    tKw:['{injKw}åœ¨å“ªä¹°æœ€åˆ’ç®—','{injKw}è´­ä¹°æ­¥éª¤å…¨è§£','{injKw}ï¼š{year}æ¸ é“ä»·æ ¼æ¯”','{injKw}è´­ä¹°å‰å¿…çŸ¥{cnt}ç‚¹','{injKw}æå‰ä¹°è¿˜æ˜¯è½åœ°ä¹°']},
  activation:{name:'æ¿€æ´»æ•™ç¨‹',cls:'c-act',kwType:'func',
    tStd:['{device}æ¿€æ´»{kw}æ­¥éª¤è¯¦è§£','{kw}æ¿€æ´»å¤±è´¥è§£å†³æ–¹æ³•','{kw}äºŒç»´ç æ¿€æ´»æ•™ç¨‹','{kw}æ¿€æ´»æ—¶æœºæ€ä¹ˆé€‰'],
    tKw:['{injKw}æ¿€æ´»å®Œæ•´æ­¥éª¤','{device}å¦‚ä½•æ¿€æ´»{injKw}','{injKw}æ¿€æ´»å¤±è´¥åŸå› ä¸è§£å†³','{injKw}å‡ºå‘å‰vsè½åœ°åæ¿€æ´»']},
  price:{name:'ä»·æ ¼å¯¹æ¯”',cls:'c-pri',kwType:'func',altKwType:'conv',
    tStd:['{year}{kw}å¥—é¤ä»·æ ¼æ¨ªè¯„','{kw}ï¼š{c1}vs{c2}æ”¶è´¹å¯¹æ¯”','{dur}è¡Œç¨‹æ€»èŠ±è´¹æµ‹ç®—','{kw}éšè—è´¹ç”¨å…¨æ­ç§˜'],
    tKw:['{injKw}ä»·æ ¼{year}å…¨å¯¹æ¯”','{injKw}å¤šå°‘é’±åˆç†','{injKw}éšè—è´¹ç”¨é¡»çŸ¥','{injKw}æŠ˜æ‰£ç çœé’±æŠ€å·§']},
  coverage:{name:'ç½‘é€Ÿè¦†ç›–',cls:'c-cov',kwType:'loc',
    tStd:['{city}{kw}ä¿¡å·è¦†ç›–æŠ¥å‘Š','{kw}ï¼š{c1}vs{c2}ç½‘é€Ÿ','{dest}å„åŸå¸‚eSIMè¦†ç›–','{city}å®¤å†…å¤–ä¿¡å·è¡¨ç°'],
    tKw:['{injKw}è¦†ç›–ä¸ç½‘é€Ÿåˆ†æ','å»{injKw}ä¸Šç½‘æ¨è','{injKw} 5G/4Gè¦†ç›–æŠ¥å‘Š','{injKw}åŸåŒºvséƒŠåŒºä¿¡å·']},
  faq:{name:'å¸¸è§é—®é¢˜',cls:'c-faq',kwType:'func',
    tStd:['{kw}æ–°æ‰‹{cnt}å¤§å¸¸è§ç–‘é—®','{kw}èƒ½æ‰“ç”µè¯å—ï¼Ÿ','eSIMä¸å®ä½“SIMåŒºåˆ«','{kw}å®‰å…¨æ€§æ€ä¹ˆæ ·'],
    tKw:['{injKw}å¸¸è§ç–‘é—®è§£ç­”','{cnt}ä¸ª{injKw}å¸¸è§è¯¯åŒº','{injKw}å®‰å…¨æ€§è¯´æ˜','{injKw}åŠŸèƒ½é™åˆ¶é¡»çŸ¥']},
  comparison:{name:'äº§å“å¯¹æ¯”',cls:'c-cmp',kwType:'comp',
    tStd:['{p1}vs{p2}ï¼š{dest}eSIMæ¨ªè¯„','{kw}ä¸»æµæ–¹æ¡ˆå¤§å¯¹æ¯”','{kw}vså®ä½“SIM{year}','æœ€é€‚åˆ{userType}çš„é€‰æ‹©'],
    tKw:['{injKw}vsç«å“æ·±åº¦å¯¹æ¯”','{injKw}ä¸å…¶ä»–æ–¹æ¡ˆåŒºåˆ«','{injKw}ç»¼åˆå¯¹æ¯”{year}','{injKw}è¯„åˆ†æ±‡æ€»æ‰“è¡¨']},
  scenario:{name:'ä½¿ç”¨åœºæ™¯',cls:'c-scn',kwType:'loc',
    tStd:['{dur}{scene}ï¼š{kw}æ¨è','{dest}è‡ªé©¾æ¸¸eSIMæ”»ç•¥','ç•™å­¦ç”Ÿ{dest}é•¿æœŸeSIMæ–¹æ¡ˆ','æ•°å­—æ¸¸æ°‘{dest}ç¨³å®šä¸Šç½‘'],
    tKw:['{injKw}æ—…è¡Œä¸Šç½‘æŒ‡å—','{dur}å»{injKw}ä¸Šç½‘æ¨è','{injKw}å•†åŠ¡å‡ºè¡Œå¥—é¤','{injKw}ç•™å­¦é•¿æœŸæ–¹æ¡ˆ']},
  tips:{name:'ä½¿ç”¨æŠ€å·§',cls:'c-tip',kwType:'func',
    tStd:['{kw}çœæµé‡{cnt}ä¸ªæŠ€å·§','{kw}ç»­è´¹ä¸æ–­ç½‘æ”»ç•¥','å»¶é•¿{kw}æœ‰æ•ˆæœŸæ–¹æ³•'],
    tKw:['{injKw}çœé’±ä½¿ç”¨æŠ€å·§','{injKw}æµé‡ç®¡ç†æ–¹æ³•','{cnt}æ‹›{injKw}çœæµå®æµ‹','{injKw}ç»­è´¹æ— ç¼è¡”æ¥']},
  recommend:{name:'å¥—é¤æ¨è',cls:'c-rec',kwType:'func',altKwType:'conv',
    tStd:['{year}æ€§ä»·æ¯”æœ€é«˜{kw}å¥—é¤','{userType}ä¸“å±{kw}æ¨è','{kw}åˆ†åœºæ™¯å¥—é¤ç²¾é€‰'],
    tKw:['{injKw}å¥—é¤ç²¾é€‰{year}','{injKw}å“ªæ¬¾æœ€å¥½ç”¨','{userType}é¦–é€‰{injKw}','{injKw}å…¥é—¨é¦–é€‰å¥—é¤']},
  prepare:{name:'å‡ºè¡Œå‡†å¤‡',cls:'c-pre',kwType:'func',
    tStd:['å‡ºå‘{dest}å‰{kw}å‡†å¤‡æ¸…å•','{dest}å‡ºè¡Œ{kw}è®¾ç½®æ•™ç¨‹','{device}å‡ºè¡Œ{kw}æ£€æŸ¥æ¸…å•'],
    tKw:['å‡ºè¡Œå‰{injKw}å‡†å¤‡æ¸…å•','{dest}å‡ºè¡Œ{injKw}é…ç½®','æå‰è´­ä¹°{injKw}æ—¶æœº','{injKw}å‡ºå‘å‰å¿…å¤‡æ­¥éª¤']},
  deal:{name:'ä¼˜æƒ æŠ˜æ‰£',cls:'c-deal',kwType:'conv',altKwType:'func',
    tStd:['{year}{kw}ä¼˜æƒ ç é¢†å–æ–¹æ³•','{kw}å†å²æœ€ä½ä»·è´­ä¹°æ¸ é“','{year}è´­ä¹°{kw}çœé’±æŠ€å·§','{kw}å®˜æ–¹æ´»åŠ¨ä¸æŠ˜æ‰£æ•´ç†'],
    tKw:['{injKw}æŠ˜æ‰£ç ä½¿ç”¨æ•™ç¨‹','{injKw}æœ€ä½ä»·{year}è´­ä¹°','{injKw}é™æ—¶ä¼˜æƒ æ´»åŠ¨è¯´æ˜','å¦‚ä½•ç”¨{injKw}çœæ›´å¤šé’±','{injKw}ï¼š{year}æœ€æ–°ä¿ƒé”€æ•´ç†','{year}æœ€åˆ’ç®—{injKw}å¥—é¤']}
};

var H1T_STD = [
  '{year}å¹´{kw}ï¼šè´­ä¹°Â·æ¿€æ´»Â·å¥—é¤å…¨æ”»ç•¥',
  '{kw}æ·±åº¦æµ‹è¯„{year}ï¼šå“ªå®¶æœ€å€¼',
  '{dest}æ—…è¡Œé¦–é€‰{kw}ï¼š{year}æ¨è',
  '{year}æœ€æ–°{kw}ï¼š{city}æŠ¥å‘Š',
  '{kw}é€‰è´­æŒ‡å—{year}ï¼š{userType}ç‰ˆ',
  '{p1} vs {p2}ï¼š{dest}eSIMæ¨ªè¯„',
  '{kw}çœé’±æ”»ç•¥ï¼š{dur}æœ€ä¼˜å¥—é¤',
  '{device}æ¿€æ´»{kw}å…¨æµç¨‹{year}',
  '{dest}å•†åŠ¡å‡ºè¡Œ{kw}ç²¾é€‰{year}',
  'å‘Šåˆ«æ¼«æ¸¸ï¼š{year}å¹´{kw}å®Œæ•´æŒ‡å—',
  '{year}{kw}ç»¼åˆåˆ†æï¼šé€Ÿåº¦Â·ä»·æ ¼Â·è¦†ç›–',
  '{kw}æ–°æ‰‹å¿…è¯»{year}ï¼šé€‰è´­åˆ°æ¿€æ´»',
  '{dur}å‡ºè¡Œ{kw}æ€ä¹ˆé€‰ï¼Ÿ{year}åˆ†æ',
  '{year}å¹´{kw}ï¼š{city}åœ°åŒºæŠ¥å‘Š',
  '{kw}vså®ä½“SIMï¼š{year}ç»¼åˆæ¯”è¾ƒ',
  '{city}å®æµ‹{kw}ï¼š{year}ç½‘é€Ÿä¸è¦†ç›–',
  '{year}{dest}æœ€ä½³eSIMï¼š{p1}æŒ‡å—',
  '{userType}ä¸“ç”¨{kw}æ¨è{year}'
];
var H1T_KW = [
  '{injKw}ï¼š{year}å®Œæ•´ä½¿ç”¨æŒ‡å—',
  '{injKw}æ·±åº¦åˆ†æ{year}',
  '{injKw}ï¼š{dest}æœ€ä¼˜ä¸Šç½‘æ–¹æ¡ˆ',
  '{injKw}è´­ä¹°ä¸æ¿€æ´»å…¨æµç¨‹',
  '{injKw}æ€§ä»·æ¯”åˆ†æ{year}',
  '{injKw}çœé’±é€‰è´­æ”»ç•¥',
  '{injKw}vså®ä½“SIMï¼š{dest}å“ªä¸ªå¥½',
  '{year}{dest}æ¨èï¼š{injKw}æŒ‡å—',
  '{injKw}å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ',
  '{dest}å‡ºè¡Œ{injKw}ï¼š{year}å®Œå…¨ç‰ˆ',
  '{injKw}æ€ä¹ˆä¹°æ€ä¹ˆç”¨{year}'
];
var H1T_CONV = [
  '{injKw}ï¼š{year}å®Œæ•´ä½¿ç”¨æ”»ç•¥',
  '{injKw}æ€ä¹ˆä¹°æœ€çœé’±ï¼Ÿ{year}æŒ‡å—',
  '{year}å¹´{injKw}ï¼šæ¸ é“+æœ€ä½ä»·',
  '{injKw}æŠ˜æ‰£ä¸çœé’±ï¼š{year}æœ€æ–°',
  '{dest}å‡ºè¡Œé¦–é€‰{injKw}ï¼šçœé’±ç‰ˆ',
  '{injKw}vsæ™®é€šæ–¹æ¡ˆï¼šå“ªä¸ªæ›´å€¼',
  '{year}{dest}æ¨èï¼š{injKw}æŒ‡å—',
  '{injKw}ï¼šæ¿€æ´»Â·è´­ä¹°Â·çœé’±å…¨æ”»ç•¥',
  '{injKw}ç”¨æˆ·æŒ‡å—ï¼š{year}å®Œæ•´ç‰ˆ',
  '{injKw}è´­ä¹°æŒ‡å—ï¼š{year}æœ€ä¼˜æ¸ é“',
  '{year}æœ€å€¼å¾—ä¹°{dest}eSIMï¼š{injKw}',
  '{injKw}çœŸçš„ä¾¿å®œå—ï¼Ÿ{year}æ·±åº¦å¯¹æ¯”'
];

// ============================================================
// STATE
// ============================================================
var kwPools = {func:[], comp:[], loc:[], conv:[]};
var kwUsed  = {func:{}, comp:{}, loc:{}, conv:{}};
var kwRR    = {func:0, comp:0, loc:0, conv:0};
var genCount = 0;
var curSet = null;
var hist = [];
var usedH1Set = {};
var kwMgrOpen = false;
var hpItem = null;
var hpIdx = 0;
var ckwOpen = false;

// ---- Two-step state ----
var pendingH1s  = [];   // array of h1 result objects waiting for confirmation
var pendingYear = '';
var pendingH2n  = 8;
var regenSeeds  = {};   // {idx: regenCount}

// ============================================================
// CUSTOM KEYWORDS
// ============================================================
function toggleCKW() {
  ckwOpen = !ckwOpen;
  document.getElementById('ckwBd').className = 'ckw-bd' + (ckwOpen ? ' open' : '');
  document.getElementById('ckwArr').textContent = ckwOpen ? 'â–² æ”¶èµ·' : 'â–¼ å±•å¼€è¾“å…¥';
}
function getCustomKws() {
  var raw = document.getElementById('ckwTa').value.trim();
  if (!raw) return [];
  var parts = raw.split(/[\n\r,ï¼Œ;ï¼›]+/);
  var result = [], seen = {};
  for (var i = 0; i < parts.length; i++) {
    var kw = parts[i].trim();
    if (kw && kw.length <= 100 && !seen[kw]) { seen[kw] = true; result.push(kw); }
  }
  return result;
}
function onCKWInput() { updateCKWPreview(); }
function updateCKWPreview() {
  var kws = getCustomKws();
  var cntBdg  = document.getElementById('ckwCntBdg');
  var hintTxt = document.getElementById('ckwHintTxt');
  var title   = document.getElementById('ckwChipsTitle');
  var chips   = document.getElementById('ckwChips');
  if (kws.length > 0) {
    cntBdg.style.display  = 'inline'; cntBdg.textContent = kws.length + ' ä¸ª';
    hintTxt.style.display = 'none'; title.style.display = 'block';
    var html = '';
    for (var i = 0; i < kws.length; i++) html += '<span class="kt kt-cu2">ğŸ¯ ' + escHtml(kws[i]) + '</span>';
    chips.innerHTML = html;
  } else {
    cntBdg.style.display  = 'none'; hintTxt.style.display = 'inline';
    title.style.display   = 'none'; chips.innerHTML = '';
  }
}
function clearCKW() { document.getElementById('ckwTa').value = ''; updateCKWPreview(); showToast('ğŸ—‘ è‡ªå®šä¹‰å…³é”®è¯å·²æ¸…ç©º'); }
function refreshPrompt() { if (!curSet) { showToast('è¯·å…ˆå®Œæˆæ–‡ç« ç»“æ„ç”Ÿæˆ'); return; } updateCKWPreview(); buildPromptContent(); showToast('âœ… Prompt å·²æ›´æ–°'); }

// ============================================================
// KEYWORD MANAGEMENT
// ============================================================
function parseKw(type) {
  var taMap  = {func:'taF', comp:'taC', loc:'taL', conv:'taV'};
  var phMap  = {func:'phF', comp:'phC', loc:'phL', conv:'phV'};
  var maxMap = {func:200, comp:30, loc:120, conv:80};
  var nameMap= {func:'åŠŸèƒ½è¯', comp:'ç«å“è¯', loc:'åœ°åŒºè¯', conv:'é«˜è½¬åŒ–è¯'};
  var raw = document.getElementById(taMap[type]).value.trim();
  if (!raw) { showToast('è¯·å…ˆç²˜è´´å…³é”®è¯'); return; }
  var parts = raw.split(/[\n\r,ï¼Œ;ï¼›]+/);
  var result = [], seen = {};
  for (var i = 0; i < parts.length; i++) {
    var kw = parts[i].trim();
    if (kw.length > 0 && kw.length <= 100 && !seen[kw] && result.length < maxMap[type]) { seen[kw] = true; result.push(kw); }
  }
  if (!result.length) { showToast('æœªè¯†åˆ«åˆ°æœ‰æ•ˆå…³é”®è¯'); return; }
  kwPools[type] = result; kwUsed[type] = {}; kwRR[type] = 0;
  var ph = document.getElementById(phMap[type]);
  ph.textContent = 'âœ… å·²å¯¼å…¥ ' + result.length + ' ä¸ª'; ph.className = 'ph ph-ok';
  renderCloud(type); updateSummary();
  showToast('âœ… ' + nameMap[type] + ' å¯¼å…¥ ' + result.length + ' ä¸ª');
}
function clearKw(type) {
  var taMap  = {func:'taF', comp:'taC', loc:'taL', conv:'taV'};
  var phMap  = {func:'phF', comp:'phC', loc:'phL', conv:'phV'};
  var nameMap= {func:'åŠŸèƒ½è¯', comp:'ç«å“è¯', loc:'åœ°åŒºè¯', conv:'é«˜è½¬åŒ–è¯'};
  document.getElementById(taMap[type]).value = '';
  document.getElementById(phMap[type]).textContent = '';
  kwPools[type] = []; kwUsed[type] = {};
  renderCloud(type); updateSummary();
  showToast('ğŸ—‘ ' + nameMap[type] + ' å·²æ¸…ç©º');
}
function renderCloud(type) {
  var pool = kwPools[type], used = kwUsed[type];
  var cloudMap = {func:'cloudF',comp:'cloudC',loc:'cloudL',conv:'cloudV'};
  var wrapMap  = {func:'cwF',comp:'cwC',loc:'cwL',conv:'cwV'};
  var barMap   = {func:'cbF',comp:'cbC',loc:'cbL',conv:'cbV'};
  var pctMap   = {func:'cpF',comp:'cpC',loc:'cpL',conv:'cpV'};
  var uCls = {func:'kt-fu',comp:'kt-cu',loc:'kt-lu',conv:'kt-vu'}[type];
  var nCls = {func:'kt-fn',comp:'kt-cn',loc:'kt-ln',conv:'kt-vn'}[type];
  var cloudEl=document.getElementById(cloudMap[type]);
  var wrapEl=document.getElementById(wrapMap[type]);
  var barEl=document.getElementById(barMap[type]);
  var pctEl=document.getElementById(pctMap[type]);
  if (!pool.length) { if (wrapEl) wrapEl.classList.remove('show'); return; }
  var usedCnt = 0;
  for (var k in used) { if (used[k] > 0) usedCnt++; }
  var pct = pool.length > 0 ? Math.round(usedCnt / pool.length * 100) : 0;
  if (barEl) barEl.style.width = pct + '%';
  if (pctEl) pctEl.textContent = pct + '%';
  var html = '';
  for (var i = 0; i < pool.length; i++) html += '<span class="kt ' + (used[i] > 0 ? uCls : nCls) + '">' + escHtml(pool[i]) + '</span>';
  if (cloudEl) cloudEl.innerHTML = html;
  if (wrapEl) wrapEl.classList.add('show');
}
function updateSummary() {
  var types=['func','comp','loc','conv'];
  var names={func:'åŠŸèƒ½è¯',comp:'ç«å“è¯',loc:'åœ°åŒºè¯',conv:'é«˜è½¬åŒ–è¯'};
  var icons={func:'âš¡',comp:'ğŸ†',loc:'ğŸ“',conv:'ğŸ”¥'};
  var pillMap={func:'pillF',comp:'pillC',loc:'pillL',conv:'pillV'};
  var sumMap={func:'sumF',comp:'sumC',loc:'sumL',conv:'sumV'};
  var hdrMap={func:'sFN',comp:'sCN',loc:'sLN',conv:'sVN'};
  var hasAny = false;
  for (var i=0;i<types.length;i++) {
    var t=types[i];
    var total=kwPools[t].length;
    var usedCnt=0; for(var k in kwUsed[t]){if(kwUsed[t][k]>0)usedCnt++;}
    var pill=document.getElementById(pillMap[t]);
    var sum=document.getElementById(sumMap[t]);
    var hdr=document.getElementById(hdrMap[t]);
    if(pill) pill.textContent=names[t]+' '+total;
    if(sum)  sum.textContent=icons[t]+' '+names[t]+' '+total+' Â· å·²è¦†ç›– '+usedCnt;
    if(hdr)  hdr.textContent=total;
    if(total>0) hasAny=true;
  }
  var mgr=document.getElementById('kwMgr');
  var hint=document.getElementById('kwHint');
  var summary=document.getElementById('kwSummary');
  if(hasAny){
    mgr.classList.add('has-kws');
    if(hint) hint.style.display='none';
    if(!kwMgrOpen&&summary) summary.classList.add('show');
  } else {
    mgr.classList.remove('has-kws');
    if(hint) hint.style.display='inline';
    if(summary) summary.classList.remove('show');
  }
}
function toggleKwMgr() {
  kwMgrOpen = !kwMgrOpen;
  var cols=document.getElementById('kwCols');
  var btn=document.getElementById('kwToggle');
  var sum=document.getElementById('kwSummary');
  cols.className='kw-cols'+(kwMgrOpen?' open':'');
  btn.textContent=kwMgrOpen?'â–² æ”¶èµ·':'â–¼ å±•å¼€ç®¡ç†';
  var hasAny=kwPools.func.length>0||kwPools.comp.length>0||kwPools.loc.length>0||kwPools.conv.length>0;
  if(hasAny){ if(kwMgrOpen) sum.classList.remove('show'); else sum.classList.add('show'); }
}

// ============================================================
// GENERATION HELPERS
// ============================================================
function pickItem(arr,n){ if(!arr||!arr.length) return ''; return arr[((n%arr.length)+arr.length)%arr.length]; }
function getPoolKw(type,offset){
  var pool=kwPools[type];
  if(!pool||!pool.length) return null;
  var idx=(kwRR[type]+(offset||0))%pool.length;
  return {kw:pool[idx],idx:idx};
}
function markUsed(type,idx){
  if(idx==null||idx<0) return;
  if(!kwUsed[type][idx]) kwUsed[type][idx]=0;
  kwUsed[type][idx]++;
}
function advanceRR(){
  var types=['func','comp','loc','conv'];
  for(var i=0;i<types.length;i++){
    var t=types[i];
    if(kwPools[t].length>0) kwRR[t]=(kwRR[t]+1)%kwPools[t].length;
  }
}
function buildCtx(year,seed,injKw){
  var d=DB[DEST_KEY];
  var s=Math.abs(seed)|0;
  var hl=d.carriers.length,pl=d.providers.length;
  var ci1=s%hl,ci2=(s+Math.ceil(hl/2)+1)%hl; if(ci2===ci1) ci2=(ci2+1)%hl;
  var pi1=s%pl,pi2=(s+Math.ceil(pl/2)+1)%pl; if(pi2===pi1) pi2=(pi2+1)%pl;
  return {
    kw:d.kw,dest:d.name,year:year,
    city:pickItem(d.cities,s),c1:d.carriers[ci1],c2:d.carriers[ci2],
    p1:d.providers[pi1],p2:d.providers[pi2],device:pickItem(DEVICES,s),
    dur:pickItem(d.durations,s),userType:pickItem(d.userTypes,s),
    scene:pickItem(d.scenes,s+2),cnt:pickItem(COUNTS,s),
    issue:pickItem(d.issues,s),park:pickItem(d.parks,s),
    injKw:injKw||d.kw
  };
}
function fill(tpl,ctx){
  var r=tpl;
  var keys=['kw','dest','year','city','c1','c2','p1','p2','device','dur','userType','scene','cnt','issue','park','injKw'];
  for(var i=0;i<keys.length;i++) r=r.split('{'+keys[i]+'}').join(ctx[keys[i]]||'');
  return r;
}
function escHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function getLogicalCats(n,seed){
  var all=CAT_ORDER.slice();
  var s=Math.abs(seed)|0;
  for(var i=all.length-1;i>0;i--){
    s=(s*1664525+1013904223)&0x7fffffff;
    var j=s%(i+1); var tmp=all[i]; all[i]=all[j]; all[j]=tmp;
  }
  var selected=all.slice(0,Math.min(n,all.length));
  selected.sort(function(a,b){ return CAT_ORDER.indexOf(a)-CAT_ORDER.indexOf(b); });
  return selected;
}

// ============================================================
// H1 GENERATION â€” returns ctx too
// ============================================================
function tryH1WithCtx(year, seed, attempt) {
  var d = DB[DEST_KEY];
  var s = Math.abs(seed * 7 + attempt * 19) | 0;
  var hasV = kwPools.conv.length > 0;
  var hasF = kwPools.func.length > 0;
  var vOff = hasV ? attempt % kwPools.conv.length : 0;
  var fOff = hasF ? attempt % kwPools.func.length : 0;
  var vkw = hasV ? getPoolKw('conv', vOff) : null;
  var fkw = hasF ? getPoolKw('func', fOff) : null;
  var mode;
  if (hasV && hasF) { mode = (s % 10 < 6) ? 'conv' : 'func'; }
  else if (hasV) { mode = (s % 10 < 8) ? 'conv' : 'std'; }
  else if (hasF) { mode = (s % 10 < 7) ? 'func' : 'std'; }
  else { mode = 'std'; }
  var arr, injKw, funcIdx = -1, convIdx = -1;
  if (mode === 'conv' && vkw) {
    arr = H1T_CONV; injKw = vkw.kw; convIdx = vkw.idx;
  } else if (mode === 'func' && fkw) {
    arr = H1T_KW; injKw = fkw.kw; funcIdx = fkw.idx;
  } else {
    arr = H1T_STD;
    injKw = (fkw ? fkw.kw : (vkw ? vkw.kw : d.kw));
    if (fkw) funcIdx = fkw.idx; else if (vkw) convIdx = vkw.idx;
  }
  var tpl = arr[s % arr.length];
  var ctx = buildCtx(year, s, injKw);
  return {
    text:     fill(tpl, ctx),
    mode:     mode,
    funcIdx:  funcIdx,
    convIdx:  convIdx,
    funcKw:   funcIdx >= 0 ? kwPools.func[funcIdx] : null,
    convKw:   convIdx >= 0 ? kwPools.conv[convIdx] : null,
    ctx:      ctx   // â† stored so H2 can reuse same context
  };
}

// ============================================================
// STEP 1 â€” Generate H1 only, show for confirmation
// ============================================================
function generateH1Step() {
  var year  = document.getElementById('selYear').value;
  var h2n   = parseInt(document.getElementById('selH2n').value, 10);
  var batch = parseInt(document.getElementById('selBatch').value, 10);

  pendingYear = year;
  pendingH2n  = h2n;
  pendingH1s  = [];
  regenSeeds  = {};

  var baseSeed = ((Date.now() % 99991) + genCount * 41 + 1) | 0;

  for (var b = 0; b < batch; b++) {
    regenSeeds[b] = 0;
    var seed = baseSeed + b * 41;
    var h1r  = null;
    for (var att = 0; att < 30; att++) {
      var c = tryH1WithCtx(year, seed + att * 7, att);
      var conflict = !!usedH1Set[c.text];
      if (!conflict) {
        for (var m = 0; m < pendingH1s.length; m++) {
          if (pendingH1s[m].text === c.text) { conflict = true; break; }
        }
      }
      if (!conflict) { h1r = c; h1r._seed = seed + att * 7; break; }
    }
    if (!h1r) {
      h1r = tryH1WithCtx(year, seed, 0);
      h1r = copyObj(h1r);
      h1r.text  = h1r.text + 'ï¼ˆNo.' + (genCount + b + 1) + 'ï¼‰';
      h1r._seed = seed;
    }
    pendingH1s.push(h1r);
  }

  renderPendingH1View();
}

function copyObj(o) {
  var n = {};
  for (var k in o) n[k] = o[k];
  return n;
}

// ============================================================
// Regenerate one H1 (called from step-1 view)
// ============================================================
function regenerateOneH1(idx) {
  regenSeeds[idx] = (regenSeeds[idx] || 0) + 1;
  var extra    = regenSeeds[idx];
  var year     = pendingYear;
  var prevSeed = pendingH1s[idx]._seed || 0;
  var newBase  = (prevSeed + extra * 137 + (Date.now() % 1000)) | 0;

  var h1r = null;
  for (var att = 0; att < 30; att++) {
    var c = tryH1WithCtx(year, newBase + att * 11, att + extra * 3);
    var conflict = !!usedH1Set[c.text];
    if (!conflict) {
      for (var m = 0; m < pendingH1s.length; m++) {
        if (m !== idx && pendingH1s[m].text === c.text) { conflict = true; break; }
      }
    }
    if (!conflict) { h1r = c; h1r._seed = newBase + att * 11; break; }
  }
  if (!h1r) {
    h1r = tryH1WithCtx(year, newBase, 0);
    h1r = copyObj(h1r);
    h1r.text  = h1r.text + 'ï¼ˆv' + extra + 'ï¼‰';
    h1r._seed = newBase;
  }

  // Preserve batchIdx
  var bIdx = pendingH1s[idx].batchIdx;
  pendingH1s[idx] = h1r;
  pendingH1s[idx].batchIdx = bIdx;

  renderPendingH1View();
  showToast('ğŸ”„ ç¬¬ ' + (idx + 1) + ' ç¯‡H1å·²é‡æ–°ç”Ÿæˆ');
}

// ============================================================
// Render step-1 confirmation view
// ============================================================
function renderPendingH1View() {
  var n = pendingH1s.length;

  // Update header
  document.getElementById('bdgGen').style.display   = 'inline';
  document.getElementById('bdgGen').textContent     = 'æ­¥éª¤ 1 / 2';
  document.getElementById('bdgStep').style.display  = 'none';
  document.getElementById('bdgConv').style.display  = 'none';
  document.getElementById('bdgKw').style.display    = 'none';
  document.getElementById('bdgDed').style.display   = 'none';
  document.getElementById('btnCopySet').style.display = 'none';
  document.getElementById('btnPrompt').style.display  = 'none';
  document.getElementById('oFt').style.display        = 'none';
  document.getElementById('ocardTitle').textContent   = 'H1 ä¸»æ ‡é¢˜ç¡®è®¤';

  var html = '';

  // Progress indicator
  html += '<div class="s1-prog">'
    + '<div class="s1-step"><div class="s1-dot">1</div><div class="s1-lbl">ç¡®è®¤ H1 æ ‡é¢˜</div></div>'
    + '<div class="s1-line-wrap"><div class="s1-line"><span class="s1-line-arr">â–¶</span></div></div>'
    + '<div class="s1-step"><div class="s1-dot s1-dot-i">2</div><div class="s1-lbl s1-lbl-i">ç”Ÿæˆ H2 å­æ ‡é¢˜</div></div>'
    + '</div>';

  // Tip
  var batchNote = n > 1 ? 'ï¼ˆå…± ' + n + ' ç¯‡ï¼‰' : '';
  html += '<div class="s1-tip">ğŸ’¡ ä»¥ä¸‹ H1 ä¸»æ ‡é¢˜å·²æ™ºèƒ½ç”Ÿæˆ' + batchNote + 'ã€‚<br>'
    + 'å¦‚æ»¡æ„è¯·ç‚¹å‡» <b>ã€Œâœ… ç¡®è®¤H1ï¼Œç”ŸæˆH2ã€</b>ï¼›å¦‚éœ€æ›´æ¢è¯·ç‚¹å‡»å¯¹åº”æ ‡é¢˜å³ä¾§çš„ <b>ã€ŒğŸ”„ é‡æ–°ç”Ÿæˆã€</b>ã€‚<br>'
    + '<b>H2 å­æ ‡é¢˜å°†ä¸¥æ ¼å›´ç»•ç¡®è®¤åçš„ H1 æ ‡é¢˜è¿›è¡ŒåŒ¹é…ç”Ÿæˆ</b>ï¼ˆåŸå¸‚ã€æœåŠ¡å•†ã€å…³é”®è¯ç­‰ä¸Šä¸‹æ–‡ä¸ H1 å®Œå…¨ä¸€è‡´ï¼‰ã€‚</div>';

  // H1 list
  html += '<div class="s1-list">';
  for (var i = 0; i < pendingH1s.length; i++) {
    var p = pendingH1s[i];
    var isConv = p.mode === 'conv';
    var h1Len  = p.text.length;
    var lenOk  = h1Len >= 15 && h1Len <= 65;
    var kwBdgs = '';
    if (p.convKw) kwBdgs += '<span class="ki ki-v">ğŸ”¥ ' + escHtml(p.convKw) + '</span>';
    if (p.funcKw) kwBdgs += '<span class="ki ki-f">âš¡ ' + escHtml(p.funcKw) + '</span>';
    var modeBdg = isConv
      ? '<span style="font-size:10px;font-weight:700;padding:2px 7px;border-radius:6px;background:#fff0e0;border:1px solid #fdba74;color:#c2410c">ğŸ”¥ é«˜è½¬åŒ–è¯é©±åŠ¨</span>'
      : (p.funcKw ? '<span style="font-size:10px;font-weight:700;padding:2px 7px;border-radius:6px;background:#dbeafe;border:1px solid #93c5fd;color:#1d4ed8">âš¡ åŠŸèƒ½è¯é©±åŠ¨</span>' : '<span style="font-size:10px;font-weight:700;padding:2px 7px;border-radius:6px;background:#f1f5f9;border:1px solid #cbd5e1;color:#475569">æ ‡å‡†æ¨¡æ¿</span>');
    var itemCls = 's1-item' + (isConv ? ' s1-item-conv' : '');
    html += '<div class="' + itemCls + '">';
    if (n > 1) {
      html += '<div class="s1-item-hd">'
        + '<span class="s1-item-no">ç¬¬ ' + (i + 1) + ' ç¯‡</span>'
        + modeBdg
        + '</div>';
    }
    html += '<div class="s1-item-body">';
    if (n === 1) {
      html += '<div style="display:flex;align-items:center;gap:7px;margin-bottom:8px;flex-wrap:wrap">' + modeBdg + '</div>';
    }
    html += '<div class="s1-h1-text">' + escHtml(p.text) + '</div>';
    html += '<div class="s1-h1-meta">'
      + '<span class="h1-len' + (lenOk ? '' : ' sw') + '">å­—ç¬¦ï¼š' + h1Len + (lenOk ? '' : ' âš ') + '</span>'
      + kwBdgs
      + (p.ctx ? '<span style="font-size:10px;padding:2px 7px;border-radius:6px;background:#f0fdfa;border:1px solid #99f6e4;color:#0f766e">ğŸ“ ' + escHtml(p.ctx.city) + ' Â· ' + escHtml(p.ctx.p1) + '</span>' : '')
      + '</div>';
    html += '</div>';
    html += '<div class="s1-item-actions">'
      + '<button class="btn btn-out" onclick="regenerateOneH1(' + i + ')" style="font-size:12px;padding:6px 12px">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>'
      + '<button class="btn btn-out" onclick="copyText(pendingH1s[' + i + '].text)" style="font-size:12px;padding:6px 10px">ğŸ“‹ å¤åˆ¶</button>'
      + '</div>';
    html += '</div>';
  }
  html += '</div>';

  // Confirm bar
  var confirmTxt = n > 1
    ? 'âœ… ç¡®è®¤å…¨éƒ¨ ' + n + ' ç¯‡H1ï¼Œç”ŸæˆH2å­æ ‡é¢˜ â†’'
    : 'âœ… ç¡®è®¤H1ï¼Œç”ŸæˆH2å­æ ‡é¢˜ â†’';
  html += '<div class="s1-confirm-bar">'
    + '<div class="s1-confirm-l">'
    + '<div class="s1-confirm-title">H1 ç¡®è®¤åï¼ŒH2 å°†å›´ç»•ä»¥ä¸Šä¸»æ ‡é¢˜æ™ºèƒ½åŒ¹é…ç”Ÿæˆ</div>'
    + '<div class="s1-confirm-hint">åŸå¸‚ã€æœåŠ¡å•†ã€å…³é”®è¯ç­‰ä¸Šä¸‹æ–‡ä¸ H1 ä¿æŒå®Œå…¨ä¸€è‡´</div>'
    + '</div>'
    + '<div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">'
    + '<button class="btn-confirm" onclick="confirmH1AndGenerateH2()">' + confirmTxt + '</button>'
    + '<button class="btn btn-out" onclick="generateH1Step()" style="font-size:12px;padding:8px 14px">â†© é‡æ–°å¼€å§‹</button>'
    + '</div>'
    + '</div>';

  document.getElementById('outputBody').innerHTML = html;

  // Scroll card into view
  document.getElementById('mainOCard').scrollIntoView({behavior:'smooth', block:'start'});
}

// ============================================================
// STEP 2 â€” Confirm H1, generate H2 using H1's context
// ============================================================
function confirmH1AndGenerateH2() {
  var h2n   = pendingH2n;
  var year  = pendingYear;
  var lastItem = null;

  for (var b = 0; b < pendingH1s.length; b++) {
    var h1Data = pendingH1s[b];

    // Mark H1 as used in de-dup set
    usedH1Set[h1Data.text] = true;

    // Mark H1 keyword usage
    if (h1Data.funcIdx >= 0) markUsed('func', h1Data.funcIdx);
    if (h1Data.convIdx >= 0) markUsed('conv', h1Data.convIdx);

    // Generate H2 using H1's stored context
    var selCats = getLogicalCats(h2n, (h1Data._seed || 0) * 53 + b * 17);
    var h2s = generateH2WithCtx(selCats, h1Data);

    genCount++;
    var item = {
      id:          genCount,
      destKey:     DEST_KEY,
      destName:    DB[DEST_KEY].name,
      year:        year,
      h1:          h1Data.text,
      h2s:         h2s,
      h1Mode:      h1Data.mode,
      mainFuncKw:  h1Data.funcKw,
      mainConvKw:  h1Data.convKw
    };

    lastItem = item;
    hist.unshift(JSON.parse(JSON.stringify(item)));
    advanceRR();
  }

  pendingH1s = [];
  curSet = lastItem;

  renderAllClouds();
  updateSummary();
  renderOutput();
  renderHist();
  updateHdrStats();
}

// ============================================================
// H2 GENERATION â€” uses H1's stored ctx for coherence
// ============================================================
function generateH2WithCtx(selCats, h1Data) {
  // Use the exact same ctx as H1 so city/provider/duration etc. all match
  var h1Ctx = h1Data.ctx || buildCtx(pendingYear, h1Data._seed || 0, h1Data.funcKw || DB[DEST_KEY].kw);
  var seed  = h1Data._seed || 0;
  var h2s   = [];

  var srcPool = {
    func: getPoolKw('func', 0),
    comp: getPoolKw('comp', 0),
    loc:  getPoolKw('loc',  0),
    conv: getPoolKw('conv', 0)
  };

  for (var j = 0; j < selCats.length; j++) {
    var ck  = selCats[j];
    var cat = CATS[ck];
    var cSeed = Math.abs(seed * 11 + j * 13 + CAT_ORDER.indexOf(ck) * 7) | 0;

    var primarySrc = cat.kwType     ? srcPool[cat.kwType]     : null;
    var altSrc     = cat.altKwType  ? srcPool[cat.altKwType]  : null;
    var src = null, activeKwType = null;

    if (primarySrc && altSrc) {
      if ((cSeed % 10) < 6) { src = primarySrc; activeKwType = cat.kwType; }
      else                  { src = altSrc;     activeKwType = cat.altKwType; }
    } else if (primarySrc) { src = primarySrc; activeKwType = cat.kwType; }
    else if (altSrc)       { src = altSrc;     activeKwType = cat.altKwType; }

    var useKwTpl = src && cat.tKw && cat.tKw.length > 0 && ((cSeed % 10) < 7);
    var tpl, injTxt, usedType = null;

    if (useKwTpl) {
      tpl = cat.tKw[cSeed % cat.tKw.length];
      injTxt = src.kw; usedType = activeKwType;
      markUsed(activeKwType, src.idx);
    } else {
      tpl = cat.tStd[cSeed % cat.tStd.length];
      injTxt = src ? src.kw : DB[DEST_KEY].kw;
      usedType = null;
    }

    // KEY: merge h1Ctx with this H2's injKw â€” city/provider/etc. all inherited from H1
    var h2Ctx = {};
    for (var k in h1Ctx) h2Ctx[k] = h1Ctx[k];
    h2Ctx.injKw = injTxt;

    h2s.push({
      ck:      ck,
      catName: cat.name,
      cls:     cat.cls,
      text:    fill(tpl, h2Ctx),
      kwType:  usedType,
      injKw:   usedType ? injTxt : null
    });
  }

  return h2s;
}

// ============================================================
// OUTPUT RENDERING
// ============================================================
function buildFlowBar(h2s) {
  var phases = [], seen = {};
  for (var i = 0; i < h2s.length; i++) {
    var ph = CAT_PHASE[h2s[i].ck];
    if (ph && !seen[ph.phase]) { seen[ph.phase] = true; phases.push(ph); }
  }
  var html = '<div class="flow-bar"><span class="flow-lbl">ğŸ“ è¯»è€…æ—…ç¨‹ï¼š</span>';
  for (var i = 0; i < phases.length; i++) {
    if (i > 0) html += '<span class="flow-arr">â†’</span>';
    html += '<span class="fp ' + phases[i].cls + '">' + phases[i].icon + ' ' + phases[i].phase + '</span>';
  }
  return html + '</div>';
}

function renderOutput() {
  if (!curSet) return;
  var h1 = curSet.h1, h2s = curSet.h2s;
  var h1Len = h1.length, lenOk = h1Len >= 15 && h1Len <= 65;
  var isConvDriven = curSet.h1Mode === 'conv';

  // Update header badges
  document.getElementById('bdgGen').style.display  = 'inline';
  document.getElementById('bdgGen').textContent    = 'ç¬¬ ' + curSet.id + ' ç¯‡';
  document.getElementById('bdgStep').style.display = 'inline';
  document.getElementById('bdgDed').style.display  = 'inline';
  document.getElementById('btnCopySet').style.display = 'inline-flex';
  document.getElementById('btnPrompt').style.display  = 'inline-flex';
  document.getElementById('oFt').style.display        = 'flex';
  document.getElementById('ocardTitle').textContent   = 'SEO Blog æ–‡ç« ç»“æ„';

  document.getElementById('bdgConv').style.display = isConvDriven ? 'inline' : 'none';
  if (isConvDriven && curSet.mainConvKw) document.getElementById('bdgConv').textContent = 'ğŸ”¥ ' + curSet.mainConvKw;
  var hasKw = !!(curSet.mainFuncKw && !isConvDriven);
  document.getElementById('bdgKw').style.display = hasKw ? 'inline' : 'none';
  if (hasKw) document.getElementById('bdgKw').textContent = 'ğŸ”‘ ' + curSet.mainFuncKw;

  var injF=0,injC=0,injL=0,injV=0;
  for(var m=0;m<h2s.length;m++){
    if(h2s[m].kwType==='func') injF++;
    else if(h2s[m].kwType==='comp') injC++;
    else if(h2s[m].kwType==='loc')  injL++;
    else if(h2s[m].kwType==='conv') injV++;
  }

  var seoHtml = '<div class="seo-bar">'
    + '<span class="seo-tag so">âœ“ æ ¸å¿ƒå…³é”®è¯</span>'
    + '<span class="seo-tag ' + (lenOk?'so':'sw') + '">' + (lenOk?'âœ“':'âš ') + ' H1å­—ç¬¦ ' + h1Len + (lenOk?'':'ï¼ˆå»ºè®®15-65ï¼‰') + '</span>'
    + '<span class="seo-tag so">âœ“ è¯»è€…æ—…ç¨‹æ’åº</span>'
    + '<span class="seo-tag so">âœ“ H2å›´ç»•H1ç”Ÿæˆ</span>'
    + (injV>0 ? '<span class="seo-tag sv">ğŸ”¥ é«˜è½¬åŒ–è¯Ã—'+injV+'</span>' : '')
    + (injF>0 ? '<span class="seo-tag si">âš¡ åŠŸèƒ½è¯Ã—'+injF+'</span>' : '')
    + (injC>0 ? '<span class="seo-tag" style="background:#fdf2f8;border:1px solid #f9a8d4;color:#be185d">ğŸ† ç«å“è¯Ã—'+injC+'</span>' : '')
    + (injL>0 ? '<span class="seo-tag" style="background:#f0fdfa;border:1px solid #99f6e4;color:#0f766e">ğŸ“ åœ°åŒºè¯Ã—'+injL+'</span>' : '')
    + '</div>';

  var dedHtml = '<div class="dedup-row">âœ… H1å·²å»é‡ Â· æœ¬æ¬¡ä¼šè¯ '+genCount+' ç¯‡ Â· å”¯ä¸€H1åº“ '+Object.keys(usedH1Set).length+' æ¡</div>';

  var h1BlockCls = 'h1-block' + (isConvDriven ? ' h1-block-conv' : '');
  var kwBadges = ''
    + (curSet.mainConvKw ? '<span class="ki ki-v">ğŸ”¥ '+escHtml(curSet.mainConvKw)+'</span>' : '')
    + (curSet.mainFuncKw ? '<span class="ki ki-f">âš¡ '+escHtml(curSet.mainFuncKw)+'</span>' : '');
  var h1Html = '<div class="'+h1BlockCls+'">'
    + '<span class="h1-lbl">H1</span><div class="h1-body">'
    + '<div class="h1-txt">'+escHtml(h1)+'</div>'
    + '<div class="h1-meta"><span class="h1-len">å­—ç¬¦ï¼š'+h1Len+'</span>'
    + (isConvDriven ? '<span style="font-size:10px;font-weight:700;color:#c2410c;padding:2px 7px;border-radius:6px;background:#fff0e0;border:1px solid #fdba74">ğŸ”¥ é«˜è½¬åŒ–è¯é©±åŠ¨</span>' : '')
    + kwBadges+'</div></div>'
    + '<button class="h1-copy" onclick="cpH1()">ğŸ“‹ å¤åˆ¶</button></div>';

  var injTotal = injF+injC+injL+injV;
  var h2Hd = '<div class="h2-hd">H2 å­æ ‡é¢˜ Â· å…± '+h2s.length+' ä¸ª'
    + ' <span class="h2-hd-b" style="background:var(--grn)">âœ“ è¯»è€…æ—…ç¨‹æ’åº</span>'
    + ' <span class="h2-hd-b" style="background:#0f766e">âœ“ å›´ç»•H1ä¸»é¢˜åŒ¹é…</span>'
    + (injV>0 ? ' <span class="h2-hd-b" style="background:var(--orn)">ğŸ”¥ é«˜è½¬åŒ–è¯Ã—'+injV+'</span>' : '')
    + (injTotal-injV>0 ? ' <span class="h2-hd-b" style="background:var(--amb)">ğŸ”‘ å…¶ä»–è¯Ã—'+(injTotal-injV)+'</span>' : '')
    + '</div>';

  var h2Html = '';
  for(var m=0;m<h2s.length;m++){
    var item=h2s[m];
    var phInfo=CAT_PHASE[item.ck]||{phase:'',cls:'fp-sup',icon:''};
    var isConvH2=item.kwType==='conv'||item.ck==='deal';
    var kwBdg='';
    if(item.kwType){
      var kwBdgCls={func:'ki-f',comp:'ki-c',loc:'ki-l',conv:'ki-v'}[item.kwType];
      var kwBdgIcon={func:'âš¡',comp:'ğŸ†',loc:'ğŸ“',conv:'ğŸ”¥'}[item.kwType];
      kwBdg='<span class="h2-kw-tag '+kwBdgCls+'">'+kwBdgIcon+' '+escHtml(item.injKw)+'</span>';
    }
    h2Html += '<div class="h2-item'+(isConvH2?' h2-conv':'')+'">'
      + '<div class="h2-num'+(isConvH2?' h2-num-conv':'')+'">'+(m+1)+'</div>'
      + '<div class="h2-body"><div class="h2-tags"><span class="cat-bdg '+item.cls+'">'+item.catName+'</span>'
      + '<span class="ph-bdg '+phInfo.cls+'">'+phInfo.icon+' '+phInfo.phase+'</span>'+kwBdg+'</div>'
      + '<div class="h2-txt">'+escHtml(item.text)+'</div>'
      + '<div class="h2-len">å­—ç¬¦ï¼š'+item.text.length+'</div>'
      + '</div><button class="h2-copy" onclick="cpH2('+m+')">ğŸ“‹</button></div>';
  }

  var banner = '<div class="prompt-banner">'
    + '<div class="pb-l"><div class="pb-title">ğŸ“ ä¸€é”®ç”Ÿæˆ SEO å†™ä½œ Prompt</div>'
    + '<div class="pb-sub">4ç±»å…³é”®è¯+è‡ªå®šä¹‰è¿½åŠ è¯ Â· é«˜è½¬åŒ–è¯ä¼˜å…ˆ Â· H2å›´ç»•H1ä¸»é¢˜</div></div>'
    + '<button class="btn btn-pur" onclick="generatePrompt()" style="font-size:13px;padding:9px 17px">ğŸ“ ç”Ÿæˆ Prompt</button></div>';

  document.getElementById('outputBody').innerHTML =
    seoHtml + dedHtml + h1Html + buildFlowBar(h2s) + h2Hd + '<div class="h2-list">'+h2Html+'</div>' + banner;
}

// ============================================================
// HISTORY
// ============================================================
function renderHist() {
  document.getElementById('histSec').style.display = hist.length > 1 ? 'block' : 'none';
  document.getElementById('histCnt').textContent = hist.length;
  document.getElementById('btnExpAll').style.display = genCount > 0 ? 'inline-flex' : 'none';
  var limit = Math.min(hist.length, 50), html = '';
  for(var p=0;p<limit;p++){
    var it=hist[p];
    var preview='';
    for(var q=0;q<Math.min(it.h2s.length,3);q++){
      var txt=it.h2s[q].text;
      if(txt.length>28) txt=txt.slice(0,28)+'...';
      preview += 'Â· '+escHtml(txt)+'<br>';
    }
    var kwBv = it.mainConvKw ? '<span class="kt kt-vu" style="font-size:10px;padding:1px 6px">ğŸ”¥ '+escHtml(it.mainConvKw.length>18?it.mainConvKw.slice(0,18)+'â€¦':it.mainConvKw)+'</span>' : '';
    var kwBg = (it.mainFuncKw&&!it.mainConvKw) ? '<span class="kt kt-fu" style="font-size:10px;padding:1px 6px">âš¡ '+escHtml(it.mainFuncKw.length>18?it.mainFuncKw.slice(0,18)+'â€¦':it.mainFuncKw)+'</span>' : '';
    html += '<div class="hist-card" onclick="openHistPreview('+it.id+')">'
      + '<div class="hist-card-inner">'
      + '<div class="hc-no">ç¬¬ '+it.id+' ç¯‡ Â· '+it.year+'<span class="hc-eye">ğŸ‘ é¢„è§ˆ</span></div>'
      + '<div class="hc-kws">'+kwBv+kwBg+'</div>'
      + '<div class="hc-h1">'+escHtml(it.h1.length>40?it.h1.slice(0,40)+'â€¦':it.h1)+'</div>'
      + '<div class="hc-prev">'+preview+'</div>'
      + '<div class="hc-foot"><span class="hc-cnt">'+it.h2s.length+' ä¸ªH2</span><span class="hc-btn">ç‚¹å‡»é¢„è§ˆ â†’</span></div>'
      + '</div></div>';
  }
  document.getElementById('histGrid').innerHTML = html;
}
function toggleHist(){
  var body=document.getElementById('histBody');
  var arr=document.getElementById('histArr');
  var open=body.classList.toggle('open');
  arr.textContent=open?'â–² æ”¶èµ·':'â–¼ å±•å¼€';
}

// ============================================================
// HISTORY PREVIEW MODAL
// ============================================================
function openHistPreview(id){
  var found=-1;
  for(var p=0;p<hist.length;p++){ if(hist[p].id===id){found=p;break;} }
  if(found<0) return;
  hpIdx=found; hpItem=hist[hpIdx];
  renderHPModal();
  document.getElementById('hpModal').classList.add('open');
  document.body.style.overflow='hidden';
}
function renderHPModal(){
  if(!hpItem) return;
  var isConvDriven=hpItem.h1Mode==='conv';
  document.getElementById('hpTitle').textContent='ç¬¬ '+hpItem.id+' ç¯‡æ–‡ç« ç»“æ„'+(isConvDriven?'  ğŸ”¥':'');
  document.getElementById('hpMeta').textContent=hpItem.destName+' Â· '+hpItem.year
    +(hpItem.mainConvKw?' Â· é«˜è½¬åŒ–è¯ï¼š'+hpItem.mainConvKw:'')
    +(hpItem.mainFuncKw&&!hpItem.mainConvKw?' Â· ä¸»è¯ï¼š'+hpItem.mainFuncKw:'');
  document.getElementById('hpNavInfo').textContent='ç¬¬ '+(hpIdx+1)+' / '+hist.length+' ç¯‡';
  document.querySelector('.hp-nav-prev').style.opacity=hpIdx>=hist.length-1?'.4':'1';
  document.querySelector('.hp-nav-next').style.opacity=hpIdx<=0?'.4':'1';
  var h1Len=hpItem.h1.length,lenOk=h1Len>=15&&h1Len<=65;
  var kwBadges=''
    +(hpItem.mainConvKw?'<span class="ki ki-v">ğŸ”¥ '+escHtml(hpItem.mainConvKw)+'</span>':'')
    +(hpItem.mainFuncKw?'<span class="ki ki-f">âš¡ '+escHtml(hpItem.mainFuncKw)+'</span>':'');
  var h1BlockCls='h1-block'+(isConvDriven?' h1-block-conv':'');
  var html='<div class="'+h1BlockCls+'" style="margin-bottom:14px">'
    +'<span class="h1-lbl">H1</span><div class="h1-body">'
    +'<div class="h1-txt">'+escHtml(hpItem.h1)+'</div>'
    +'<div class="h1-meta"><span class="h1-len'+(lenOk?'':' sw')+'">å­—ç¬¦ï¼š'+h1Len+(lenOk?'':' âš ')+'</span>'
    +(isConvDriven?'<span style="font-size:10px;font-weight:700;color:#c2410c;padding:2px 7px;border-radius:6px;background:#fff0e0;border:1px solid #fdba74">ğŸ”¥ é«˜è½¬åŒ–</span>':'')
    +kwBadges+'</div></div>'
    +'<button class="h1-copy" onclick="copyText(hpItem.h1)">ğŸ“‹ å¤åˆ¶</button></div>';
  var injCnt=0,injV=0;
  for(var i=0;i<hpItem.h2s.length;i++){
    if(hpItem.h2s[i].kwType){injCnt++;if(hpItem.h2s[i].kwType==='conv')injV++;}
  }
  html+='<div class="h2-hd" style="margin-bottom:9px">H2 å­æ ‡é¢˜ Â· å…± '+hpItem.h2s.length+' ä¸ª'
    +' <span class="h2-hd-b" style="background:var(--grn)">âœ“ è¯»è€…æ—…ç¨‹æ’åº</span>'
    +' <span class="h2-hd-b" style="background:#0f766e">âœ“ å›´ç»•H1ä¸»é¢˜</span>'
    +(injV>0?' <span class="h2-hd-b" style="background:var(--orn)">ğŸ”¥ é«˜è½¬åŒ–è¯Ã—'+injV+'</span>':'')
    +(injCnt-injV>0?' <span class="h2-hd-b" style="background:var(--amb)">ğŸ”‘ å…¶ä»–è¯Ã—'+(injCnt-injV)+'</span>':'')
    +'</div><div class="h2-list">';
  for(var m=0;m<hpItem.h2s.length;m++){
    var item=hpItem.h2s[m];
    var phInfo=CAT_PHASE[item.ck]||{phase:'',cls:'fp-sup',icon:''};
    var isConvH2=item.kwType==='conv'||item.ck==='deal';
    var kwBdg='';
    if(item.kwType){
      var kbc={func:'ki-f',comp:'ki-c',loc:'ki-l',conv:'ki-v'}[item.kwType];
      var kbi={func:'âš¡',comp:'ğŸ†',loc:'ğŸ“',conv:'ğŸ”¥'}[item.kwType];
      kwBdg='<span class="h2-kw-tag '+kbc+'">'+kbi+' '+escHtml(item.injKw)+'</span>';
    }
    html+='<div class="h2-item'+(isConvH2?' h2-conv':'')+'">'
      +'<div class="h2-num'+(isConvH2?' h2-num-conv':'')+'" style="background:'+(isConvH2?'var(--orn)':'var(--pri)')+'">'+(m+1)+'</div>'
      +'<div class="h2-body"><div class="h2-tags"><span class="cat-bdg '+item.cls+'">'+item.catName+'</span>'
      +'<span class="ph-bdg '+phInfo.cls+'">'+phInfo.icon+' '+phInfo.phase+'</span>'+kwBdg+'</div>'
      +'<div class="h2-txt">'+escHtml(item.text)+'</div>'
      +'<div class="h2-len">å­—ç¬¦ï¼š'+item.text.length+'</div>'
      +'</div><button class="h2-copy" onclick="copyText(hpItem.h2s['+m+'].text)">ğŸ“‹</button></div>';
  }
  html+='</div>';
  document.getElementById('hpBody').innerHTML=html;
  document.getElementById('hpBody').scrollTop=0;
}
function hpNavigate(dir){
  var ni=hpIdx+dir;
  if(ni<0||ni>=hist.length) return;
  hpIdx=ni; hpItem=hist[hpIdx]; renderHPModal();
}
function closeHPModal(){ document.getElementById('hpModal').classList.remove('open'); document.body.style.overflow=''; }
function closeHPModalBg(e){ if(e&&e.target===document.getElementById('hpModal')) closeHPModal(); }
function loadHistIntoMain(){
  if(!hpItem) return;
  var item=hpItem; closeHPModal();
  curSet=item; renderOutput();
  var outCard=document.getElementById('mainOCard');
  if(outCard){
    setTimeout(function(){
      outCard.scrollIntoView({behavior:'smooth',block:'start'});
      outCard.classList.add('flash');
      setTimeout(function(){ outCard.classList.remove('flash'); },1600);
    },200);
  }
  showToast('ğŸ“‚ å·²åŠ è½½ç¬¬ '+item.id+' ç¯‡');
}
function copyHistSet(){
  if(!hpItem) return;
  var it=hpItem;
  var t='ã€ç¬¬ '+it.id+' ç¯‡ | '+it.destName+' '+it.year+'ã€‘\n\nH1ï¼š\n'+it.h1+'\n\n';
  if(it.mainConvKw) t+='ä¸»é«˜è½¬åŒ–è¯ï¼š'+it.mainConvKw+'\n';
  if(it.mainFuncKw) t+='ä¸»åŠŸèƒ½è¯ï¼š'+it.mainFuncKw+'\n';
  t+='\nH2ï¼ˆæŒ‰è¯»è€…æ—…ç¨‹æ’åºï¼‰ï¼š\n';
  var tn={func:'åŠŸèƒ½è¯',comp:'ç«å“è¯',loc:'åœ°åŒºè¯',conv:'é«˜è½¬åŒ–è¯'};
  for(var n=0;n<it.h2s.length;n++){
    var kw=it.h2s[n].injKw?' ['+(tn[it.h2s[n].kwType]||'')+': '+it.h2s[n].injKw+']':'';
    t+=(n+1)+'. ['+it.h2s[n].catName+'] '+it.h2s[n].text+kw+'\n';
  }
  copyText(t);
}
function generatePromptFromHP(){
  if(!hpItem) return;
  var item=hpItem; closeHPModal();
  curSet=item; generatePrompt();
}

// ============================================================
// COPY / EXPORT
// ============================================================
function cpH1(){ if(curSet) copyText(curSet.h1); }
function cpH2(i){ if(curSet&&curSet.h2s[i]) copyText(curSet.h2s[i].text); }
function copySet(){
  if(!curSet) return;
  var tn={func:'åŠŸèƒ½è¯',comp:'ç«å“è¯',loc:'åœ°åŒºè¯',conv:'é«˜è½¬åŒ–è¯'};
  var t='ã€ç¬¬ '+curSet.id+' ç¯‡ | '+curSet.destName+' '+curSet.year+'ã€‘\n\nH1ï¼ˆä¸»æ ‡é¢˜ï¼‰ï¼š\n'+curSet.h1+'\n\n';
  if(curSet.mainConvKw) t+='ä¸»é«˜è½¬åŒ–è¯ï¼š'+curSet.mainConvKw+'\n';
  if(curSet.mainFuncKw) t+='ä¸»åŠŸèƒ½è¯ï¼š'+curSet.mainFuncKw+'\n';
  t+='\nH2ï¼ˆå­æ ‡é¢˜ Â· æŒ‰è¯»è€…æ—…ç¨‹æ’åºï¼‰ï¼š\n';
  for(var n=0;n<curSet.h2s.length;n++){
    var kw=curSet.h2s[n].injKw?' ['+(tn[curSet.h2s[n].kwType]||'')+': '+curSet.h2s[n].injKw+']':'';
    t+=(n+1)+'. ['+curSet.h2s[n].catName+'] '+curSet.h2s[n].text+kw+'\n';
  }
  copyText(t);
}
function exportCurrent(){
  if(!curSet) return;
  var t='=== ç¬¬ '+curSet.id+' ç¯‡ | '+curSet.destName+' '+curSet.year;
  if(curSet.mainConvKw) t+=' | é«˜è½¬åŒ–è¯ï¼š'+curSet.mainConvKw;
  if(curSet.mainFuncKw) t+=' | åŠŸèƒ½è¯ï¼š'+curSet.mainFuncKw;
  t+=' ===\n\nH1: '+curSet.h1+'\n\n';
  for(var n=0;n<curSet.h2s.length;n++) t+='H2-'+(n+1)+' ['+curSet.h2s[n].catName+']: '+curSet.h2s[n].text+'\n';
  downloadFile(t,'seo-russia-'+curSet.id+'.txt');
  showToast('ğŸ“¤ å¯¼å‡ºæˆåŠŸ');
}
function exportAll(){
  if(!hist.length) return;
  var sep='--------------------------------------------\n';
  var t='ä¿„ç½—æ–¯ eSIM SEO Blog ç»“æ„è®°å½• Â· å…± '+hist.length+' ç¯‡\nç”Ÿæˆæ—¶é—´ï¼š'+new Date().toLocaleString()+'\n\n';
  for(var p=0;p<hist.length;p++){
    var it=hist[p];
    t+=sep+'ç¬¬ '+it.id+' ç¯‡ | '+it.year;
    if(it.mainConvKw) t+=' | é«˜è½¬åŒ–è¯ï¼š'+it.mainConvKw;
    if(it.mainFuncKw) t+=' | åŠŸèƒ½è¯ï¼š'+it.mainFuncKw;
    t+='\n'+sep+'H1: '+it.h1+'\n\n';
    for(var n=0;n<it.h2s.length;n++){
      var kw=it.h2s[n].injKw?' ('+it.h2s[n].injKw+')':'';
      t+='H2-'+(n+1)+' ['+it.h2s[n].catName+']: '+it.h2s[n].text+kw+'\n';
    }
    t+='\n';
  }
  downloadFile(t,'seo-russia-all-'+hist.length+'.txt');
  showToast('âœ… å·²å¯¼å‡º '+hist.length+' ç¯‡æ–‡ç« ç»“æ„');
}

// ============================================================
// PROMPT GENERATION
// ============================================================
function generatePrompt(){
  if(!curSet){ showToast('è¯·å…ˆå®Œæˆæ–‡ç« ç»“æ„ç”Ÿæˆ'); return; }
  updateCKWPreview(); buildPromptContent();
  document.getElementById('pModal').classList.add('open');
  document.body.style.overflow='hidden';
}
function buildPromptContent(){
  if(!curSet) return;
  var customKws=getCustomKws();
  var d=DB[DEST_KEY];
  var h1=curSet.h1, h2s=curSet.h2s;
  var dest=curSet.destName, yr=curSet.year, kw=d.kw;
  var p1=d.providers[0], p2=d.providers[1]||d.providers[0];
  var injV=[],injF=[],injC=[],injL=[],seen={};
  if(curSet.mainConvKw&&!seen[curSet.mainConvKw]){seen[curSet.mainConvKw]=true;injV.push(curSet.mainConvKw);}
  if(curSet.mainFuncKw&&!seen[curSet.mainFuncKw]){seen[curSet.mainFuncKw]=true;injF.push(curSet.mainFuncKw);}
  for(var i=0;i<h2s.length;i++){
    if(h2s[i].kwType&&h2s[i].injKw&&!seen[h2s[i].injKw]){
      seen[h2s[i].injKw]=true;
      if(h2s[i].kwType==='conv') injV.push(h2s[i].injKw);
      else if(h2s[i].kwType==='func') injF.push(h2s[i].injKw);
      else if(h2s[i].kwType==='comp') injC.push(h2s[i].injKw);
      else if(h2s[i].kwType==='loc')  injL.push(h2s[i].injKw);
    }
  }
  var sep='================================================================\n';
  var sep2='----------------------------------------------------------------\n';
  var pt='';
  pt+=sep+'# SEO è½¯æ–‡å†™ä½œä»»åŠ¡ | ä¿„ç½—æ–¯ eSIM Â· '+yr+'\n'+sep+'\n';
  pt+='## ä¸€ã€è§’è‰²å®šä½\n'+sep2;
  pt+='ä½ æ˜¯ä¸€ä½æ‹¥æœ‰ 10 å¹´ç»éªŒçš„ Google SEO å†…å®¹ä¸“å®¶ï¼Œç²¾é€šå†…å®¹è¥é”€ï¼Œ\n';
  pt+='è¯·æ’°å†™åŒæ—¶æ»¡è¶³ä»¥ä¸‹ç›®æ ‡çš„é«˜è´¨é‡æ–‡ç« ï¼š\n';
  pt+='  1. ç¬¦åˆ Google E-E-A-T è´¨é‡è¯„ä¼°æ ‡å‡†\n';
  pt+='  2. çœŸæ­£è§£å†³ç›®æ ‡è¯»è€…çš„å®é™…ç—›ç‚¹ï¼Œæä¾›å¯æ“ä½œçš„å®ç”¨ä¿¡æ¯\n';
  pt+='  3. å››ç±»å…³é”®è¯ï¼ˆé«˜è½¬åŒ–è¯Â·åŠŸèƒ½è¯Â·ç«å“è¯Â·åœ°åŒºè¯ï¼‰è‡ªç„¶èå…¥ï¼Œç»ä¸ç”Ÿç¡¬å †ç Œ\n';
  pt+='  4. é«˜è½¬åŒ–è¯ä¼˜å…ˆæ¤å…¥ï¼Œç›´æ¥é©±åŠ¨è¯»è€…äº§ç”Ÿè´­ä¹°è¡Œä¸º\n\n';
  pt+='## äºŒã€æ–‡ç« åŸºæœ¬ä¿¡æ¯\n'+sep2;
  pt+='ä¸»æ ‡é¢˜ï¼ˆH1ï¼‰ï¼š'+h1+'\n';
  pt+='ç›®æ ‡åœ°åŒº    ï¼š'+dest+'\n';
  pt+='å‘å¸ƒå¹´ä»½    ï¼š'+yr+'\n';
  pt+='æ ¸å¿ƒå…³é”®è¯  ï¼š'+kw+'\n';
  pt+='å‚è€ƒæœåŠ¡å•†  ï¼š'+p1+'ã€'+p2+' ç­‰\n';
  pt+='ç›®æ ‡è¯»è€…    ï¼šä¿„ç½—æ–¯å½“åœ°ç”¨æˆ·ï¼Œæˆ–å³å°†å‰å¾€å…¶ä»–å›½å®¶æ—…è¡Œçš„ä¿„ç½—æ–¯ç”¨æˆ·\n\n';
  pt+='## ä¸‰ã€æ–‡ç« ç»“æ„ï¼ˆæŒ‰è¯»è€…æ—…ç¨‹é€»è¾‘æ’åºï¼‰\n'+sep2;
  pt+='ã€å¼•è¨€ã€‘100-150å­—ï¼šä»¥è¯»è€…ç—›ç‚¹å¼€ç¯‡ï¼Œå‰100å­—å†…è‡ªç„¶æ¤å…¥ã€Œ'+kw+'ã€\n\n';
  for(var i=0;i<h2s.length;i++){
    var ph=CAT_PHASE[h2s[i].ck]||{phase:'',icon:''};
    var isConvSec=h2s[i].kwType==='conv'||h2s[i].ck==='deal';
    pt+=(i+1)+'. ã€'+h2s[i].catName+' Â· '+ph.phase+'ã€‘'+h2s[i].text+'\n';
    if(h2s[i].injKw){
      var tl={func:'åŠŸèƒ½è¯',comp:'ç«å“è¯',loc:'åœ°åŒºè¯',conv:'ğŸ”¥é«˜è½¬åŒ–è¯'}[h2s[i].kwType]||'';
      pt+='   ^ ('+tl+') æœ¬èŠ‚è‡ªç„¶æ¤å…¥ï¼šã€Œ'+h2s[i].injKw+'ã€1-2 æ¬¡'+(isConvSec?'  â˜… å«æ˜ç¡®è¡ŒåŠ¨å·å¬ï¼ˆCTAï¼‰':'')+'\n';
    }
  }
  pt+='\nã€ç»“å°¾æ€»ç»“ã€‘100-150å­—ï¼š3æ¡æ ¸å¿ƒå»ºè®®ï¼Œå‘¼åº”ã€Œ'+kw+'ã€ï¼Œå«è¡ŒåŠ¨å·å¬\n\n';
  pt+='## å››ã€å…³é”®è¯æ¤å…¥è§„èŒƒ\n'+sep2;
  pt+='æ ¸å¿ƒè¯ã€Œ'+kw+'ã€å…¨æ–‡å‡ºç° 5-8 æ¬¡ï¼Œå¯†åº¦ 1.5%-2%\n\n';
  if(injV.length>0){
    pt+='ã€ğŸ”¥ é«˜è½¬åŒ–è¯ Â· æœ€é«˜ä¼˜å…ˆçº§ Â· ç›´æ¥é©±åŠ¨è´­ä¹°è½¬åŒ–ã€‘\n';
    pt+='  â†’ ä¸»è¦åˆ†å¸ƒäºï¼šä¼˜æƒ æŠ˜æ‰£ã€è´­ä¹°æŒ‡å—ã€å¥—é¤æ¨èç« èŠ‚\n';
    pt+='  â†’ æ¯ä¸ªè¯åœ¨å¯¹åº”ç« èŠ‚å‡ºç° 1-2 æ¬¡ï¼Œæ­é… CTA ç”¨è¯­\n';
    for(var i=0;i<injV.length;i++) pt+='  Â· '+injV[i]+'\n';
    pt+='\n';
  }
  if(injF.length>0){
    pt+='ã€âš¡ åŠŸèƒ½è¯ Â· é«˜ä¼˜å…ˆçº§ Â· åˆ†æ•£æ³¨å…¥å¯¹åº”ç« èŠ‚ï¼Œæ¯ä¸ª 1-2 æ¬¡ã€‘\n';
    for(var i=0;i<injF.length;i++) pt+='  Â· '+injF[i]+'\n';
    pt+='\n';
  }
  if(injC.length>0){
    pt+='ã€ğŸ† ç«å“è¯ Â· å¯¹æ¯”ç« èŠ‚è‡ªç„¶æåŠã€‘\n';
    for(var i=0;i<injC.length;i++) pt+='  Â· '+injC[i]+'\n';
    pt+='\n';
  }
  if(injL.length>0){
    pt+='ã€ğŸ“ åœ°åŒºè¯ Â· è¦†ç›–/åœºæ™¯ç« èŠ‚ã€‘\n';
    for(var i=0;i<injL.length;i++) pt+='  Â· '+injL[i]+'\n';
    pt+='\n';
  }
  if(customKws.length>0){
    pt+='ã€ğŸ¯ è‡ªå®šä¹‰è¿½åŠ å…³é”®è¯ Â· å¿…é¡»å…¨éƒ¨æ¤å…¥ Â· æ¯ä¸ªè‡ªç„¶å‡ºç° 1-2 æ¬¡ã€‘\n';
    pt+='  â†’ æ ¹æ®è¯­ä¹‰é€‰æ‹©æœ€åˆé€‚çš„ç« èŠ‚è‡ªç„¶åµŒå…¥ï¼Œä¸å¼ºè¡Œå †ç Œ\n';
    for(var i=0;i<customKws.length;i++) pt+='  Â· '+customKws[i]+'\n';
    pt+='\n';
  }
  var extV=kwPools.conv.filter(function(k){return injV.indexOf(k)<0;}).slice(0,8);
  var extF=kwPools.func.filter(function(k){return injF.indexOf(k)<0;}).slice(0,10);
  var extC=kwPools.comp.filter(function(k){return injC.indexOf(k)<0;}).slice(0,5);
  var extL=kwPools.loc.filter(function(k){return injL.indexOf(k)<0;}).slice(0,10);
  if(extV.length>0){pt+='ã€é¢å¤–é«˜è½¬åŒ–è¯å‚è€ƒï¼ˆæŒ‰éœ€é€‰ç”¨ 3-5 ä¸ªï¼‰ã€‘\n';for(var i=0;i<extV.length;i++) pt+='  Â· '+extV[i]+'\n';pt+='\n';}
  if(extF.length>0){pt+='ã€é¢å¤–åŠŸèƒ½è¯å‚è€ƒï¼ˆæ‹©ä¼˜é€‰ç”¨ 5-8 ä¸ªï¼‰ã€‘\n';for(var i=0;i<extF.length;i++) pt+='  Â· '+extF[i]+'\n';pt+='\n';}
  if(extC.length>0){pt+='ã€é¢å¤–ç«å“è¯å‚è€ƒã€‘\n';for(var i=0;i<extC.length;i++) pt+='  Â· '+extC[i]+'\n';pt+='\n';}
  if(extL.length>0){pt+='ã€é¢å¤–åœ°åŒºè¯å‚è€ƒã€‘\n';for(var i=0;i<extL.length;i++) pt+='  Â· '+extL[i]+'\n';pt+='\n';}
  pt+='## äº”ã€SEO å†™ä½œè´¨é‡è§„èŒƒ\n'+sep2;
  pt+='Â· å…¨æ–‡æ€»å­—æ•°ï¼š2500-3500 å­—\n';
  pt+='Â· æ¯ä¸ªH2ç« èŠ‚ï¼š200-350å­—\n';
  pt+='Â· Expertiseï¼šå¼•ç”¨å…·ä½“æ•°æ®ï¼ˆä»·æ ¼åŒºé—´ $X-$Yï¼Œç½‘é€Ÿ 50-100 Mbpsï¼‰\n';
  pt+='Â· Authoritativenessï¼šè‡ªç„¶æåŠçœŸå®æœåŠ¡å•†ï¼ˆ'+p1+'ã€'+p2+'ç­‰ï¼‰\n';
  pt+='Â· Trustworthinessï¼šå®¢è§‚å‘ˆç°ä¼˜ç¼ºç‚¹ï¼Œå»ºç«‹ä¿¡ä»»\n';
  pt+='Â· å…¨éƒ¨å…³é”®è¯æ€»å¯†åº¦ä¸è¶…è¿‡ 2.5%\n';
  pt+='Â· é«˜è½¬åŒ–è¯ç« èŠ‚å¿…é¡»å«æ˜ç¡®çš„ CTAï¼ˆå¦‚ï¼šã€Œç«‹å³è´­ä¹°ã€ã€Œç‚¹å‡»æŸ¥çœ‹æœ€æ–°ä¼˜æƒ ã€ï¼‰\n\n';
  pt+=sep+'## å¼€å§‹å†™ä½œ\n'+sep;
  pt+='è¯·ä»ã€å¼•è¨€ã€‘å¼€å§‹ä¾æ¬¡å±•å¼€æ‰€æœ‰ç« èŠ‚ï¼Œ\næœ€åé™„ï¼šâ‘  Meta Title â‘¡ Meta æè¿° â‘¢ 3æ¡å†…é“¾å»ºè®®ã€‚\n'+sep;
  var kwAll=injV.length+injF.length+injC.length+injL.length;
  document.getElementById('mInfo').innerHTML=
    '<span class="m-st msb">ğŸ“Š çº¦'+Math.round(pt.length/2.2)+'å­—</span>'
    +'<span class="m-st msb">ğŸ“ '+h2s.length+'ä¸ªç« èŠ‚</span>'
    +(injV.length>0?'<span class="m-st msv">ğŸ”¥ é«˜è½¬åŒ–è¯Ã—'+injV.length+'</span>':'')
    +(injF.length>0?'<span class="m-st msp">âš¡ åŠŸèƒ½è¯Ã—'+injF.length+'</span>':'')
    +(injC.length>0?'<span class="m-st" style="background:#fdf2f8;border:1px solid #f9a8d4;color:#be185d">ğŸ† ç«å“è¯Ã—'+injC.length+'</span>':'')
    +(injL.length>0?'<span class="m-st mst">ğŸ“ åœ°åŒºè¯Ã—'+injL.length+'</span>':'')
    +(customKws.length>0?'<span class="m-st msc">ğŸ¯ è‡ªå®šä¹‰è¯Ã—'+customKws.length+'</span>':'')
    +(kwAll+customKws.length>0?'<span class="m-st msa">ğŸ”‘ å…± '+(kwAll+customKws.length)+' ä¸ªæ³¨å…¥</span>':'');
  document.getElementById('promptTa').value=pt;
}
function closeModal(){ document.getElementById('pModal').classList.remove('open'); document.body.style.overflow=''; }
function closeModalBg(e){ if(e&&e.target===document.getElementById('pModal')) closeModal(); }
document.addEventListener('keydown',function(e){
  if(e.key==='Escape'){
    if(document.getElementById('hpModal').classList.contains('open')){closeHPModal();return;}
    if(document.getElementById('pModal').classList.contains('open')){closeModal();return;}
  }
});
function copyPrompt(){ var t=document.getElementById('promptTa').value; if(t) copyText(t); }
function exportPrompt(){
  var t=document.getElementById('promptTa').value;
  if(!t||!curSet) return;
  downloadFile(t,'prompt-russia-'+curSet.id+'.txt');
  showToast('ğŸ“¤ Prompt å·²å¯¼å‡º');
}

// ============================================================
// RESET
// ============================================================
function doReset(){
  genCount=0; curSet=null; hist=[]; usedH1Set={};
  pendingH1s=[]; pendingYear=''; pendingH2n=8; regenSeeds={};
  var ids=['bdgGen','bdgStep','bdgConv','bdgKw','bdgDed','btnCopySet','btnPrompt'];
  for(var i=0;i<ids.length;i++) document.getElementById(ids[i]).style.display='none';
  document.getElementById('oFt').style.display='none';
  document.getElementById('histSec').style.display='none';
  document.getElementById('btnExpAll').style.display='none';
  document.getElementById('ocardTitle').textContent='SEO Blog æ–‡ç« ç»“æ„';
  document.getElementById('outputBody').innerHTML=
    '<div class="empty"><div class="empty-ico">ğŸ‡·ğŸ‡º</div>'
    +'<h3>ä¸¤æ­¥å¼ç”Ÿæˆï¼Œç»“æ„æ›´ç²¾å‡†</h3>'
    +'<p><b>â‘  ç‚¹å‡»ã€Œç”ŸæˆH1æ ‡é¢˜ã€</b> â†’ æŸ¥çœ‹å¹¶ç¡®è®¤ä¸»æ ‡é¢˜<br>'
    +'<b>â‘¡ ç‚¹å‡»ã€Œç¡®è®¤H1ï¼Œç”ŸæˆH2ã€</b> â†’ H2å›´ç»•H1è‡ªåŠ¨åŒ¹é…<br><br>'
    +'åŸå¸‚ã€æœåŠ¡å•†ã€å…³é”®è¯ä¸Šä¸‹æ–‡ä¸H1å®Œå…¨ä¸€è‡´ Â· è¯»è€…æ—…ç¨‹æ’åº</p></div>';
  showToast('ğŸ”„ å·²é‡ç½®æ‰€æœ‰è®°å½•');
}

// ============================================================
// UTILS
// ============================================================
function renderAllClouds(){ renderCloud('func');renderCloud('comp');renderCloud('loc');renderCloud('conv'); }
function copyText(text){
  if(navigator.clipboard&&navigator.clipboard.writeText){
    navigator.clipboard.writeText(text).then(function(){showToast('âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');}).catch(function(){copyFallback(text);});
  } else { copyFallback(text); }
}
function copyFallback(text){
  var ta=document.createElement('textarea');
  ta.value=text; ta.style.cssText='position:fixed;opacity:0;top:0;left:0';
  document.body.appendChild(ta); ta.focus(); ta.select();
  try{document.execCommand('copy');showToast('âœ… å·²å¤åˆ¶');}catch(e){showToast('âŒ è¯·æ‰‹åŠ¨å…¨é€‰å¤åˆ¶');}
  document.body.removeChild(ta);
}
function downloadFile(text,filename){
  var a=document.createElement('a');
  a.href='data:text/plain;charset=utf-8,'+encodeURIComponent(text);
  a.download=filename;
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
}
var toastTimer=null;
function showToast(msg){
  var el=document.getElementById('toast');
  el.textContent=msg; el.classList.add('show');
  if(toastTimer) clearTimeout(toastTimer);
  toastTimer=setTimeout(function(){el.classList.remove('show');},2800);
}
function updateHdrStats(){
  document.getElementById('sGen').textContent=genCount;
  document.getElementById('sDedup').textContent=Object.keys(usedH1Set).length;
}
</script>
</body>
</html>
